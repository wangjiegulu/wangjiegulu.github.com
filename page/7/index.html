<!DOCTYPE html>




<html class="theme-next muse" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="WAND JIE" type="application/atom+xml" />






<meta name="description" content="Wang Jie&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="WAND JIE">
<meta property="og:url" content="http://blog.wangjiegulu.com/page/7/index.html">
<meta property="og:site_name" content="WAND JIE">
<meta property="og:description" content="Wang Jie&apos;s blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WAND JIE">
<meta name="twitter:description" content="Wang Jie&apos;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.wangjiegulu.com/page/7/"/>





  <title>WAND JIE</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-111189680-2', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">WAND JIE</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">TO BE AN ARTIST-ENGINNER</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2014/12/05/Android-在Adapter的getView方法中绑定OnClickListener比较好的方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/12/05/Android-在Adapter的getView方法中绑定OnClickListener比较好的方法/" itemprop="url">[Android]在Adapter的getView方法中绑定OnClickListener比较好的方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-12-05T13:50:00+08:00">
                2014-12-05
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/12/05/Android-在Adapter的getView方法中绑定OnClickListener比较好的方法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/12/05/Android-在Adapter的getView方法中绑定OnClickListener比较好的方法/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #ff0000;"><strong>以下内容为原创，欢迎转载，转载请注明</strong></span></p>
<p><span style="color: #ff0000;"><strong>来自天天博客：<a href="http://www.cnblogs.com/tiantianbyconan/p/4146512.html" title="view: [Android]在Adapter的getView方法中绑定OnClickListener比较好的方法" target="_blank" rel="noopener"><span style="color: #ff0000;">http://www.cnblogs.com/tiantianbyconan/p/4146512.html</span></a>&nbsp;</strong></span></p>
<p>&nbsp;</p>
<p>给ListView中每个item绑定点击事件的方法，比较常见的如下这种方式：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> View getView(<span style="color: #0000ff;">int</span><span style="color: #000000;"> positon, View convertView, ViewGroup parent){<br></span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> convertView){<br></span><span style="color: #008080;"> 3</span>         convertView = LayoutInflater.<span style="color: #0000ff;">from</span>(context).inflate(R.layout.item, <span style="color: #0000ff;">null</span><span style="color: #000000;">);<br></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;"> 5</span><br><span style="color: #008080;"> 6</span>     Button button =<span style="color: #000000;"> ABViewUtil.obtainView(convertView, R.id.item_btn);<br></span><span style="color: #008080;"> 7</span>     button.setOnClickListener(<span style="color: #0000ff;">new</span><span style="color: #000000;"> View.OnClickListener(){<br></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">        @Override<br></span><span style="color: #008080;"> 9</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onClick(View v){<br></span><span style="color: #008080;">10</span>             Toast.makeText(context, <span style="color: #800000;">“</span><span style="color: #800000;">position: </span><span style="color: #800000;">“</span> +<span style="color: #000000;"> position, Toast.LENGTH_SHORT).show();<br></span><span style="color: #008080;">11</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">12</span> <span style="color: #000000;">    });<br></span><span style="color: #008080;">13</span><br><span style="color: #008080;">14</span> }</pre><br></div>

<p>然后运行，当然没问题。</p>
<p>但是这里有一个可以优化的地方，注意代码第7行，每次调用getView方法都会设置Button的OnClickListener，会生成很多不必要的OnClickListener对象。</p>
<p>所以，我们可以想到，在生成convertView时，同时设置Button的OnClickListener，convertView是被不断地复用的，这样的OnClickListener也就可以被不断地服用，也就是说在第3行和第4行之间进行这一步。这样，代码演化到如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> View getView(<span style="color: #0000ff;">int</span><span style="color: #000000;"> positon, View convertView, ViewGroup parent){<br></span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> convertView){<br></span><span style="color: #008080;"> 3</span>         convertView = LayoutInflater.from(context).inflate(R.layout.item, <span style="color: #0000ff;">null</span><span style="color: #000000;">);<br></span><span style="color: #008080;"> 4</span>         Button button =<span style="color: #000000;"> ABViewUtil.obtainView(convertView, R.id.item_btn);<br></span><span style="color: #008080;"> 5</span>         button.setOnClickListener(<span style="color: #0000ff;">new</span><span style="color: #000000;"> View.OnClickListener(){<br></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">            @Override<br></span><span style="color: #008080;"> 7</span>             <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onClick(View v){<br></span><span style="color: #008080;"> 8</span>                 Toast.makeText(context, “position: “ +<span style="color: #000000;"> position, Toast.LENGTH_SHORT).show();<br></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">10</span> <span style="color: #000000;">        });<br></span><span style="color: #008080;">11</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">12</span> }</pre><br></div>

<p>这个代码看上去没什么问题，但是问题就在onClick回调的的第8行中使用的position的时候，因为这里使用的是匿名内部类（这个匿名内部类实现了View.OnClickListener这个接口），所以如果需要在onClick中使用position这个变量的话，需要把position声明为final。一旦声明了final，等到编译之后，这个position就会被作为这个匿名内部类中的一个private的成员变量。这样，ListView往下滚动，下面需要显示的item会重用上面不显示的convertView，convertView中的Button设置的OnClickListener实现类的对象，回调onClick时，使用的position其实是该OnClickListener实现类的成员变量position（这个position的值只是在构造的时候被初始化了而已！）。所以，这个ListView刚加载完数据后，还未滚动时，点击屏幕上的item都是正常的，但是如果一旦滚动，有view被重用了，这个时候，position的值就错乱了，所以在onClick中通过position获取到的item的数据当然也是错乱的了。</p>
<p>所以，要解决这个问题，就需要让onClick方法回调的时候得到的position是个正确的值，我们可以选择使用把当前显示的convertView对应的position值保存在convertView中，然后把这个convertView对象传入OnClickListener中保存，所以代码演化到如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> View getView(<span style="color: #0000ff;">int</span><span style="color: #000000;"> positon, View convertView, ViewGroup parent){<br></span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> convertView){<br></span><span style="color: #008080;"> 3</span>         convertView = LayoutInflater.from(context).inflate(R.layout.item, <span style="color: #0000ff;">null</span><span style="color: #000000;">);<br></span><span style="color: #008080;"> 4</span>         Button button =<span style="color: #000000;"> ABViewUtil.obtainView(convertView, R.id.item_btn);<br></span><span style="color: #008080;"> 5</span>         button.setOnClickListener(<span style="color: #0000ff;">new</span><span style="color: #000000;"> OnConvertViewClickListener(convertView, R.id.ab<strong>id_adapter_item_position){<br></strong></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">                @Override<br></span><span style="color: #008080;"> 7</span>                 <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onClickCallBack(View registedView, <span style="color: #0000ff;">int</span><span style="color: #000000;">… positionIds){<br></span><span style="color: #008080;"> 8</span>                     Toast.makeText(context, “position: “ + positionIds[0<span style="color: #000000;">], Toast.LENGTH_SHORT).show();<br></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">                }<br></span><span style="color: #008080;">10</span> <span style="color: #000000;">        });<br></span><span style="color: #008080;">11</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">12</span> <span style="color: #000000;">    convertView.setTag(R.id.abid_adapter_item_position, position);<br></span><span style="color: #008080;">13</span> }</pre><br></div>

<p>就像上面第5行这样，Button绑定的是<strong><a href="https://github.com/wangjiegulu/AndroidBucket/blob/master/src/com/wangjie/androidbucket/adapter/listener/OnConvertViewClickListener.java" target="_blank" rel="noopener">OnConvertViewClickListener</a></strong>，它是OnClickListener的一个实现类可以保存convertView到Listener中，到时候回调onClick方法的时候可以从保存的convertView中获取到当前显示的item的position（这个position是以tag的方式保存在convertView中的）。</p>
<p>当然，还需要做第12行这一步，它的目的是把当前显示的position保存到convertView中，提供给<strong><a href="https://github.com/wangjiegulu/AndroidBucket/blob/master/src/com/wangjie/androidbucket/adapter/listener/OnConvertViewClickListener.java" target="_blank" rel="noopener">OnConvertViewClickListener</a></strong>获取当前的position。</p>
<p>这样就ok了，可以在onClickCallBack()方法中进行点击事件的处理了，每个button永远只有一个onClickListener。</p>
<p><span style="color: #008000;"><strong>注：使用<a href="https://github.com/wangjiegulu/AndroidBucket/blob/master/src/com/wangjie/androidbucket/adapter/listener/OnConvertViewClickListener.java" target="_blank" rel="noopener"><span style="color: #008000;">OnConvertViewClickListener</span></a>可以依赖<a href="https://github.com/wangjiegulu/AndroidBucket" target="_blank" rel="noopener">AndroidBucket</a>（<a href="https://github.com/wangjiegulu/AndroidBucket）项目" target="_blank" rel="noopener">https://github.com/wangjiegulu/AndroidBucket）项目</a></strong></span></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2014/12/03/Android-ListView的Adapter-getView-方法中延迟加载图片的优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/12/03/Android-ListView的Adapter-getView-方法中延迟加载图片的优化/" itemprop="url">[Android]ListView的Adapter.getView()方法中延迟加载图片的优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-12-03T14:19:00+08:00">
                2014-12-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/12/03/Android-ListView的Adapter-getView-方法中延迟加载图片的优化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/12/03/Android-ListView的Adapter-getView-方法中延迟加载图片的优化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #ff0000;"><strong>以下内容为原创，欢迎转载，转载请注明</strong></span></p>
<p><strong><span style="color: #ff0000;">来自天天博客：<a href="http://www.cnblogs.com/tiantianbyconan/p/4139998.html%20" title="view: [Android]ListView的Adapter.getView()方法中延迟加载图片的优化" target="_blank" rel="noopener"><span style="color: #ff0000;">http://www.cnblogs.com/tiantianbyconan/p/4139998.html</span></a></span><a href="http://www.cnblogs.com/tiantianbyconan/p/3574131.html" title="view: [Android]异步加载图片，内存缓存，文件缓存，imageview显示图片时增加淡入淡出动画" target="_blank" rel="noopener">
</a></strong></p>
<p>&nbsp;</p>
<p>举个例子吧，以好友列表为例</p>
<p>ListView中每个Item表示一个好友，每个好友中都有一个头像，需要从服务端加载到本地，然后显示在item中。</p>
<p>显然，启动加载图片的过程应该是在getView()方法中触发，启动一个线程，然后下载头像图片。这里使用我写的一个开源框架<strong><a href="https://github.com/wangjiegulu/ImageLoaderSample" target="_blank" rel="noopener">ImageLoaderSample</a></strong>（<a href="https://github.com/wangjiegulu/ImageLoaderSample" target="_blank" rel="noopener">https://github.com/wangjiegulu/ImageLoaderSample</a>）来加载图片，并实现内存缓存和本地缓存。</p>
<p>额－－这里不再介绍ImageLoaderSample的用法了，给个传送门：<a href="http://www.cnblogs.com/tiantianbyconan/p/3574131.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiantianbyconan/p/3574131.html</a></p>
<p>&nbsp;</p>
<p>再来看看getView()方法的调用时机：</p>
<p>1. Adapter调用NotifyDataChanged的时候</p>
<p>2. ListView滚动时，也就是convertView不断复用的时候。</p>
<p>也就是说，每当ListView滚动时，getView()方法不断被调用，图片下载的过程不断地执行（当然，<strong><a href="https://github.com/wangjiegulu/ImageLoaderSample" target="_blank" rel="noopener">ImageLoaderSample</a></strong>中会有缓存，但是内存缓存时有限的，如果内存缓存中找不到要显示的图片，那就需要到文件缓存中查找，需要进行io读写，这个也是相对比较耗时的），显然，这里面还有优化的余地。</p>
<p>怎么去优化这里？只要让ListView滚动的时候图片显示的时候不要去进行io读写就好了，具体逻辑如下：</p>
<p>－如果调用GetView方法时，ListView处于停止状态，则先去内存中查找头像图片；如果内存图片存在，则显示内存中保存好的图片；如果内存图片不存在，则继续到文件缓存中找，如果文件缓存图片存在，则显示文件缓存中的图片；如果文件缓存图片不存在，则根据url去网络下载这张图片，然后显示；</p>
<p>－如果调用getView方法时，ListView处于滚动状态，则去内存中查找头像的图片；如果内存图片存在，则显示内存中保存好的图片；如果内存图片不存在，则显示一张默认的图片（省去了从文件缓存中找图片和网络中去请求图片的步骤）。</p>
<p>&nbsp;</p>
<p>这样的话，我们就必须要改写BaseAdapter，让它能够监测ListView的滚动状态，并在Adapter中可以获取到当前ListView的滚动状态。所以改造BaseAdapter，<strong><a href="https://github.com/wangjiegulu/AndroidBucket/blob/master/src/com/wangjie/androidbucket/adapter/ABaseAdapter.java" target="_blank" rel="noopener">ABaseAdapter</a></strong>（<a href="https://github.com/wangjiegulu/AndroidBucket/blob/master/src/com/wangjie/androidbucket/adapter/ABaseAdapter.java" target="_blank" rel="noopener">https://github.com/wangjiegulu/AndroidBucket/blob/master/src/com/wangjie/androidbucket/adapter/ABaseAdapter.java</a>）：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.androidbucket.adapter;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span> android.widget.<em><span style="color: #000000;">;<br></span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.adapter.listener.OnAdapterScrollListener;<br></span><span style="color: #008080;"> 5</span><br><span style="color: #008080;"> 6</span> <span style="color: #008000;">/**</span><br><span style="color: #008080;"> 7</span> <span style="color: #008000;"> </span></em> Author: wangjie<br><span style="color: #008080;"> 8</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 9</span> <span style="color: #008000;">  Date: 12/3/14.<br></span><span style="color: #008080;">10</span>  <span style="color: #008000;"><em>/</em></span><br><span style="color: #008080;">11</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">class</span> ABaseAdapter <span style="color: #0000ff;">extends</span> BaseAdapter <span style="color: #0000ff;">implements</span><span style="color: #000000;"> AbsListView.OnScrollListener {<br></span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> OnAdapterScrollListener onAdapterScrollListener;<br></span><span style="color: #008080;">13</span>     <span style="color: #008000;">/**</span><br><span style="color: #008080;">14</span> <span style="color: #008000;">      当前listview是否属于滚动状态<br></span><span style="color: #008080;">15</span>      <span style="color: #008000;">*/</span><br><span style="color: #008080;">16</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isScrolling;<br></span><span style="color: #008080;">17</span><br><span style="color: #008080;">18</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isScrolling() {<br></span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> isScrolling;<br></span><span style="color: #008080;">20</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">21</span><br><span style="color: #008080;">22</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setOnAdapterScrollListener(OnAdapterScrollListener onAdapterScrollListener) {<br></span><span style="color: #008080;">23</span>         <span style="color: #0000ff;">this</span>.onAdapterScrollListener =<span style="color: #000000;"> onAdapterScrollListener;<br></span><span style="color: #008080;">24</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">25</span><br><span style="color: #008080;">26</span>     <span style="color: #0000ff;">protected</span><span style="color: #000000;"> ABaseAdapter(AbsListView listView) {<br></span><span style="color: #008080;">27</span>         listView.setOnScrollListener(<span style="color: #0000ff;">this</span><span style="color: #000000;">);<br></span><span style="color: #008080;">28</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">29</span><br><span style="color: #008080;">30</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">31</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onScroll(AbsListView view, <span style="color: #0000ff;">int</span> firstVisibleItem, <span style="color: #0000ff;">int</span> visibleItemCount, <span style="color: #0000ff;">int</span><span style="color: #000000;"> totalItemCount) {<br></span><span style="color: #008080;">32</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> !=<span style="color: #000000;"> onAdapterScrollListener) {<br></span><span style="color: #008080;">33</span> <span style="color: #000000;">            onAdapterScrollListener.onScroll(view, firstVisibleItem, visibleItemCount, totalItemCount);<br></span><span style="color: #008080;">34</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">35</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">36</span><br><span style="color: #008080;">37</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">38</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onScrollStateChanged(AbsListView view, <span style="color: #0000ff;">int</span><span style="color: #000000;"> scrollState) {<br></span><span style="color: #008080;">39</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> !=<span style="color: #000000;"> onAdapterScrollListener) {<br></span><span style="color: #008080;">40</span> <span style="color: #000000;">            onAdapterScrollListener.onScrollStateChanged(view, scrollState);<br></span><span style="color: #008080;">41</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">42</span><br><span style="color: #008080;">43</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 设置是否滚动的状态</span><br><span style="color: #008080;">44</span>         <span style="color: #0000ff;">if</span> (scrollState == AbsListView.OnScrollListener.SCROLL_STATE_IDLE) { <span style="color: #008000;">//</span><span style="color: #008000;"> 不滚动状态</span><br><span style="color: #008080;">45</span>             isScrolling = <span style="color: #0000ff;">false</span><span style="color: #000000;">;<br></span><span style="color: #008080;">46</span>             <span style="color: #0000ff;">this</span><span style="color: #000000;">.notifyDataSetChanged();<br></span><span style="color: #008080;">47</span>         } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {<br></span><span style="color: #008080;">48</span>             isScrolling = <span style="color: #0000ff;">true</span><span style="color: #000000;">;<br></span><span style="color: #008080;">49</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">50</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">51</span> }</pre><br></div>

<p>如上述代码所示，该Adapter实现了AbsListView.OnScrollListener，并在构造方法中给ListView绑定了OnScrollListener，在实现的onScrollStateChanged方法中获取到当前滚动状态，并且保存这个状态isScrolling，并暴露isScrolling()方法给外面。</p>
<p>OnAdapterScrollListener这个接口是继承了AbsListView.OnScrollListener，因为这里在Adapter中一景设置了OnScrollListener了，所以如果在外面设置了新的OnScrollListener的话，就会失效了，所以必须提供另外一个setOnAdapterScrollListener，然后再传入一个OnScrollListener，然后在每个方法中进行回调就好了，因为考虑到以后可能会扩展其他的接口方法，所以这里新写了一个接口（为了以后扩展时原来的代码不会被影响，推荐使用OnAdapterScrollSampleListener这个实现类来代替OnAdapterScrollListener这个接口，OnAdapterScrollSampleListener这个类只是对OnAdapterScrollListener的所有方法进行了空实现）。</p>
<p>&nbsp;</p>
<p>然后我们编写一个MyAdapter继承ABaseAdapter，然后，在getView()方法中，需要显示头像的时候调用如下方法：</p>
<p>// 如果在滚动（从内存中查找，找不到也不进行网络请求）</p>
<div class="cnblogs_code"><br><pre>ImageLoader.getInstances().displayImage(headUrl, headIv, <span style="color: #0000ff;">null</span>, R.drawable.default_head, isScrolling());</pre><br></div>

<p>看到木有？</p>
<p>1. displayImage()方法发生了改变，多了最后一个参数isOnlyMemory这个参数，表示是否只是在内存缓存中找这张图片，如果没有就不再继续找下去了（displayImage原来的方法我还留着，所以不会影响之前的代码）。</p>
<p>2. 调用了isScrolling()方法，作为参数isOnlyMemory的值，表示，如果正在滚动的话，就只在缓存中找这张图片。</p>
<p>这样，运行原来的代码试试吧，是不是效率快了一些？</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2014/11/23/直接拿来用！十大Material-Design开源项目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/11/23/直接拿来用！十大Material-Design开源项目/" itemprop="url">直接拿来用！十大Material Design开源项目</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-23T11:51:00+08:00">
                2014-11-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/11/23/直接拿来用！十大Material-Design开源项目/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/11/23/直接拿来用！十大Material-Design开源项目/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>来自：<a href="http://www.csdn.net/article/2014-11-21/2822753-material-design-libs/1" target="_blank" rel="noopener">http://www.csdn.net/article/2014-11-21/2822753-material-design-libs/1</a></p>
<p>介于拟物和扁平之间的Material Design自面世以来，便引起了很多人的关注与思考，就此产生的讨论也不绝于耳。本文详细介绍了在Android开发者圈子里颇受青睐的十个Material Design开源项目，从示例、FAB、菜单、动画、Ripple到Dialog，看被称为&ldquo;Google第一次在设计语言和规范上超越了Apple&rdquo;的Material Design是如何逐渐成为App的一种全新设计标准。</p>
<p><strong>1.&nbsp;<a href="https://github.com/navasmdc/MaterialDesignLibrary" target="_blank" rel="noopener">MaterialDesignLibrary</a></strong></p>
<p>在众多新晋库中，MaterialDesignLibrary可以说是颇受开发者瞩目的一个控件效果库，能够让开发者在Android 2.2系统上使用Android 5.0才支持的控件效果，比如扁平、矩形、浮动按钮，复选框以及各式各样的进度指示器等。</p>
<p><img src="http://cms.csdnimg.cn/article/201411/21/546e9b100445a_middle.jpg" alt=""></p>
<p>除上述之外，MaterialDesignLibrary还拥有SnackBar、Dialog、Color selector组件，可非常便捷地对应用界面进行设置。</p>
<p>进度指示器样式效果设置：&nbsp;</p>
<div class="dp-highlighter bg_xml"><br><div class="bar"><br><div class="tools"><br><div class="cnblogs_code"><br><pre><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">com.gc.materialdesign.views.ProgressBarCircularIndetermininate<br>                </span><span style="color: #ff0000;">android:id</span><span style="color: #0000ff;">=”@+id/progressBarCircularIndetermininate”</span><span style="color: #ff0000;"><br>                android:layout_width</span><span style="color: #0000ff;">=”32dp”</span><span style="color: #ff0000;"><br>                android:layout_height</span><span style="color: #0000ff;">=”32dp”</span><span style="color: #ff0000;"><br>                android:background</span><span style="color: #0000ff;">=”#1E88E5”</span> <span style="color: #0000ff;">/&gt;</span></pre><br></div>

<p>&nbsp;</p>
<p></p></div><br></div><br></div><p></p>
<p>Dialog：</p>
<div class="cnblogs_code"><br><pre>Dialog dialog = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Dialog(Context context,String title, String message);<br>dialog.show();</span></pre><br></div>

<p>&nbsp;</p>
<p><strong>2.&nbsp;<a href="https://github.com/traex/RippleEffect" target="_blank" rel="noopener">RippleEffect</a></strong></p>
<p>由来自法兰西的Robin Chutaux开发的RippleEffect基于MIT许可协议开源，能够在Android API 9+上实现Material Design，为开发者提供了一种极为简易的方式来创建带有可扩展视图的header视图，并且允许最大程度上的自定制。</p>
<p><img src="http://cms.csdnimg.cn/article/201411/21/546ea09e7c452_middle.jpg" alt=""></p>
<p>用法（在XML文件中声明一个RippleView）：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">com.andexert.library.RippleView<br>  </span><span style="color: #ff0000;">android:id</span><span style="color: #0000ff;">=”@+id/more”</span><span style="color: #ff0000;"><br>  android:layout_width</span><span style="color: #0000ff;">=”?android:actionBarSize”</span><span style="color: #ff0000;"><br>  android:layout_height</span><span style="color: #0000ff;">=”?android:actionBarSize”</span><span style="color: #ff0000;"><br>  android:layout_toLeftOf</span><span style="color: #0000ff;">=”@+id/more2”</span><span style="color: #ff0000;"><br>  android:layout_margin</span><span style="color: #0000ff;">=”5dp”</span><span style="color: #ff0000;"><br>  ripple:rv_centered</span><span style="color: #0000ff;">=”true”</span><span style="color: #0000ff;">&gt;</span><br><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ImageView<br>    </span><span style="color: #ff0000;">android:layout_width</span><span style="color: #0000ff;">=”?android:actionBarSize”</span><span style="color: #ff0000;"><br>    android:layout_height</span><span style="color: #0000ff;">=”?android:actionBarSize”</span><span style="color: #ff0000;"><br>    android:src</span><span style="color: #0000ff;">=”@android:drawable/ic_menu_edit”</span><span style="color: #ff0000;"><br>    android:layout_centerInParent</span><span style="color: #0000ff;">=”true”</span><span style="color: #ff0000;"><br>    android:padding</span><span style="color: #0000ff;">=”10dp”</span><span style="color: #ff0000;"><br>    android:background</span><span style="color: #0000ff;">=”@android:color/holo_blue_dark”</span><span style="color: #0000ff;">/&gt;</span><br><br><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">com.andexert.library.RippleView</span><span style="color: #0000ff;">&gt;</span></pre><br></div>

<p>&nbsp;</p>
<p><strong>3.&nbsp;<a href="https://github.com/rengwuxian/MaterialEditText" target="_blank" rel="noopener">MaterialEditText</a></strong></p>
<p>随着Material Design的到来，AppCompat v21也为开发者提供了Material Design的控件外观支持，其中就包括EditText，但却并不好用，没有设置颜色的API，也没有任何Google Material Design Spec中提到的特性。于是，来自国内的开发者&ldquo;扔物线&rdquo;开发了MaterialEditText库，直接继承EditText，无需修改Java文件即能实现自定义控件颜色。</p>
<p><img src="http://cms.csdnimg.cn/article/201411/21/546ea1168a50c_middle.jpg" alt=""></p>
<p>自定义Base Color：</p>
<div class="cnblogs_code"><br><pre>app:baseColor=”#0056d3”</pre><br></div>

<p><img src="http://cms.csdnimg.cn/article/201411/21/546ea26d93a02_middle.jpg" alt=""></p>
<p>&nbsp;</p>
<p>自定义Error Color：</p>
<div class="cnblogs_code"><br><pre><span style="color: #000000;">app:maxCharacters=”10”<br>app:errorColor=”#ddaa00”</span></pre><br></div>

<p><span style="line-height: 1.5;">&nbsp;</span></p>
<p><img src="http://cms.csdnimg.cn/article/201411/21/546ea27b0fc23_middle.jpg" alt=""></p>
<p><strong>4.&nbsp;<a href="https://github.com/mikepenz/Android-LollipopShowcase" target="_blank" rel="noopener">Android-LollipopShowcase</a></strong></p>
<p>Android-LollipopShowcase是由来自奥地利的移动、后端及Web开发者Mike Penz所开发的演示应用，集中演示了新Material Design中所有的UI效果，以及Android Lollipop中其他非常酷炫的特性元素，比如Toolbar、RecyclerView、ActionBarDrawerToggle、Floating Action Button（FAB）、Android Compat Theme等。</p>
<p><img src="http://cms.csdnimg.cn/article/201411/21/546ed8a896530_middle.jpg" alt=""></p>
<p><strong>5.&nbsp;<a href="https://github.com/dexafree/MaterialList" target="_blank" rel="noopener">MaterialList</a></strong></p>
<p>MaterialList是一个能够帮助所有Android开发者获取谷歌UI设计规范中新增的CardView（卡片视图）的开源库，支持Android 2.3+系统。作为ListView的扩展，MaterialList可以接收、存储卡片列表，并根据它们的Android风格和设计模式进行展示。此外，开发者还可以创建专属于自己的卡片布局，并轻松将其添加到CardList中。</p>
<p><img src="http://cms.csdnimg.cn/article/201411/21/546ede74f3033_middle.jpg" alt=""></p>
<p>使用过程代码，在布局中声明MaterialListView：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">RelativeLayout </span><span style="color: #ff0000;">xmlns:android</span><span style="color: #0000ff;">=”<a href="http://schemas.android.com/apk/res/android" target="_blank" rel="noopener">http://schemas.android.com/apk/res/android</a>“</span><span style="color: #ff0000;"><br>    android:layout_width</span><span style="color: #0000ff;">=”match_parent”</span><span style="color: #ff0000;"><br>    android:layout_height</span><span style="color: #0000ff;">=”match_parent”</span><span style="color: #ff0000;"><br>    android:paddingLeft</span><span style="color: #0000ff;">=”@dimen/activity_horizontal_margin”</span><span style="color: #ff0000;"><br>    android:paddingRight</span><span style="color: #0000ff;">=”@dimen/activity_horizontal_margin”</span><span style="color: #ff0000;"><br>    android:paddingTop</span><span style="color: #0000ff;">=”@dimen/activity_vertical_margin”</span><span style="color: #ff0000;"><br>    android:paddingBottom</span><span style="color: #0000ff;">=”@dimen/activity_vertical_margin”</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">com.dexafree.materiallistviewexample.view.MaterialListView<br>        </span><span style="color: #ff0000;">android:layout_width</span><span style="color: #0000ff;">=”fill_parent”</span><span style="color: #ff0000;"><br>        android:layout_height</span><span style="color: #0000ff;">=”fill_parent”</span><span style="color: #ff0000;"><br>        android:id</span><span style="color: #0000ff;">=”@+id/material_listview”</span><span style="color: #0000ff;">/&gt;</span><br><br><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">RelativeLayout</span><span style="color: #0000ff;">&gt;</span></pre><br></div>

<p>&nbsp;</p>
<p><strong>6.&nbsp;<a href="https://github.com/futuresimple/android-floating-action-button" target="_blank" rel="noopener">android-floating-action-button</a></strong></p>
<p>Floating Action Button（FAB）是众多专家大牛针对Material Design讨论比较细化的一个点，通过圆形元素与分割线、卡片、各种Bar的直线形成鲜明对比，并使用色彩设定中鲜艳的辅色，带来更具突破性的视觉效果。也正因如此，在Github上，有着许多与FAB相关的开源项目，基于Material Design规范的开源Android浮动Action Button控件android-floating-action-button便是其中之一。</p>
<p><img src="http://cms.csdnimg.cn/article/201411/21/546efe7e3a855_middle.jpg?_=33895" alt="">&nbsp;<img src="http://cms.csdnimg.cn/article/201411/21/546efe84a5da6.jpg" alt=""></p>
<p>其主要特性如下：</p>
<p>&nbsp;</p>
<ul>
<li>支持常规56dp和最小40dp的按钮；</li>
<li>支持自定义正常、Press状态以及可拖拽图标的按钮背景颜色；</li>
<li>AddFloatingActionButton类能够让开发者非常方便地直接在代码中写入加号图标；</li>
<li>FloatingActionsMenu类支持展开/折叠显示动作。</li>
</ul>
<p>&nbsp;</p>
<p><strong>7.&nbsp;<a href="https://github.com/markushi/android-ui" target="_blank" rel="noopener">android-ui</a></strong></p>
<p>android-ui是Android UI组件类库，支持Android API 14+，包含了ActionView、RevealColorView等UI组件。其中，ActionView可使Action动作显示动画效果，而RevealColorView则带来了Android 5.0中的圆形显示/隐藏动画体验。</p>
<p><img src="http://cms.csdnimg.cn/article/201411/21/546f0a7681186.jpg" alt=""></p>
<p><strong>8.&nbsp;<a href="https://github.com/balysv/material-menu" target="_blank" rel="noopener">Material Menu</a></strong></p>
<p>Material Menu为开发者带来了非常酷炫的Android菜单、返回、删除以及检查按钮变形，完全控制动画，并为开发者提供了两种MaterialMenuDrawable包装。</p>
<p><img src="http://cms.csdnimg.cn/article/201411/21/546f0b8672e44.jpg" alt=""></p>
<p>自定义颜色等操作：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008000;">//</span><span style="color: #008000;"> change color</span><br>MaterialMenu.setColor(<span style="color: #0000ff;">int</span><span style="color: #000000;"> color)<br><br></span><span style="color: #008000;">//</span><span style="color: #008000;"> change transformation animation duration</span><br>MaterialMenu.setTransformationDuration(<span style="color: #0000ff;">int</span><span style="color: #000000;"> duration)<br><br></span><span style="color: #008000;">//</span><span style="color: #008000;"> change pressed animation duration</span><br>MaterialMenu.setPressedDuration(<span style="color: #0000ff;">int</span><span style="color: #000000;"> duration)<br><br></span><span style="color: #008000;">//</span><span style="color: #008000;"> change transformation interpolator</span><br><span style="color: #000000;">MaterialMenu.setInterpolator(Interpolator interpolator)<br><br></span><span style="color: #008000;">//</span><span style="color: #008000;"> set RTL layout support</span><br>MaterialMenu.setRTLEnabled(<span style="color: #0000ff;">boolean</span> enabled)</pre><br></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>9.&nbsp;<a href="https://github.com/ksoichiro/Android-ObservableScrollView" target="_blank" rel="noopener">Android-ObservableScrollView</a></strong></p>
<p>Android-ObservableScrollView是一款用于在滚动视图中观测滚动事件的Android库。它能够轻而易举地与Android 5.0 Lollipop引进的工具栏（Toolbar）进行交互，还可以帮助开发者实现拥有Material Design应用视觉体验的界面外观，支持ListView、ScrollView、WebView、RecyclerView、GridView组件。</p>
<p><img src="http://cms.csdnimg.cn/article/201411/21/546ef6d6abfcd.jpg" alt=""><img src="http://cms.csdnimg.cn/article/201411/21/546ef6e476b55.jpg" alt=""><img src="http://cms.csdnimg.cn/article/201411/21/546ef6eea211e.jpg" alt=""></p>
<p>交互代码回调：</p>
<div class="cnblogs_code"><br><pre><span style="color: #000000;">@Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onUpOrCancelMotionEvent(ScrollState scrollState) {<br>        ActionBar ab </span>=<span style="color: #000000;"> getSupportActionBar();<br>        </span><span style="color: #0000ff;">if</span> (scrollState ==<span style="color: #000000;"> ScrollState.UP) {<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ab.isShowing()) {<br>                ab.hide();<br>            }<br>        } </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (scrollState ==<span style="color: #000000;"> ScrollState.DOWN) {<br>            </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">ab.isShowing()) {<br>                ab.show();<br>            }<br>        }<br>    }</span></pre><br></div>

<p>&nbsp;</p>
<p><strong>10.&nbsp;<a href="https://github.com/google/material-design-icons" target="_blank" rel="noopener">Material Design Icons</a></strong></p>
<p>最后，再来介绍一下Google Material Design规范的官方开源图标集Material Design Icons。良心Google开源了包括Material Design系统图标包在内的750个字形，涵盖动作、音视频、通信、内容、编辑器、文件、硬件、图像、地图、导航、通知、社交等各个方面，适用于Web、Android和iOS应用开发，绝对是开发者及设计师必备的资源。</p>
<p><img src="http://cms.csdnimg.cn/article/201411/21/546ef31fa0f7e_middle.jpg" alt=""></p>
<p>图标格式主要包括：&nbsp;</p>
<ul>
<li>SVG格式，24px和48px；</li>
<li>SVG和CSS Sprites；</li>
<li>适用于Web平台的1x、2x PNG格式图标；</li>
<li>适用于iOS的1x、2x、3x PNG图标；</li>
<li>所有图标的Hi-dpi版本（hdpi、mdpi、xhdpi、xxhdpi、xxxhdpi）。</li>
</ul>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2014/09/25/Android-使用AdapterTypeRender对不同类型的item数据到UI的渲染/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/09/25/Android-使用AdapterTypeRender对不同类型的item数据到UI的渲染/" itemprop="url">[Android]使用AdapterTypeRender对不同类型的item数据到UI的渲染</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-09-25T15:07:00+08:00">
                2014-09-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/09/25/Android-使用AdapterTypeRender对不同类型的item数据到UI的渲染/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/09/25/Android-使用AdapterTypeRender对不同类型的item数据到UI的渲染/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #ff0000;"><strong>以下内容为原创，转载请注明：</strong></span></p>
<p><span style="color: #ff0000;"><strong>来自天天博客：<a href="http://www.cnblogs.com/tiantianbyconan/p/3992843.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiantianbyconan/p/3992843.html</a></strong></span></p>
<p>&nbsp;</p>
<p>本文讲的工具均放在<strong><a href="https://github.com/wangjiegulu/AndroidBucket" target="_blank" rel="noopener">AndroidBucket</a></strong>开源项目中，欢迎大家star/fork，地址：<a href="https://github.com/wangjiegulu/AndroidBucket" target="_blank" rel="noopener">https://github.com/wangjiegulu/AndroidBucket</a></p>
<p>&nbsp;</p>
<p>主要实现聊天功能中的发送不同类型的信息，比如纯文本、图片、语音、图文混排多媒体的数据等（具体效果看微信）。</p>
<p>这里使用AdapterTypeRender在BaseTypeAdapter（这个之后会讲到）中实现。</p>
<p>这里主要的实现方式是在ChatAdapter（继承BaseTypeAdapter）中根据每个position的item的type，来使用不同的AdapterTypeRender渲染器进行渲染。渲染的过程当然是在getView方法中进行。</p>
<p><strong>1.&nbsp;AdapterTypeRender</strong></p>
<p>先来看看AdapterTypeRender这个接口。它有3个方法：getConvertView()、fitEvents()、fitDatas()三个方法。</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.androidbucket.adapter;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.view.View;<br><br></span><span style="color: #008000;">/<strong></strong></span><span style="color: #008000;"><br> <em> 用于对不同类型item数据到UI的渲染
 </em> Author: wangjie<br> <em> Email: tiantian.china.2@gmail.com
 </em> Date: 9/14/14.<br> </span><span style="color: #008000;">*/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> AdapterTypeRender {<br><br>    </span><span style="color: #008000;">/</span><span style="color: #008000;"><br>     <em> 返回一个item的convertView，也就是BaseAdapter中getView方法中返回的convertView
     </em> </span><span style="color: #808080;">@return</span><br>     <span style="color: #008000;"><em>/</em></span><span style="color: #000000;"><br>    View getConvertView();<br><br>    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
      填充item中各个控件的事件，比如按钮点击事件等<br>     </span><span style="color: #008000;"><em>/</em></span><br>    <span style="color: #0000ff;">void</span><span style="color: #000000;"> fitEvents();<br><br>    </span><span style="color: #008000;">/**</span><span style="color: #008000;">
      对指定position的item进行数据的适配<br>     <em> </em></span><span style="color: #808080;">@param</span><span style="color: #008000;"> position<br>     </span><span style="color: #008000;">/</span><br>    <span style="color: #0000ff;">void</span> fitDatas(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position);<br><br>}</span></pre><br></div>

<p>－getconvertView()方法用于返回给BaseTypeAdapter一个convertView，一个AdapterTypeRender实现类对应一个convertView实例，该AdapterTypeRender可以被重用，所以convertView也可以被重用了。</p>
<p>－fitEvents()方法用于给当前的item中的各个控件注册事件，比如点击事件、touch事件等（具体的注册事件后面回讲到），因为这个方法是在getView中只有convertView为null时才会调用，所以只会调用一次，所以在这里添加事件是比较好的。</p>
<p>－fitDatas()方法用于把数据适配到item的各个view中进行显示。这个方法只要getView得到调用，就会被调用。</p>
<p><strong>2. BaseTypeAdapter</strong></p>
<p>这是一个抽象类，是继承于BaseAdapter的，重写了里面的getView方法。会自动根据指定position的item获取对应的type，然后通过type实例化一个AdapterTypeRender的实现，然后又使用了BaseAdapter中自带的convertView的重用机制进行对view的重用，同样也是对AdapterTypeRender的重用。</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.androidbucket.adapter.typeadapter;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.annotation.TargetApi;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.os.Build;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.view.View;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.view.ViewGroup;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.BaseAdapter;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.R;<br><br></span><span style="color: #008000;">/<strong></strong></span><span style="color: #008000;"><br> <em> Author: wangjie
 </em> Email: tiantian.china.2@gmail.com<br> <em> Date: 9/25/14.<br> </em></span><span style="color: #008000;">/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">class</span> BaseTypeAdapter <span style="color: #0000ff;">extends</span><span style="color: #000000;"> BaseAdapter{<br>    @TargetApi(Build.VERSION_CODES.DONUT)<br>    @Override<br>    </span><span style="color: #0000ff;">public</span> View getView(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position, View convertView, ViewGroup parent) {<br>        AdapterTypeRender typeRender;<br>        </span><span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> convertView){<br>            typeRender </span>=<span style="color: #000000;"> getAdapterTypeRender(position);<br>            convertView </span>=<span style="color: #000000;"> typeRender.getConvertView();<br>            convertView.setTag(R.id.ab<strong>id_adapter_item_type_render, typeRender);<br>            typeRender.fitEvents();<br>        }</strong></span><span style="color: #0000ff;">else</span><span style="color: #000000;">{<br>            typeRender </span>=<span style="color: #000000;"> (AdapterTypeRender) convertView.getTag(R.id.abid_adapter_item_type_render);<br>        }<br>        convertView.setTag(R.id.ab__id_adapter_item_position, position);<br><br>        </span><span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span> !=<span style="color: #000000;"> typeRender){<br>            typeRender.fitDatas(position);<br>        }<br><br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> convertView;<br>    }<br><br>    </span><span style="color: #008000;">/</span><span style="color: #008000;"><br>     <em> 根据指定position的item获取对应的type，然后通过type实例化一个AdapterTypeRender的实现
     </em> </span><span style="color: #808080;">@param</span><span style="color: #008000;"> position<br>     <em> </em></span><span style="color: #808080;">@return</span><br>     <span style="color: #008000;">/</span><br>    <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span> AdapterTypeRender getAdapterTypeRender(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position);<br>}</span></pre><br></div>

<p>为了实现AdapterTypeRender的重用，一旦生成了一个AdapterTypeRender实现类的实例，则使用setTag的方法进行对convertView和AdapterTypeRender的绑定（R.id.ab__id_adapter_item_type_render这个id是在<strong><a href="https://github.com/wangjiegulu/AndroidBucket" target="_blank" rel="noopener">AndroidBucket</a></strong>中定义了的），这个可以参考以前的ViewHolder的写法。</p>
<p>为了实现在同一个item中的事件（这里以view的点击事件为例）响应都共用一个观察者的实例，需要在convertView中保存对应的position。这是因为同一个convertView因为使用了view的重用，是被非显示页面的很多个item所共用的。所以只需要，在当前显示的一屏中，每个convertView对应的postion即可，毕竟这些事件触发只有在当前显示的一屏中才会被触发。保存postion的方式依然使用了setTag的方式（R.id.ab__id_adapter_item_position这个id是在<strong><a href="https://github.com/wangjiegulu/AndroidBucket" target="_blank" rel="noopener">AndroidBucket</a></strong>中定义了的），注意：子类一般不需要重写getView方法了，其他的数据适配UI渲染都交给Render吧！</p>
<p>除了重写了getView方法之外，还定义了一个抽象方法：getAdapterTypeRender。这个方法需要子类去实现，需要告诉BaseTypeAdapter，指定position的item，它的type对应的AdapterTypeRender的实例是什么。</p>
<p><strong>3. 自定义AdapterTypeRender的实现</strong></p>
<p>接下来，就尝试自己实现几个不同布局的Render吧。这里假设需要实现两种：文本布局（TypeTextRender）、图片布局（TypeImageRender）。</p>
<p>a) TypeTextRender的实现：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.activities.typerendertest.adapter;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.content.Context;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.view.LayoutInflater;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.view.View;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.ImageButton;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.ImageView;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.ProgressBar;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.TextView;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.adapter.typeadapter.AdapterTypeRender;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.adapter.listener.OnConvertViewClickListener;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.thread.ThreadPool;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.utils.ABTimeUtil;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.utils.ABViewUtil;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.imageloadersample.imageloader.ImageLoader;<br><br></span><span style="color: #008000;">/<strong></strong></span><span style="color: #008000;"><br> <em> Author: wangjie
 </em> Email: tiantian.china.2@gmail.com<br> <em> Date: 9/14/14.<br> </em></span><span style="color: #008000;">/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> TypeTextRender <span style="color: #0000ff;">implements</span><span style="color: #000000;"> AdapterTypeRender {<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Context context;<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> ChatAdapter adapter;<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> View contentView;<br><br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> TypeTextRender(Context context, ChatAdapter adapter) {<br>        </span><span style="color: #0000ff;">this</span>.context =<span style="color: #000000;"> context;<br>        </span><span style="color: #0000ff;">this</span>.adapter =<span style="color: #000000;"> adapter;<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 解析文本类型的布局</span><br>        contentView = LayoutInflater.from(context).inflate(R.layout.item_type_text, <span style="color: #0000ff;">null</span><span style="color: #000000;">);<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> View getConvertView() {<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 返回文本类型的布局</span><br>        <span style="color: #0000ff;">return</span><span style="color: #000000;"> contentView;<br>    }<br><br>    </span><span style="color: #008000;">/</span><span style="color: #008000;"><br>     <em> 这个方法同一个convertView只会被调用一次，所以可以放心地在这里执行事件地绑定，不用担心生成过多的OnClickListener等<br>     </em></span><span style="color: #008000;">/</span><span style="color: #000000;"><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> fitEvents() {<br>        </span><span style="color: #008000;">/<strong></strong></span><span style="color: #008000;"><br>         <em> 生成一个在convertView中使用的clickListener<br>         </em></span><span style="color: #008000;">/</span><span style="color: #000000;"><br>        OnConvertViewClickListener onConvertViewClickListener </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> OnConvertViewClickListener(contentView, R.id.ab__id_adapter_item_position) {<br>            @Override<br>            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onClickCallBack(View registedView, <span style="color: #0000ff;">int</span><span style="color: #000000;">… positionIds) {<br>                ChatAdapter.OnChatItemListener onChatItemListener </span>=<span style="color: #000000;"> adapter.getOnChatItemListener();<br>                </span><span style="color: #0000ff;">switch</span><span style="color: #000000;"> (registedView.getId()) {<br>                    </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> R.id.item_type_text_view:<br>                        </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> != onChatItemListener &amp;&amp; <span style="color: #0000ff;">null</span> != positionIds &amp;&amp; positionIds.length &gt; 0<span style="color: #000000;">) {<br>                            onChatItemListener.onItemClicked(positionIds[</span>0<span style="color: #000000;">]);<br>                        }<br>                        </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br><br>                    </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> R.id.item_type_text_head_iv:<br>                        </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> != onChatItemListener &amp;&amp; <span style="color: #0000ff;">null</span> != positionIds &amp;&amp; positionIds.length &gt; 0<span style="color: #000000;">) {<br>                            onChatItemListener.onHeadClicked(positionIds[</span>0<span style="color: #000000;">]);<br>                        }<br>                        </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br><br>                }<br><br>            }<br>        };<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 通过ABViewUtil从contentView中获取对应id的控件，然后设置OnClickListener</span><br><span style="color: #000000;">        ABViewUtil.obtainView(contentView, R.id.item_type_text_view)<br>                .setOnClickListener(onConvertViewClickListener);<br>        ABViewUtil.obtainView(contentView, R.id.item_type_text_head_iv)<br>                .setOnClickListener(onConvertViewClickListener);<br><br>    }<br><br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> ImageView headIv;<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> View rootView;<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> TextView contentTv;<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> fitDatas(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position) {<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 通过ABViewUtil从contentView中获取对应id的控件，然后设置OnClickListener</span><br>        headIv =<span style="color: #000000;"> ABViewUtil.obtainView(contentView, R.id.item_type_text_head_iv);<br>        contentTv </span>=<span style="color: #000000;"> ABViewUtil.obtainView(contentView, R.id.item_type_text_content_tv);<br>        </span><span style="color: #008000;">/</span><span style="color: #008000;"><br>         <em> 在这里适配数据到ui<br>         </em></span><span style="color: #008000;">/</span><span style="color: #000000;"><br>        Message message </span>=<span style="color: #000000;"> adapter.getItem(position);<br>        contentTv.setText(message.getContent());<br>        ImageLoader.getInstances().displayImage(message.getHeadUrl(), headIv, </span>100, <span style="color: #0000ff;">null</span><span style="color: #000000;">, R.drawable.default_head);<br><br>    }<br><br>}</span></pre><br></div>

<p>如上代码，该TypeTextRender实现了AdapterTypeRender接口，实现了其中的3个方法。注意：需要在构造方法中解析出convertView，用于提供给BaseTypeAdapter在getView中返回。</p>
<p>然后在fitEvents中注册各种事件，这里只注册了点击事件（一个rootView、一个headIv注册了点击事件）。这里的OnConvertViewClickListener是一个实现了View.OnClickListener的一个抽象类，生成一个OnConvertViewClickListener时需要传入convertView和positions的id，这样由于Render被重用后，convertView也是被重用了，导致onClickListener也是被重用了，这会导致响应点击事件的时候，回调的onClicked方法中无法得知点击的是哪个View，所以，需要把converView和positions的id传入，positions的id可以用来在convertView中绑定postion作为tag。positonsIds是一个可变长的参数，因为可能是一个ExpandableListView，需要groupPosition和childPosition两个positon来确定。回调的onClickCallBack中的参数registedView表示被点击的view，positionIds，被点击的item的positions（这个也是可以在<strong><a href="https://github.com/wangjiegulu/AndroidBucket" target="_blank" rel="noopener">AndroidBucket</a></strong>中找到，以后有时间会针对这个详细说明）。</p>
<p>&ldquo;ABViewUtil.obtainView…&rdquo;这个方法对viewHolder进行了封装，把convertView中的控件都缓存在了一个SparseArray&lt;View&gt;中（作用跟常用的ViewHolder相同）。</p>
<p>然后在fitDatas方法中就可以进行对数据的适配了，相当于我们以前在BaseAdapter的getView方法中的操作了。</p>
<p>b) TypeImageRender的实现（与TypeTextRender大同小异，不做过多的说明了）：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.activities.typerendertest.adapter;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.content.Context;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.view.LayoutInflater;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.view.View;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.ImageButton;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.ImageView;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.ProgressBar;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.TextView;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.adapter.typeadapter.AdapterTypeRender;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.adapter.listener.OnConvertViewClickListener;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.thread.ThreadPool;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.utils.ABTimeUtil;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.utils.ABViewUtil;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.imageloadersample.imageloader.ImageLoader;<br><br></span><span style="color: #008000;">/<strong></strong></span><span style="color: #008000;"><br> <em> Author: wangjie
 </em> Email: tiantian.china.2@gmail.com<br> <em> Date: 9/14/14.<br> </em></span><span style="color: #008000;">/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> ChatTypeImageRender <span style="color: #0000ff;">implements</span><span style="color: #000000;"> AdapterTypeRender {<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Context context;<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> ChatAdapter adapter;<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> View contentView;<br><br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> ChatTypeImageRender(Context context, ChatAdapter adapter) {<br>        </span><span style="color: #0000ff;">this</span>.context =<span style="color: #000000;"> context;<br>        </span><span style="color: #0000ff;">this</span>.adapter =<span style="color: #000000;"> adapter;<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 解析图片类型的布局</span><br>        contentView = LayoutInflater.from(context).inflate(R.layout.item_type_text, <span style="color: #0000ff;">null</span><span style="color: #000000;">);<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> View getConvertView() {<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 返回文本类型的布局</span><br>        <span style="color: #0000ff;">return</span><span style="color: #000000;"> contentView;<br>    }<br><br>    </span><span style="color: #008000;">/</span><span style="color: #008000;"><br>     <em> 这个方法同一个convertView只会被调用一次，所以可以放心地在这里执行事件地绑定，不用担心生成过多的OnClickListener等<br>     </em></span><span style="color: #008000;">/</span><span style="color: #000000;"><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> fitEvents() {<br>        </span><span style="color: #008000;">/<strong></strong></span><span style="color: #008000;"><br>         <em> 生成一个在convertView中使用的clickListener<br>         </em></span><span style="color: #008000;">/</span><span style="color: #000000;"><br>        OnConvertViewClickListener onConvertViewClickListener </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> OnConvertViewClickListener(contentView, R.id.ab__id_adapter_item_position) {<br>            @Override<br>            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onClickCallBack(View registedView, <span style="color: #0000ff;">int</span><span style="color: #000000;">… positionIds) {<br>                ChatAdapter.OnChatItemListener onChatItemListener </span>=<span style="color: #000000;"> adapter.getOnChatItemListener();<br>                </span><span style="color: #0000ff;">switch</span><span style="color: #000000;"> (registedView.getId()) {<br>                    </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> R.id.item_type_text_view:<br>                        </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> != onChatItemListener &amp;&amp; <span style="color: #0000ff;">null</span> != positionIds &amp;&amp; positionIds.length &gt; 0<span style="color: #000000;">) {<br>                            onChatItemListener.onItemClicked(positionIds[</span>0<span style="color: #000000;">]);<br>                        }<br>                        </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br><br>                    </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> R.id.item_type_text_head_iv:<br>                        </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> != onChatItemListener &amp;&amp; <span style="color: #0000ff;">null</span> != positionIds &amp;&amp; positionIds.length &gt; 0<span style="color: #000000;">) {<br>                            onChatItemListener.onHeadClicked(positionIds[</span>0<span style="color: #000000;">]);<br>                        }<br>                        </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br>                    </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> R.id.item_type_text_content_iv:<br>                        </span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> != onChatItemListener &amp;&amp; <span style="color: #0000ff;">null</span> != positionIds &amp;&amp; positionIds.length &gt; 0<span style="color: #000000;">) {<br>                            onChatItemListener.onImageClicked(positionIds[</span>0<span style="color: #000000;">]);<br>                        }<br>                        </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br><br>                }<br><br>            }<br>        };<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 通过ABViewUtil从contentView中获取对应id的控件，然后设置OnClickListener</span><br><span style="color: #000000;">        ABViewUtil.obtainView(contentView, R.id.item_type_text_view)<br>                .setOnClickListener(onConvertViewClickListener);<br>        ABViewUtil.obtainView(contentView, R.id.item_type_text_head_iv)<br>                .setOnClickListener(onConvertViewClickListener);<br>        ABViewUtil.obtainView(contentView, R.id.item_type_text_content_iv)<br>                .setOnClickListener(onConvertViewClickListener);<br><br>    }<br><br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> ImageView headIv;<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> View rootView;<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> ImageView contentIv;<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> fitDatas(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position) {<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 通过ABViewUtil从contentView中获取对应id的控件，然后设置OnClickListener</span><br>        headIv =<span style="color: #000000;"> ABViewUtil.obtainView(contentView, R.id.item_type_text_head_iv);<br>        contentIv </span>=<span style="color: #000000;"> ABViewUtil.obtainView(contentView, R.id.item_type_text_content_iv);<br>        </span><span style="color: #008000;">/</span><span style="color: #008000;"><br>         <em> 在这里适配数据到ui<br>         </em></span><span style="color: #008000;">/</span><span style="color: #000000;"><br>        Message message </span>=<span style="color: #000000;"> adapter.getItem(position);<br>        ImageLoader.getInstances().displayImage(message.getHeadUrl(), headIv, </span>100, <span style="color: #0000ff;">null</span><span style="color: #000000;">, R.drawable.default_head);<br>        ImageLoader.getInstances().displayImage(message.getContentUrl(), headIv, </span>100, <span style="color: #0000ff;">null</span><span style="color: #000000;">, R.drawable.default_pic);<br><br>    }<br><br>}</span></pre><br></div>

<p><strong>3. BaseTypeAdapter的实现</strong></p>
<p>到这里，我们已经定义好了各种type的Render了，现在需要在Adapter中去使用它，方法之前讲过，只要继承BaseTypeAdapter，然后实现里面的getAdapterTypeRender方法即可：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.activities.typerendertest.adapter;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.content.Context;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.adapter.typeadapter.AdapterTypeRender;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.androidbucket.adapter.typeadapter.BaseTypeAdapter;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;<br><br></span><span style="color: #008000;">/<em>*</em></span><span style="color: #008000;">
  Author: wangjie<br> <em> Email: tiantian.china.2@gmail.com
 </em> Date: 9/14/14.<br> </span><span style="color: #008000;">*/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MessageAdapter <span style="color: #0000ff;">extends</span><span style="color: #000000;"> BaseTypeAdapter {<br><br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> OnChatItemListener{<br>        </span><span style="color: #0000ff;">void</span> onImageClicked(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position);<br>        </span><span style="color: #0000ff;">void</span> onHeadClicked(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position);<br>        </span><span style="color: #0000ff;">void</span> onItemClicked(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position);<br>    }<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> OnChatItemListener onChatItemListener;<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setOnChatItemListener(OnChatItemListener onChatItemListener) {<br>        </span><span style="color: #0000ff;">this</span>.onChatItemListener =<span style="color: #000000;"> onChatItemListener;<br>    }<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> OnChatItemListener getOnChatItemListener() {<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> onChatItemListener;<br>    }<br><br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Context context;<br>    </span><span style="color: #0000ff;">private</span> List&lt;Message&gt;<span style="color: #000000;"> list;<br>    </span><span style="color: #0000ff;">public</span> List&lt;Message&gt;<span style="color: #000000;"> getList() {<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> list;<br>    }<br><br>    </span><span style="color: #0000ff;">public</span> MessageAdapter(Context context, List&lt;Message&gt;<span style="color: #000000;"> list) {<br>        </span><span style="color: #0000ff;">this</span>.context =<span style="color: #000000;"> context;<br>        </span><span style="color: #0000ff;">this</span>.list =<span style="color: #000000;"> list;<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> getCount() {<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> list.size();<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> DoctorFriendMessageViewModelProxy getItem(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position) {<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> list.get(position);<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">long</span> getItemId(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position) {<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> position;<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> getItemViewType(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position) {<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> list.get(position).getTyp();<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> getViewTypeCount() {<br>        </span><span style="color: #0000ff;">return</span> 2<span style="color: #000000;">;<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> AdapterTypeRender getAdapterTypeRender(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position){<br>        AdapterTypeRender typeRender </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;<br>        </span><span style="color: #0000ff;">switch</span><span style="color: #000000;">(getItemViewType(position)){<br>            </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> MessageConstants.MessageType.IMAGE:<br>                typeRender </span>= <span style="color: #0000ff;">new</span> ChatTypeImageRender(context, <span style="color: #0000ff;">this</span><span style="color: #000000;">);<br>                </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> MessageConstants.MessageType.TEXT:<br>            </span><span style="color: #0000ff;">default</span><span style="color: #000000;">:<br>                typeRender </span>= <span style="color: #0000ff;">new</span> ChatTypeTextRender(context, <span style="color: #0000ff;">this</span><span style="color: #000000;">);<br>                </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br>        }<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> typeRender;<br>    }<br><br>}</span></pre><br></div>

<p>如上代码所示，通过实现getAdapterTypeRender来获取对应类型的Render即可了。</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2014/07/13/Android上的MVP：如何组织显示层的内容/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/07/13/Android上的MVP：如何组织显示层的内容/" itemprop="url">Android上的MVP：如何组织显示层的内容</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-07-13T18:55:00+08:00">
                2014-07-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/07/13/Android上的MVP：如何组织显示层的内容/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/07/13/Android上的MVP：如何组织显示层的内容/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>MVP（Model View Presenter）模式是著名的MVC（Model View Controller）模式的一个演化版本，目前它在Android应用开发中越来越重要了，大家也都在讨论关于MVP的理论，只是结构化的资料非常少。这就是我写这篇博客的原因，我想鼓励大家多参与讨论，然后把MVP模式运用在项目开发中。</p>
<h3 id="什么是MVP？"><a href="#什么是MVP？" class="headerlink" title="什么是MVP？"></a>什么是MVP？</h3><p>MVP模式可以分离显示层和逻辑层，所以功能接口如何工作与功能的展示可以实现分离，MVP模式理想化地可以实现同一份逻辑代码搭配不同的显示界面。首先要澄清就是MVP不是一个结构化的模式，它只是负责显示层而已，任何时候都可以在自己的项目结构中使用MVP模式。</p>
<h3 id="为什么要使用MVP？"><a href="#为什么要使用MVP？" class="headerlink" title="为什么要使用MVP？"></a>为什么要使用MVP？</h3><p>我们知道在Android上逻辑接口和数据存取是紧耦合的，这个问题可以看看CursorAdapter这个例子，它既融合了适配器，同时也有显示的成分，而cursor很大程度上应该是数据数据存取层的。</p>
<p>对于一个可扩展、稳定的应用来说，我们需要定义各个分离层，毕竟，我们不知道以后还要加入什么逻辑，是从本地数据库检索数据？还是从远程的web Service中？</p>
<p>MVP模式可以让显示界面和数据分离，我们开发的应用可以分离至少三层，这样也可以进行独立测试。有了MVP我们就可以从Activity中分离大部分代码，而且不用单元测试可以对每个模块进行单独测试了。</p>
<h3 id="怎么在Android上实现MVP？"><a href="#怎么在Android上实现MVP？" class="headerlink" title="怎么在Android上实现MVP？"></a>怎么在Android上实现MVP？</h3><p>说到这里，问题就有点复杂了。实现MVP的方式有很多种，每个人都可以根据自己的需求和自己喜欢的方式去修正MVP的实现方式，它可以随着Presenter的复杂程度变化。</p>
<p>在View中需不需要控制进度条？或者是在Presenter处理？还有，谁来决定Action Bar该显示什么操作？这是一个艰难的决定。这里我会展示我自己的做法，但是我希望本文成为一个讨论如何应用MVP的地方，因为目前为止还没有实现MVP的标准方式。</p>
<h3 id="Presenter"><a href="#Presenter" class="headerlink" title="Presenter"></a>Presenter</h3><p>Presenter主要作为沟通View和Model的桥梁，它从Model层检索数据后，返回给View层，但是不想典型的MVC结构，因为它也可以决定与View层的交互操作。</p>
<h3 id="View"><a href="#View" class="headerlink" title="View"></a>View</h3><p>View通常来说是由Activity实现的（也许是Fragment，VIew，取决于app的整体结构），它会包含一个Presenter的引用，最理想的是Presenter由一个依赖注入管理器提供，比如<a href="http://square.github.io/dagger/" target="_blank" rel="noopener">Dagger</a>，不过如果不用注入器的话，就需要独立创建Presenter对象了。View要做的就只是在每次有接口调用的时候（比如按钮点击后）调用Presenter的方法。</p>
<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><p>对于一个结构化的APP来说，Model主要是通向主领域层或者逻辑层的通道，如果使用了<a href="http://blog.8thlight.com/uncle-bob/2012/08/13/the-clean-architecture.html" target="_blank" rel="noopener">Uncle Bob clean architecture</a>的话，Model就可能是一个实现了用例场景的交互工具，这也是我将要在另一篇文章中讨论的一个主题。现在，只要把它看做是给View提供数据的容器就对了。</p>
<h3 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h3><p>鉴于已经解释的太长了，本人写了一个例子<a href="https://github.com/antoniolg/androidmvp" target="_blank" rel="noopener">an MVP example on Github</a>，由一个登录界面组成，可以验证数据然后进入一个带有列表的主界面，数据来自Model，因为比较简单，所以本文就不讲代码了，但是如果读者觉得还是很难理解的话，我还可以再写一篇文章详细介绍。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>在Android上要分离接口和逻辑不容易实现，但是Model-View-Presenter模式可以更简单的防止在Activity中掺杂太多代码在大的项目中，组织好代码结构是最基本的要求，不然，代码的稳定和扩展就很困难了。</p>
<p>&nbsp;</p>
<p>原文链接：&nbsp;<a href="http://antonioleiva.com/mvp-android/" target="_blank" rel="noopener">antonioleiva</a>&nbsp;&nbsp;&nbsp;翻译：&nbsp;<a href="http://blog.jobbole.com/" target="_blank" rel="noopener">伯乐在线&nbsp;</a>-&nbsp;<a href="http://blog.jobbole.com/author/chris/" target="_blank" rel="noopener">chris</a><br>译文链接：&nbsp;<a href="http://blog.jobbole.com/71209/" target="_blank" rel="noopener">http://blog.jobbole.com/71209/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2014/07/03/Android-解决ClickableSpan中点击后ListView中item的长按冲突的问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/07/03/Android-解决ClickableSpan中点击后ListView中item的长按冲突的问题/" itemprop="url">[Android]解决ClickableSpan中点击后ListView中item的长按冲突的问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-07-03T22:17:00+08:00">
                2014-07-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/07/03/Android-解决ClickableSpan中点击后ListView中item的长按冲突的问题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/07/03/Android-解决ClickableSpan中点击后ListView中item的长按冲突的问题/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #ff0000;"><strong>以下内容为原创，转载请注明：</strong></span></p>
<p><span style="color: #ff0000;"><strong>来自天天博客：<a href="http://www.cnblogs.com/tiantianbyconan/p/3823429.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiantianbyconan/p/3823429.html</a></strong></span></p>
<p>&nbsp;</p>
<p>项目中碰到一个问题，情景是这样的：</p>
<p>有一个ListView，每个item中有一个TextView，这个TextView实现了LongClick事件，这个TextView中又添加了ClickableSpan，实现了方法onClick。</p>
<p>我的需求是点击ClickableSpan，则响应ClickableSpan事件；长按ClickableSpan效果跟长按TextView应该一样，都响应TextView的LongClick事件。</p>
<p>然而结果是点击ClickableSpan响应正常；但是长按ClickableSpan时问题出现了：TextView的长按事件响应了，ClickableSpan点击事件也响应了！</p>
<p>研究了一下代码，解决方法如下：</p>
<p>继承LinkMovementMethod，然后重写里面的onTouchEvent方法，在里面判断，如果当前是长按的状态，则不执行ClickableSpan的onClick事件：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.kanchufang.privatedoctor.util.spannableparser;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.text.Layout;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.text.Selection;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.text.Spannable;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.text.method.LinkMovementMethod;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.text.style.ClickableSpan;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.view.MotionEvent;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.TextView;<br><br></span><span style="color: #008000;">/<em>*</em></span><span style="color: #008000;">
  Author: wangjie<br> <em> Email: tiantian.china.2@gmail.com
 </em> Date: 7/3/14.<br> </span><span style="color: #008000;">*/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LinkMovementClickMethod <span style="color: #0000ff;">extends</span><span style="color: #000000;"> LinkMovementMethod{<br><br>    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">long</span><span style="color: #000000;"> lastClickTime;<br><br>    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">long</span> CLICK_DELAY = 500l<span style="color: #000000;">;<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> onTouchEvent(TextView widget, Spannable buffer, MotionEvent event) {<br>        </span><span style="color: #0000ff;">int</span> action =<span style="color: #000000;"> event.getAction();<br><br>        </span><span style="color: #0000ff;">if</span> (action == MotionEvent.ACTION_UP ||<span style="color: #000000;"><br>                action </span>==<span style="color: #000000;"> MotionEvent.ACTION_DOWN) {<br>            </span><span style="color: #0000ff;">int</span> x = (<span style="color: #0000ff;">int</span><span style="color: #000000;">) event.getX();<br>            </span><span style="color: #0000ff;">int</span> y = (<span style="color: #0000ff;">int</span><span style="color: #000000;">) event.getY();<br><br>            x </span>-=<span style="color: #000000;"> widget.getTotalPaddingLeft();<br>            y </span>-=<span style="color: #000000;"> widget.getTotalPaddingTop();<br><br>            x </span>+=<span style="color: #000000;"> widget.getScrollX();<br>            y </span>+=<span style="color: #000000;"> widget.getScrollY();<br><br>            Layout layout </span>=<span style="color: #000000;"> widget.getLayout();<br>            </span><span style="color: #0000ff;">int</span> line =<span style="color: #000000;"> layout.getLineForVertical(y);<br>            </span><span style="color: #0000ff;">int</span> off =<span style="color: #000000;"> layout.getOffsetForHorizontal(line, x);<br><br>            ClickableSpan[] link </span>= buffer.getSpans(off, off, ClickableSpan.<span style="color: #0000ff;">class</span><span style="color: #000000;">);<br><br>            </span><span style="color: #0000ff;">if</span> (link.length != 0<span style="color: #000000;">) {<br>                </span><span style="color: #0000ff;">if</span> (action ==<span style="color: #000000;"> MotionEvent.ACTION_UP) {<br>                    </span><span style="color: #0000ff;">if</span>(System.currentTimeMillis() - lastClickTime &lt;<span style="color: #000000;"> CLICK_DELAY){<br>                        link[</span>0<span style="color: #000000;">].onClick(widget);<br>                    }<br>                } </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (action ==<span style="color: #000000;"> MotionEvent.ACTION_DOWN) {<br>                    Selection.setSelection(buffer,<br>                            buffer.getSpanStart(link[</span>0<span style="color: #000000;">]),<br>                            buffer.getSpanEnd(link[</span>0<span style="color: #000000;">]));<br>                    lastClickTime </span>=<span style="color: #000000;"> System.currentTimeMillis();<br>                }<br><br>                </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;<br>            } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {<br>                Selection.removeSelection(buffer);<br>            }<br>        }<br>        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">super</span><span style="color: #000000;">.onTouchEvent(widget, buffer, event);<br>    }<br><br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> LinkMovementClickMethod getInstance(){<br>        </span><span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> sInstance){<br>            sInstance </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> LinkMovementClickMethod();<br>        }<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> sInstance;<br>    }<br><br>    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> LinkMovementClickMethod sInstance;<br><br>}</span></pre><br></div>

<p>代码很简单，按住超过500ms，则认定为是长按，则不执行ClickableSpan的onClick</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2014/07/01/Android-竖直滑动选择器WheelView的实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/07/01/Android-竖直滑动选择器WheelView的实现/" itemprop="url">[Android]竖直滑动选择器WheelView的实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-07-01T23:37:00+08:00">
                2014-07-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/07/01/Android-竖直滑动选择器WheelView的实现/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/07/01/Android-竖直滑动选择器WheelView的实现/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #ff0000;"><strong>以下内容为原创，转载请注明：</strong></span></p>
<p><span style="color: #ff0000;"><strong>来自天天博客：<a href="http://www.cnblogs.com/tiantianbyconan/p/3819304.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiantianbyconan/p/3819304.html&nbsp;</a></strong></span></p>
<p>&nbsp;</p>
<p>公司项目中有这么一个需求，所以需要自己实现下。效果类似android4.0以上原生的DatePicker这种。</p>
<p>这个WheelView控件我已经放在github上了，大家有兴趣可以看看，地址：<a href="https://github.com/wangjiegulu/WheelView" target="_blank" rel="noopener">https://github.com/wangjiegulu/WheelView</a>，欢迎Star或者Fork哦！（建库的时候忘了选ignore了－－，所以有些gen什么的直接无视掉，我也懒得改了－－）</p>
<p>&nbsp;</p>
<p>先贴上效果图：</p>
<p><img src="http://images.cnitblog.com/i/378300/201407/012249013099471.png" alt="">&nbsp;<img src="http://images.cnitblog.com/i/378300/201407/012249532936951.png" alt="">&nbsp;<img src="http://images.cnitblog.com/i/378300/201407/012251028875647.png" alt=""></p>
<p>&nbsp;</p>
<p>讲下思路吧，因为这是一个滚动选择器，所以首先想到的是可以基于ListView或者ScrollView自定义。</p>
<p>刚开始我用的是继承ListView来实现，把滑动选择的每个item作为listview中的一个item，然后根据FirstVisiblePosition、LastVisiblePosition来判断某个item是否在选中的区域，但是后来发现偶尔有时候调用getFirstVisiblePosition和getLastVisiblePosition的结果跟我看到的界面显示的item并不一致（我是在Adapter中调用的这两个方法），后来分析可能是因为我调用了scrollTo后没有刷新adapter的原因吧。</p>
<p>再后来，就打算使用ScrollView来实现了，其中的每个item都是一个View（我这里使用了TextView）。因为这个选中框是在中间的位置，所以刚启动时第一个item应该需要在中间选中框显示，所以前面应该使用空白补全。最后一个也是如此，后面也需要空白补全。</p>
<p>在滑动过程中需要实现这种场景：滑动结束后，必须且只有一个item完整显示在选择框中。所以我们必须要监听滚动停止的事件，然后在滚动停止后判断是不是满足前面的场景，如果没有，则需要代码中实现滚动到正确位置。但是，蛋疼的是，sdk中竟然没有提供原生的监听滚动停止的api，然后在网上找了很久，得到的结果是只能另辟蹊径，使用了<a href="http://stackoverflow.com/questions/8181828/android-detect-when-scrollview-stops-scrolling/10198865#10198865" target="_blank" rel="noopener">stackoverflow</a>一个网友的做法通过主动检测是否停止滚动的方法去实现（总觉得方法有点坑，额 好吧 但是暂时先用了这个方法）。</p>
<p>思路就讲到这里了。</p>
<p>&nbsp;</p>
<p>使用方式：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008000;">/<em>*</em></span><span style="color: #008000;">
  Author: wangjie<br> <em> Email: tiantian.china.2@gmail.com
 </em> Date: 7/1/14.<br> </span><span style="color: #008000;">*/</span><span style="color: #000000;"><br>@AILayout(R.layout.main)<br></span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MainActivity <span style="color: #0000ff;">extends</span><span style="color: #000000;"> AIActivity {<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> String TAG = MainActivity.<span style="color: #0000ff;">class</span><span style="color: #000000;">.getSimpleName();<br><br>    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> String[] PLANETS = <span style="color: #0000ff;">new</span> String[]{“Mercury”, “Venus”, “Earth”, “Mars”, “Jupiter”, “Uranus”, “Neptune”, “Pluto”<span style="color: #000000;">};<br><br>    @AIView(R.id.main_wv)<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> WheelView wva;<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onCreate(Bundle savedInstanceState) {<br>        </span><span style="color: #0000ff;">super</span><span style="color: #000000;">.onCreate(savedInstanceState);<br><br>        wva.setOffset(</span>1<span style="color: #000000;">);<br>        wva.setItems(Arrays.asList(PLANETS));<br>        wva.setOnWheelViewListener(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> WheelView.OnWheelViewListener() {<br>            @Override<br>            </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onSelected(<span style="color: #0000ff;">int</span><span style="color: #000000;"> selectedIndex, String item) {<br>                Logger.d(TAG, </span>“selectedIndex: “ + selectedIndex + “, item: “ +<span style="color: #000000;"> item);<br>            }<br>        });<br><br>    }<br><br>    @AIClick({R.id.main_show_dialog_btn})<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onClickCallbackSample(View view) {<br>        </span><span style="color: #0000ff;">switch</span><span style="color: #000000;"> (view.getId()) {<br>            </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> R.id.main_show_dialog_btn:<br>                View outerView </span>= LayoutInflater.from(context).inflate(R.layout.wheel_view, <span style="color: #0000ff;">null</span><span style="color: #000000;">);<br>                WheelView wv </span>=<span style="color: #000000;"> (WheelView) outerView.findViewById(R.id.wheel_view_wv);<br>                wv.setOffset(</span>2<span style="color: #000000;">);<br>                wv.setItems(Arrays.asList(PLANETS));<br>                wv.setSeletion(</span>3<span style="color: #000000;">);<br>                wv.setOnWheelViewListener(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> WheelView.OnWheelViewListener() {<br>                    @Override<br>                    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onSelected(<span style="color: #0000ff;">int</span><span style="color: #000000;"> selectedIndex, String item) {<br>                        Logger.d(TAG, </span>“[Dialog]selectedIndex: “ + selectedIndex + “, item: “ +<span style="color: #000000;"> item);<br>                    }<br>                });<br><br>                </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> AlertDialog.Builder(context)<br>                        .setTitle(</span>“WheelView in Dialog”<span style="color: #000000;">)<br>                        .setView(outerView)<br>                        .setPositiveButton(</span>“OK”, <span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>                        .show();<br><br>                </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br>        }<br>    }<br><br>}</span></pre><br></div>

<p>&nbsp;</p>
<p>注意：这个Demo只是一个临时解决方案，比较适合选项较少的时候使用，比如选择性别、星期等。因为里面的买个item都是一个单独的View，并没有去实现View的缓存和重用，所以大家这点需要注意下。如果有时间我会完善优化这个代码，实现View的复用。关于View的复用，大家可以fork后自己尝试改写，我讲下主要的思路（我的思路，当然不能代表是最优的方案）是：假设，每页显示5个item以供选择，那么刚开始加载时，先生成6个item，其中6个是正常的6个选项所new出来的item，注意！因为每页显示5个item，所以第6个item不可见，但是却已经new出来了，其实可以正常显示。然后往下滚动时，监听滚动事件，第6个完全显示时，这个时候第一个item已经不可见了，所以可以重用该item的view。所以如果往下滚要显示第7个item时，重用第一个item的view，作为第7个item的view显示数据。再往下也是一样。总之，重用当前不可见的item的view给即将显示的item。</p>
<p>&nbsp;</p>
<p>注意：项目使用到了一部分注解、日志方面的东西，跟实现WheelView没关系，但是可以简化代码，提高编码效率</p>
<p>AndroidInject：<a href="https://github.com/wangjiegulu/androidInject" target="_blank" rel="noopener">https://github.com/wangjiegulu/androidInject</a></p>
<p>AndroidBucket：<a href="https://github.com/wangjiegulu/AndroidBucket" target="_blank" rel="noopener">https://github.com/wangjiegulu/AndroidBucket</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2014/06/07/Android无线调试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/06/07/Android无线调试/" itemprop="url">Android无线调试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-06-07T18:33:00+08:00">
                2014-06-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/06/07/Android无线调试/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/06/07/Android无线调试/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>方法一：</p>
<p>1. 使用USB数据线连接设备。</p>
<p>2. 命令输入adb tcpip 5555 ( 5555为端口号，可以自由指定）。</p>
<p>3. 断开 USB数据，此时可以连接你需要连接的|USB设备。</p>
<p>4. 再命令输入 adb connect &lt;设备的IP地址&gt;:5555</p>
<p>后面就可以使用ADB ，DDMS 来调试Android应用或显示Logcat 消息。</p>
<p>5. 如果需要恢复到USB数据线，可以在命令行输入adb usb</p>
<p>注： Android设备的IP地址可以在Settings-&gt;About Phone-&gt;Status 查到</p>
<p>参考：<a href="http://blog.csdn.net/daditao/article/details/19077281" target="_blank" rel="noopener">http://blog.csdn.net/daditao/article/details/19077281</a></p>
<p>&nbsp;</p>
<p>方法二：</p>
<p><span>首先让手机与电脑处于同一局域网下，然后下载一款名为adbWireless的应用（到Google Play商店可以搜索到），下载安装后运行软件，会显示手机在当前局域网的IP地址和端口（前提是手机需要ROOT），然后可以看到手机出现了IP地址和端口号。</span></p>
<p><span><span>随后打开命令行，进入安装SDK的目录中platform-tools文件夹并输入：adb connect 手机IP地址（我的是192.168.1.110）</span></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2014/06/04/IOS-《A-Swift-Tour》翻译（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/06/04/IOS-《A-Swift-Tour》翻译（一）/" itemprop="url">[IOS]《A Swift Tour》翻译（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-06-04T23:06:00+08:00">
                2014-06-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/06/04/IOS-《A-Swift-Tour》翻译（一）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/06/04/IOS-《A-Swift-Tour》翻译（一）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #ff0000;"><strong>以下翻译内容为原创，转载请注明：</strong></span></p>
<p><span style="color: #ff0000;"><strong>来自天天博客：<a href="http://www.cnblogs.com/tiantianbyconan/p/3768936.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiantianbyconan/p/3768936.html</a></strong></span></p>
<p>&nbsp;</p>
<p>碎碎念。。。</p>
<p>Swift是苹果在WWDC刚发布的新语言，本人也没学过，现在看苹果官方文档一边翻译一边学习，再加上英语水平和对编程理解很有限，有错误的地方请大家指出，翻译只供参考，建议阅读<a href="https://developer.apple.com/library/prerelease/ios/documentation/Swift/Conceptual/Swift_Programming_Language/GuidedTour.html#//apple_ref/doc/uid/TP40014097-CH2-XID_1" target="_blank" rel="noopener">苹果Swift官方的文档</a></p>
<p>&nbsp;</p>
<p><span class="s1">Swift 之旅</span></p>
<p><span class="s1">按照传统，在开始学习一门新的语言时写的第一个程序应该是在屏幕上打印&ldquo;Hello, World&rdquo;，这个可以用一行来完成：</span></p>
<p>&nbsp;</p>
<p><span class="s1">print(&ldquo;Hello, world&rdquo;)</span></p>
<p>&nbsp;</p>
<p><span class="s1">&nbsp;如果你有写过C或者Objective-C的经验，这个语法你应该会感觉很熟悉&mdash;&mdash;在Swift中，这行代码就是一个完整的程序。你不需要像输入输出流或者字符串处理等那样去导入另外的具有功能性的库。在全局范围编写的代码即是程序的入口点，所以你不需要一个main方法。你也不需要在每个语句后面写上分号。</span></p>
<p><span class="s1">&nbsp; &nbsp; 这个旅程会带给你足够的信息让你用Swift来完成各种编程任务。不用担心你是否懂得一些编程&mdash;&mdash;这本书对各个方面都进行来详细的介绍。</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>基本数据</p>
<p><span class="s1">&nbsp; &nbsp; 使用let来表示一个常量，使用var来表示一个变量。常量的值不需要在编译时期被知道，但是你必须且只能一次分配一个值给它。这表示你一旦给这个常量分配了一个值，你就能在很多地方使用它了。</span></p>
<p>&nbsp;</p>
<p><span class="s1">var myVariable = 42;</span></p>
<p><span class="s1">myVariable = 50;</span></p>
<p><span class="s1">let myConstant = 42;</span></p>
<p>&nbsp;</p>
<p><span class="s1">一个常量或者变量的类型必须要跟你分配给它的值的类型一致。然而，你一般不需要精确的写明它的类型。当你创建了一个常量或者变量，并赋值后，编译器会自动推断出它的类型。比如在上面的例子中，编译器会推断出myVariable是一个integer，因为它的初始值就是一个integer。</span></p>
<p><span class="s1">如果初始值不能提供足够的信息（或者它根本没有初始值），可以在这个变量后面加上冒号，然后写上指定类型。</span></p>
<p>&nbsp;</p>
<p><span class="s1">let implicitInteger = 70</span></p>
<p><span class="s1">let implicitDouble = 70.0</span></p>
<p><span class="s1">let explicitDouble: Double = 70</span></p>
<p>&nbsp;</p>
<p><span class="s1">值不会隐式地被转换成另一种类型。如果你需要转换成一个不同类型的值，显示地生成一个期望类型的实例。</span></p>
<p>&nbsp;</p>
<p><span class="s1">let label = &ldquo;The width is &rdquo;</span></p>
<p><span class="s1">let width = 94</span></p>
<p><span class="s1">let widthLabel = label + String(width)</span></p>
<p>&nbsp;</p>
<p><span class="s1">还有一个更简单的方法，在字符串中包含变量值：写一对括号里面写一个变量值，然后在括号前面写一个反斜杠，举个例子：</span></p>
<p>&nbsp;</p>
<p><span class="s1">let apples = 3</span></p>
<p><span class="s1">let oranges = 5</span></p>
<p><span class="s1">let appleSummary = &ldquo;I have (apples) apples.&rdquo;</span></p>
<p><span class="s1">let fruitSummary = &ldquo;I have (apples + oranges) pieces of fruit.&rdquo;</span></p>
<p>&nbsp;</p>
<p><span class="s1">使用中括号（[]）来创建一个数组或者字典，使用index（索引）或者key（键）访问他们的某一项。</span></p>
<p>&nbsp;</p>
<p><span class="s1">var shoppingList = [&ldquo;catfish&rdquo;, &ldquo;water&rdquo;, &ldquo;tulips&rdquo;, &ldquo;blue paint&rdquo;]</span></p>
<p><span class="s1">shoppingList[1] = &ldquo;bottle of water&rdquo;</span></p>
<p><span class="s1">var occupations = [</span></p>
<p><span class="s1">&ldquo;Malcolm&rdquo;: &ldquo;Captain&rdquo;,</span></p>
<p><span class="s1">&ldquo;Kaylee&rdquo;: &ldquo;Mechanic&rdquo;,</span></p>
<p><span class="s1">]</span></p>
<p><span class="s1">occupations[&ldquo;Jayne&rdquo;] = &ldquo;Public Relations&rdquo;</span></p>
<p>&nbsp;</p>
<p><span class="s1">使用初始化器的语法来创建一个空的数组或者字典。</span></p>
<p>&nbsp;</p>
<p><span class="s1">let emptyArray = String<a href=""></a></span></p>
<p><span class="s1">let emptyDictionary = Dictionary&lt;String, Float&gt;()</span></p>
<p>&nbsp;</p>
<p><span class="s1">如果类型信息是可推断的，你可以使用[]创建一个空的数组，使用[:]来创建一个空的字典，举个例子，当你设置一个新的值或者往方法中传入一个变量作为参数</span></p>
<p>&nbsp;</p>
<p><span class="s1">shoppingList = []</span></p>
<p>&nbsp;</p>
<p><span class="s1">控制语句</span></p>
<p><span class="s1">使用if和switch来创建一个条件，使用for-in，for，while和do-while来创建一个循环。</span></p>
<p><span class="s1">条件和循环变量上的括号是可选的。if后面大括号和循环体的大括号是必须的。</span></p>
<p>&nbsp;</p>
<p><span class="s1">let individualScores = [75, 43, 103, 87, 12]</span></p>
<p><span class="s1">var teamScore = 0</span></p>
<p><span class="s1">for score in individualScores{</span></p>
<p><span class="s1">if score &gt; 50{</span></p>
<p><span class="s1">teamScore += 3</span></p>
<p><span class="s1">}else{</span></p>
<p><span class="s1">teamScore += 1</span></p>
<p><span class="s1">}</span></p>
<p><span class="s1">}</span></p>
<p><span class="s1">teamScore</span></p>
<p>&nbsp;</p>
<p><span class="s1">在一个if语句中，条件必须是一个布尔类型的表达式&mdash;&mdash;这表示像if score { &hellip; }这样的代码是错误的，这个score并不是隐式地去跟0比较。</span></p>
<p>&nbsp;</p>
<p><span class="s1">你可以在值可能为空的时候同时使用if和let。这些值就被表示为可选地。一个可选的值可能包含一个值或者包含一个nil，nil表示这个值是空。在这个值的类型后面写上一个疑问符号（?）可以把这个值标记为可选的。</span></p>
<p>&nbsp;</p>
<p><span class="s1">var optionalString: String? = &ldquo;Hello&rdquo;</span></p>
<p><span class="s1">optionalString == nil</span></p>
<p>&nbsp;</p>
<p><span class="s1">var optionalName: String? = &ldquo;John Appleseed&rdquo;</span></p>
<p><span class="s1">var greeting = &ldquo;Hello!&rdquo;</span></p>
<p><span class="s1">if let name = optionalName{</span></p>
<p><span class="s1">greeting = &ldquo;Hello, (name)&rdquo;</span></p>
<p><span class="s1">}</span></p>
<p>&nbsp;</p>
<p><span class="s1">如果可选值是nil，那么这个条件就为false，大括号中代码就会跳过。否则，可选值执行后面代码块中的代码并分配给let后面的常数。</span></p>
<p><span class="s1">Switches支持各种数据和各种各样的比较操作&mdash;&mdash;它们不局限于integers和相等式的比较。</span></p>
<p>&nbsp;</p>
<p><span class="s1">let vegetable = &ldquo;red pepper&rdquo;</span></p>
<p><span class="s1">switch vegetable{</span></p>
<p><span class="s1">case &ldquo;celery&rdquo;:</span></p>
<p><span class="s1">let vegetableComment = &ldquo;Add some raisins and make ants on a log.&rdquo;</span></p>
<p><span class="s1">case &ldquo;cucumber&rdquo;, &ldquo;watercress&rdquo;:</span></p>
<p><span class="s1">let vegetableComment = &ldquo;That would make a good tea sandwich.&rdquo;</span></p>
<p><span class="s1">case let x where x.hasSuffix(&ldquo;pepper&rdquo;):</span></p>
<p><span class="s1">let vegetableComment = &ldquo;Is it a spicy (x)?&rdquo;</span></p>
<p><span class="s1">default:</span></p>
<p><span class="s1">let vegetableComment = &ldquo;Everything tastes good in soup.&rdquo;</span></p>
<p><span class="s1">}</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span class="s1">在匹配的case中执行完代码后，程序退出switch语句。执行不会在下一个case中继续，所以不需要显示的在每个cases中的最后依次写上跳出该switch的break语句。</span></p>
<p><span class="s1">你可以使用for-in语句来迭代键值对形式的字典中的所有items。</span></p>
<p>&nbsp;</p>
<p><span class="s1">let interestingNumbers = [</span></p>
<p><span class="s1">&ldquo;Prime&rdquo;: [2, 3, 5, 7, 11, 13],</span></p>
<p><span class="s1">&ldquo;Fibonacci&rdquo;: [1, 1, 2, 3, 5, 8],</span></p>
<p><span class="s1">&ldquo;Square&rdquo;: [1, 4, 9, 16, 25],</span></p>
<p><span class="s1">]</span></p>
<p><span class="s1">var largest = 0</span></p>
<p><span class="s1">for(kind, numbers) in interestingNumbers{</span></p>
<p><span class="s1">for number in numbers{</span></p>
<p><span class="s1">if number &gt; largest{</span></p>
<p><span class="s1">largest = number</span></p>
<p><span class="s1">}</span></p>
<p><span class="s1">}</span></p>
<p><span class="s1">}</span></p>
<p><span class="s1">largest</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span class="s1">使用while来重复代码块中的代码，直到条件改变。循环条件也可以放在最后，可以确保这个循环至少执行一次。</span></p>
<p>&nbsp;</p>
<p><span class="s1">var n = 2</span></p>
<p><span class="s1">while n &lt; 100{</span></p>
<p><span class="s1">n = n * 2</span></p>
<p><span class="s1">}</span></p>
<p><span class="s1">n</span></p>
<p>&nbsp;</p>
<p><span class="s1">var m = 2</span></p>
<p><span class="s1">do{</span></p>
<p><span class="s1">m = m * 2</span></p>
<p><span class="s1">} while m &lt; 100</span></p>
<p><span class="s1">m</span></p>
<p>&nbsp;</p>
<p><span class="s1">你可以在循环中保持一个索引index&mdash;&mdash;通过使用..来限定一个索引范围或者指明初始值，条件和增量。下面两个结果一样的循环：</span></p>
<p>&nbsp;</p>
<p><span class="s1">var firstForLoop = 0</span></p>
<p><span class="s1">for i in 0..3{</span></p>
<p><span class="s1">firstForLoop += i</span></p>
<p><span class="s1">}</span></p>
<p><span class="s1">firstForLoop</span></p>
<p>&nbsp;</p>
<p><span class="s1">var secondForLoop = 0</span></p>
<p><span class="s1">for var i = 0; i &lt; 3; ++i{</span></p>
<p><span class="s1">secondForLoop += 1</span></p>
<p><span class="s1">}</span></p>
<p><span class="s1">secondForLoop</span></p>
<p>&nbsp;</p>
<p><span class="s1">使用..来限定范围会省略范围的上限值，使用…来限定范围会包含所有限定值。（译者注：..是左闭右开整数区间，&hellip;是左闭右闭整数区间）</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2014/05/19/Android-Property-Animation动画/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/05/19/Android-Property-Animation动画/" itemprop="url">Android Property Animation动画</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-05-19T23:18:00+08:00">
                2014-05-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/05/19/Android-Property-Animation动画/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/05/19/Android-Property-Animation动画/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>3.0以前，android支持两种动画模式，tween animation,frame animation，在android3.0中又引入了一个新的动画系统：property animation，这三种动画模式在SDK中被称为property animation,view animation,drawable animation。 可通过<a href="http://nineoldandroids.com/" title="NineOldAndroids" target="_blank" rel="noopener">NineOldAndroids</a>项目在3.0之前的系统中使用Property Animation</p>
<h1 id="1-View-Animation（Tween-Animation）"><a href="#1-View-Animation（Tween-Animation）" class="headerlink" title="1. View Animation（Tween Animation）"></a>1. View Animation（Tween Animation）</h1><p>　　View Animation（Tween Animation）：补间动画，给出两个关键帧，通过一些算法将给定属性值在给定的时间内在两个关键帧间渐变。</p>
<p>　　View animation只能应用于View对象，而且只支持一部分属性，如支持缩放旋转而不支持背景颜色的改变。</p>
<p>　　而且对于View animation，它只是改变了View对象绘制的位置，而没有改变View对象本身，比如，你有一个Button，坐标（100,100），Width:200,Height:50，而你有一个动画使其变为Width：100，Height：100，你会发现动画过程中触发按钮点击的区域仍是(100,100)-(300,150)。</p>
<p>　　View Animation就是一系列View形状的变换，如大小的缩放，透明度的改变，位置的改变，动画的定义既可以用代码定义也可以用XML定义，当然，建议用XML定义。</p>
<p>　　可以给一个View同时设置多个动画，比如从透明至不透明的淡入效果，与从小到大的放大效果，这些动画可以同时进行，也可以在一个完成之后开始另一个。</p>
<p>　　用XML定义的动画放在/res/anim/文件夹内，XML文件的根元素可以为&lt;alpha&gt;,&lt;scale&gt;,&lt;translate&gt;,&lt;rotate&gt;,interpolator元素或&lt;set&gt;(表示以上几个动画的集合，set可以嵌套)。默认情况下，所有动画是同时进行的，可以通过startOffset属性设置各个动画的开始偏移（开始时间）来达到动画顺序播放的效果。</p>
<p>　　可以通过设置interpolator属性改变动画渐变的方式，如AccelerateInterpolator，开始时慢，然后逐渐加快。默认为AccelerateDecelerateInterpolator。</p>
<p>　　定义好动画的XML文件后，可以通过类似下面的代码对指定View应用动画。</p>
<div class="cnblogs_code"><br><pre>ImageView spaceshipImage = (ImageView)findViewById(R.id.spaceshipImage);<br>Animation hyperspaceJumpAnimation=AnimationUtils.loadAnimation(<span>this</span>, R.anim.hyperspace_jump);<br>spaceshipImage.startAnimation(hyperspaceJumpAnimation);</pre><br></div>

<h1 id="2-Drawable-Animation（Frame-Animation）"><a href="#2-Drawable-Animation（Frame-Animation）" class="headerlink" title="2. Drawable Animation（Frame Animation）"></a>2. Drawable Animation（Frame Animation）</h1><p>　　Drawable Animation（Frame Animation）：帧动画，就像GIF图片，通过一系列Drawable依次显示来模拟动画的效果。在XML中的定义方式如下：</p>
<pre class="brush: xml; auto-links: true; collapse: false; first-line: 1; gutter: true; html-script: false; light: false; ruler: false; smart-tabs: true; tab-size: 4; toolbar: true;">&lt;animation-list xmlns:android="http://schemas.android.com/apk/res/android"
    android:oneshot="true"&gt;
    &lt;item android:drawable="@drawable/rocket_thrust1" android:duration="200" /&gt;
    &lt;item android:drawable="@drawable/rocket_thrust2" android:duration="200" /&gt;
    &lt;item android:drawable="@drawable/rocket_thrust3" android:duration="200" /&gt;
&lt;/animation-list&gt;</pre>

<p>　　必须以&lt;animation-list&gt;为根元素，以&lt;item&gt;表示要轮换显示的图片，duration属性表示各项显示的时间。XML文件要放在/res/drawable/目录下。示例：</p>
<div class="cnblogs_code"><br><pre><span>protected</span> <span>void</span> onCreate(Bundle savedInstanceState) {<br>        <span>//</span><span> TODO Auto-generated method stub</span><span><br></span>        <span>super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.main);<br>        imageView = (ImageView) findViewById(R.id.imageView1);<br>        imageView.setBackgroundResource(R.drawable.drawable_anim);<br>        anim = (AnimationDrawable) imageView.getBackground();<br>    }<br><br>    <span>public</span> <span>boolean</span> onTouchEvent(MotionEvent event) {<br>        <span>if</span> (event.getAction() == MotionEvent.ACTION_DOWN) {<br>            anim.stop();<br>            anim.start();<br>            <span>return</span> <span>true</span>;<br>        }<br>        <span>return</span> <span>super</span>.onTouchEvent(event);<br>    }</pre><br></div>

<p>　　我在实验中遇到两点问题：</p>
<ol>
<li>要在代码中调用Imageview的setBackgroundResource方法，如果直接在XML布局文件中设置其src属性当触发动画时会FC。</li>
<li>在动画start()之前要先stop()，不然在第一次动画之后会停在最后一帧，这样动画就只会触发一次。</li>
<li>最后一点是SDK中提到的，不要在onCreate中调用start，因为AnimationDrawable还没有完全跟Window相关联，如果想要界面显示时就开始动画的话，可以在onWindowFoucsChanged()中调用start()。</li>
</ol>
<h1 id="3-Property-Animation"><a href="#3-Property-Animation" class="headerlink" title="3. Property Animation"></a>3. Property Animation</h1><p>　　属性动画，这个是在Android 3.0中才引进的，以前学WPF时里面的动画机制好像就是这个，它更改的是对象的实际属性，在View Animation（Tween Animation）中，其改变的是View的绘制效果，真正的View的属性保持不变，比如无论你在对话中如何缩放Button的大小，Button的有效点击区域还是没有应用动画时的区域，其位置与大小都不变。而在Property Animation中，改变的是对象的实际属性，如Button的缩放，Button的位置与大小属性值都改变了。而且Property Animation不止可以应用于View，还可以应用于任何对象。Property Animation只是表示一个值在一段时间内的改变，当值改变时要做什么事情完全是你自己决定的。</p>
<p>在Property Animation中，可以对动画应用以下属性：</p>
<ul>
<li>Duration：动画的持续时间</li>
<li>TimeInterpolation：属性值的计算方式，如先快后慢</li>
<li>TypeEvaluator：根据属性的开始、结束值与TimeInterpolation计算出的因子计算出当前时间的属性值</li>
<li>Repeat Count and behavoir：重复次数与方式，如播放3次、5次、无限循环，可以此动画一直重复，或播放完时再反向播放</li>
<li>Animation sets：动画集合，即可以同时对一个对象应用几个动画，这些动画可以同时播放也可以对不同动画设置不同开始偏移</li>
<li>Frame refreash delay：多少时间刷新一次，即每隔多少时间计算一次属性值，默认为10ms，最终刷新时间还受系统进程调度与硬件的影响</li>
</ul>
<h2 id="3-1-Property-Animation的工作方式"><a href="#3-1-Property-Animation的工作方式" class="headerlink" title="3.1 Property Animation的工作方式"></a>3.1 Property Animation的工作方式</h2><p>　　对于下图的动画，这个对象的X坐标在40ms内从0移动到40 pixel.按默认的10ms刷新一次，这个对象会移动4次，每次移动40/4=10pixel。</p>
<p><img src="http://pic002.cnblogs.com/images/2011/168097/2011120119185844.png" alt=""></p>
<p>　　也可以改变属性值的改变方法，即设置不同的interpolation，在下图中运动速度先逐渐增大再逐渐减小</p>
<p><img src="http://pic002.cnblogs.com/images/2011/168097/2011120119190666.png" alt=""></p>
<p>　　下图显示了与上述动画相关的关键对象</p>
<p><img src="http://pic002.cnblogs.com/images/2011/168097/2011120119191590.png" alt=""></p>
<p>ValueAnimator &nbsp;表示一个动画，包含动画的开始值，结束值，持续时间等属性。</p>
<p>ValueAnimator封装了一个TimeInterpolator，TimeInterpolator定义了属性值在开始值与结束值之间的插值方法。</p>
<p>ValueAnimator还封装了一个TypeAnimator，根据开始、结束值与TimeIniterpolator计算得到的值计算出属性值。</p>
<p>ValueAnimator根据动画已进行的时间跟动画总时间（duration）的比计算出一个时间因子（0~1），然后根据TimeInterpolator计算出另一个因子，最后TypeAnimator通过这个因子计算出属性值，如上例中10ms时：</p>
<p>首先计算出时间因子，即经过的时间百分比：t=10ms/40ms=0.25</p>
<p>经插值计算(inteplator)后的插值因子:大约为0.15，上述例子中用了AccelerateDecelerateInterpolator，计算公式为（input即为时间因子）：</p>
<div class="cnblogs_code"><br><pre>(Math.cos((input + 1) * Math.PI) / 2.0f) + 0.5f;  </pre><br></div>

<p>最后根据TypeEvaluator计算出在10ms时的属性值：0.15*（40-0）=6pixel。上例中TypeEvaluator为FloatEvaluator，计算方法为 ：</p>
<div class="cnblogs_code"><br><pre>public Float evaluate(<span>float</span><span> fraction, Number startValue, Number endValue) {<br>    </span><span>float</span> startFloat =<span> startValue.floatValue();<br>    </span><span>return</span> startFloat + fraction * (endValue.floatValue() -<span> startFloat);<br>}</span></pre><br></div>

<p>参数分别为上一步的插值因子，开始值与结束值。</p>
<h2 id="3-2-ValueAnimator"><a href="#3-2-ValueAnimator" class="headerlink" title="3.2 ValueAnimator"></a>3.2 ValueAnimator</h2><p>　　ValueAnimator包含Property Animation动画的所有核心功能，如动画时间，开始、结束属性值，相应时间属性值计算方法等。应用Property Animation有两个步聚：</p>
<ol>
<li>计算属性值</li>
<li>根据属性值执行相应的动作，如改变对象的某一属性。</li>
</ol>
<p>　　ValuAnimiator只完成了第一步工作，如果要完成第二步，需要实现ValueAnimator.onUpdateListener接口，这个接口只有一个函数onAnimationUpdate()，在这个函数中会传入ValueAnimator对象做为参数，通过这个ValueAnimator对象的getAnimatedValue()函数可以得到当前的属性值如：</p>
<div class="cnblogs_code"><br><pre>ValueAnimator animation = ValueAnimator.ofFloat(0f, 1f);<br>animation.setDuration(1000);<br>animation.addUpdateListener(<span>new</span> AnimatorUpdateListener() {<br>    @Override<br>    <span>public</span> <span>void</span> onAnimationUpdate(ValueAnimator animation) {<br>        Log.i(“update”, ((Float) animation.getAnimatedValue()).toString());<br>    }<br>});<br>animation.setInterpolator(<span>new</span> CycleInterpolator(3));<br>animation.start();</pre><br></div>

<p>此示例中只是向Logcat输出了一些信息，可以改为想做的工作。</p>
<p><strong>Animator.AnimatorListener</strong></p>
<div class="cnblogs_code"><br><pre><span>onAnimationStart()<br><br>onAnimationEnd()<br><br>onAnimationRepeat()<br><br></span><span>//</span><span>当动画被取消时调用，同时会调用onAnimationEnd().</span><br>onAnimationCancel()</pre><br></div>

<p><strong>ValueAnimator.AnimatorUpdateListener</strong></p>
<div class="cnblogs_code"><br><pre>onAnimationUpdate()　　<span>//</span><span>通过监听这个事件在属性的值更新时执行相应的操作，对于ValueAnimator一般要监听此事件执行相应的动作，不然Animation没意义，在ObjectAnimator（继承自ValueAnimator）中会自动更新属性，如无必要不必监听。在函数中会传递一个ValueAnimator参数，通过此参数的getAnimatedValue()取得当前动画属性值。</span></pre><br></div>

<p>　　可以继承AnimatorListenerAdapter而不是实现AnimatorListener接口来简化操作，这个类对AnimatorListener中的函数都定义了一个空函数体，这样我们就只用定义想监听的事件而不用实现每个函数却只定义一空函数体。</p>
<div class="cnblogs_code"><br><pre>ObjectAnimator oa=ObjectAnimator.ofFloat(tv, “alpha”<span>, 0f, 1f);<br>oa.setDuration(</span>3000<span>);<br>oa.addListener(</span><span>new</span><span> AnimatorListenerAdapter(){<br>    </span><span>public</span> <span>void</span><span> on AnimationEnd(Animator animation){<br>        Log.i(</span>“Animation”,”end”<span>);<br>    }<br>});<br>oa.start();</span></pre><br></div>

<h2 id="3-3-ObjectAnimator"><a href="#3-3-ObjectAnimator" class="headerlink" title="3.3 ObjectAnimator"></a>3.3 ObjectAnimator</h2><p>　　继承自ValueAnimator，要指定一个对象及该对象的一个属性，当属性值计算完成时自动设置为该对象的相应属性，即完成了Property Animation的全部两步操作。实际应用中一般都会用ObjectAnimator来改变某一对象的某一属性，但用ObjectAnimator有一定的限制，要想使用ObjectAnimator，应该满足以下条件：</p>
<ul>
<li>对象应该有一个setter函数：set&lt;PropertyName&gt;（驼峰命名法）</li>
<li>如上面的例子中，像ofFloat之类的工场方法，第一个参数为对象名，第二个为属性名，后面的参数为可变参数，如果values&hellip;参数只设置了一个值的话，那么会假定为目的值，属性值的变化范围为当前值到目的值，为了获得当前值，该对象要有相应属性的getter方法：get&lt;PropertyName&gt;</li>
<li>如果有getter方法，其应返回值类型应与相应的setter方法的参数类型一致。</li>
</ul>
<p>　　如果上述条件不满足，则不能用ObjectAnimator，应用ValueAnimator代替。</p>
<div class="cnblogs_code"><br><pre>tv=<span>(TextView)findViewById(R.id.textview1);<br>btn</span>=<span>(Button)findViewById(R.id.button1);<br>btn.setOnClickListener(</span><span>new</span><span> OnClickListener() {<br>　　@Override<br>　　</span><span>public</span> <span>void</span><span> onClick(View v) {<br>　　　　ObjectAnimator oa</span>=ObjectAnimator.ofFloat(tv, “alpha”<span>, 0f, 1f);<br>　　　　oa.setDuration(</span>3000<span>);<br>　　　　oa.start();<br>　　}<br>});</span></pre><br></div>

<p>　　把一个TextView的透明度在3秒内从0变至1。</p>
<p><strong>　　根据应用动画的对象或属性的不同，可能需要在onAnimationUpdate函数中调用invalidate()函数刷新视图。</strong></p>
<h2 id="3-4-通过AnimationSet应用多个动画"><a href="#3-4-通过AnimationSet应用多个动画" class="headerlink" title="3.4 通过AnimationSet应用多个动画"></a>3.4 通过AnimationSet应用多个动画</h2><p>　　AnimationSet提供了一个把多个动画组合成一个组合的机制，并可设置组中动画的时序关系，如同时播放，顺序播放等。</p>
<p>　　以下例子同时应用5个动画：</p>
<ol>
<li>播放anim1；</li>
<li>同时播放anim2,anim3,anim4；</li>
<li>播放anim5。<div class="cnblogs_code"><br><pre>AnimatorSet bouncer = <span>new</span><span> AnimatorSet();<br>bouncer.play(anim1).before(anim2);<br>bouncer.play(anim2).with(anim3);<br>bouncer.play(anim2).with(anim4)<br>bouncer.play(anim5).after(amin2);<br>animatorSet.start();</span></pre><br></div>

</li>
</ol>
<h2 id="3-5-TypeEvalutors"><a href="#3-5-TypeEvalutors" class="headerlink" title="3.5 TypeEvalutors"></a>3.5 TypeEvalutors</h2><p>　　根据属性的开始、结束值与TimeInterpolation计算出的因子计算出当前时间的属性值，android提供了以下几个evalutor：</p>
<ul>
<li>IntEvaluator：属性的值类型为int；</li>
<li>FloatEvaluator：属性的值类型为float；</li>
<li>ArgbEvaluator：属性的值类型为十六进制颜色值；</li>
<li>TypeEvaluator：一个接口，可以通过实现该接口自定义Evaluator。</li>
</ul>
<p>　　自定义TypeEvalutor很简单，只需要实现一个方法，如FloatEvalutor的定义：</p>
<div class="cnblogs_code"><br><pre><span>public</span> <span>class</span> FloatEvaluator <span>implements</span><span> TypeEvaluator {<br>    </span><span>public</span> Object evaluate(<span>float</span><span> fraction, Object startValue, Object endValue) {<br>        </span><span>float</span> startFloat =<span> ((Number) startValue).floatValue();<br>        </span><span>return</span> startFloat + fraction * (((Number) endValue).floatValue() -<span> startFloat);<br>    }<br>}</span></pre><br></div>

<p>　　根据动画执行的时间跟应用的Interplator，会计算出一个0~1之间的因子，即evalute函数中的fraction参数，通过上述FloatEvaluator应该很好看出其意思。</p>
<h2 id="3-6-TimeInterplator"><a href="#3-6-TimeInterplator" class="headerlink" title="3.6 TimeInterplator"></a>3.6 TimeInterplator</h2><p>　　Time interplator定义了属性值变化的方式，如线性均匀改变，开始慢然后逐渐快等。在Property Animation中是TimeInterplator，在View Animation中是Interplator，这两个是一样的，在3.0之前只有Interplator，3.0之后实现代码转移至了TimeInterplator。Interplator继承自TimeInterplator，内部没有任何其他代码。</p>
<ul>
<li>AccelerateInterpolator　　　　　 &nbsp; &nbsp; 加速，开始时慢中间加速</li>
<li>DecelerateInterpolator　　　 　　 &nbsp; 减速，开始时快然后减速</li>
<li>AccelerateDecelerateInterolator　 &nbsp; 先加速后减速，开始结束时慢，中间加速</li>
<li>AnticipateInterpolator　　　　　　 &nbsp;反向 ，先向相反方向改变一段再加速播放</li>
<li>AnticipateOvershootInterpolator　 &nbsp; 反向加回弹，先向相反方向改变，再加速播放，会超出目的值然后缓慢移动至目的值</li>
<li>BounceInterpolator　　　　　　　 &nbsp;跳跃，快到目的值时值会跳跃，如目的值100，后面的值可能依次为85，77，70，80，90，100</li>
<li>CycleIinterpolator　　　　　　　　 循环，动画循环一定次数，值的改变为一正弦函数：Math.sin(2 <em> mCycles </em> Math.PI * input)</li>
<li>LinearInterpolator　　　　　　　　 线性，线性均匀改变</li>
<li>OvershottInterpolator　　　　　　 &nbsp;回弹，最后超出目的值然后缓慢改变到目的值</li>
<li>TimeInterpolator　　　　　　　　 &nbsp; 一个接口，允许你自定义interpolator，以上几个都是实现了这个接口</li>
</ul>
<h2 id="3-7-当Layout改变时应用动画"><a href="#3-7-当Layout改变时应用动画" class="headerlink" title="3.7 当Layout改变时应用动画"></a>3.7 当Layout改变时应用动画</h2><p>　　ViewGroup中的子元素可以通过setVisibility使其Visible、Invisible或Gone，当有子元素可见性改变时(VISIBLE、GONE)，可以向其应用动画，通过LayoutTransition类应用此类动画：</p>
<div class="cnblogs_code"><br><pre>transition.setAnimator(LayoutTransition.DISAPPEARING, customDisappearingAnim);</pre><br></div>

<p>　　通过setAnimator应用动画，第一个参数表示应用的情境，可以以下4种类型：</p>
<ul>
<li>APPEARING　　　　　　　　当一个元素在其父元素中变为Visible时对这个元素应用动画</li>
<li>CHANGE_APPEARING　　　 当一个元素在其父元素中变为Visible时，因系统要重新布局有一些元素需要移动，对这些要移动的元素应用动画</li>
<li>DISAPPEARING　　　　　　 当一个元素在其父元素中变为GONE时对其应用动画</li>
<li>CHANGE_DISAPPEARING　 &nbsp;当一个元素在其父元素中变为GONE时，因系统要重新布局有一些元素需要移动，这些要移动的元素应用动画.</li>
</ul>
<p>　　第二个参数为一Animator。</p>
<div class="cnblogs_code"><br><pre>mTransitioner.setStagger(LayoutTransition.CHANGE_APPEARING, 30);</pre><br></div>

<p>　　此函数设置动画延迟时间，参数分别为类型与时间。</p>
<h2 id="3-8-Keyframes"><a href="#3-8-Keyframes" class="headerlink" title="3.8 Keyframes"></a>3.8 Keyframes</h2><p>　　keyFrame是一个 时间/值 对，通过它可以定义一个在特定时间的特定状态，即关键帧，而且在两个keyFrame之间可以定义不同的Interpolator，就好像多个动画的拼接，第一个动画的结束点是第二个动画的开始点。KeyFrame是抽象类，要通过ofInt(),ofFloat(),ofObject()获得适当的KeyFrame，然后通过PropertyValuesHolder.ofKeyframe获得PropertyValuesHolder对象，如以下例子：</p>
<div class="cnblogs_code"><br><pre>Keyframe kf0 = Keyframe.ofInt(0, 400<span>);<br>Keyframe kf1 </span>= Keyframe.ofInt(0.25f, 200<span>);<br>Keyframe kf2 </span>= Keyframe.ofInt(0.5f, 400<span>);<br>Keyframe kf4 </span>= Keyframe.ofInt(0.75f, 100<span>);<br>Keyframe kf3 </span>= Keyframe.ofInt(1f, 500<span>);<br>PropertyValuesHolder pvhRotation </span>= PropertyValuesHolder.ofKeyframe(“width”<span>, kf0, kf1, kf2, kf4, kf3);<br>ObjectAnimator rotationAnim </span>=<span> ObjectAnimator.ofPropertyValuesHolder(btn2, pvhRotation);<br>rotationAnim.setDuration(</span>2000);</pre><br></div>

<p>　　上述代码的意思为：设置btn对象的width属性值使其：</p>
<ul>
<li>开始时 Width=400</li>
<li>动画开始1/4时 Width=200</li>
<li>动画开始1/2时 Width=400</li>
<li>动画开始3/4时 Width=100</li>
<li>动画结束时 Width=500<div>　　第一个参数为时间百分比，第二个参数是在第一个参数的时间时的属性值。</div><br><div>　　定义了一些Keyframe后，通过PropertyValuesHolder类的方法ofKeyframe一个PropertyValuesHolder对象，然后通过ObjectAnimator.ofPropertyValuesHolder获得一个Animator对象。</div><br><div>　　用下面的代码可以实现同样的效果（上述代码时间值是线性，变化均匀）：</div><br><div><br><div class="cnblogs_code"><br><pre>ObjectAnimator oa=ObjectAnimator.ofInt(btn2, “width”, 400,200,400,100,500);<br>oa.setDuration(2000);<br>oa.start();</pre><br></div><br></div>

</li>
</ul>
<h2 id="3-9-Animating-Views"><a href="#3-9-Animating-Views" class="headerlink" title="3.9 Animating Views"></a>3.9 Animating Views</h2><p>　　在View Animation中，对View应用Animation并没有改变View的属性，动画的实现是通过其Parent View实现的，在View被drawn时Parents View改变它的绘制参数，draw后再改变参数invalidate，这样虽然View的大小或旋转角度等改变了，但View的实际属性没变，所以有效区域还是应用动画之前的区域，比如你把一按钮放大两倍，但还是放大这前的区域可以触发点击事件。为了改变这一点，在Android 3.0中给View增加了一些参数并对这些参数增加了相应的getter/setter函数（ObjectAnimator要用这些函数改变这些属性）：</p>
<ul>
<li>translationX,translationY: View相对于原始位置的偏移量</li>
<li>rotation,rotationX,rotationY: 旋转，rotation用于2D旋转角度，3D中用到后两个</li>
<li>scaleX,scaleY: 缩放比</li>
<li>x,y: View的最终坐标，是View的left，top位置加上translationX，translationY</li>
<li>alpha: 透明度<div>　　跟位置有关的参数有3个，以X坐标为例，可以通过getLeft(),getX(),getTranslateX()获得，若有一Button btn2，布局时其坐标为（40,0）：</div><br><div><br><div class="cnblogs_code"><br><pre><span>//</span><span>应用动画之前</span><span><br></span>btn2.getLeft();    <span>//</span><span>40</span><span><br></span>btn2.getX();    <span>//</span><span>40</span><span><br></span>btn2.getTranslationX();    <span>//</span><span>0<br></span><span>//</span><span>应用translationX动画</span><span><br></span>ObjectAnimator oa=ObjectAnimator.ofFloat(btn2,”translationX”, 200);<br>oa.setDuration(2000);<br>oa.start();<br><span>/<em></em></span><span>应用translationX动画后<br>btn2.getLeft();    //40<br>btn2.getX();    //240<br>btn2.getTranslationX();    //200<br></span><span>/</span><br><span>//</span><span>应用X动画，假设没有应用之前的translationX动画</span><span><br></span>ObjectAnimator oa=ObjectAnimator.ofFloat(btn2, “x”, 200);<br>oa.setDuration(2000);<br>oa.start();<br><span>/<em></em></span><span>应用X动画后<br>btn2.getLeft();    //40<br>btn2.getX();    //200<br>btn2.getTranslationX();    //160<br></span><span>/</span></pre><br></div><br></div><br><div>　　无论怎样应用动画，原来的布局时的位置通过getLeft()获得，保持不变；</div><br><div>　　X是View最终的位置；</div><br><div>　　translationX为最终位置与布局时初始位置这差。</div><br><div>　　所以若就用translationX即为在原来基础上移动多少，X为最终多少</div><br><div>　　getX()的值为getLeft()与getTranslationX()的和</div><br><div>　　对于X动画，源代码是这样的：</div><br><div><br><div class="cnblogs_code"><br><pre><span>case</span> X:<br>   info.mTranslationX = value - mView.mLeft;<br>   <span>break</span>;</pre><br></div><br></div>

</li>
</ul>
<p>　　Property Animation也可以在XML中定义</p>
<ul>
<li>&lt;set&gt; - AnimatorSet</li>
<li>&lt;animator&gt; -&nbsp;ValueAnimator</li>
<li>&lt;objectAnimator&gt; -&nbsp;ObjectAnimator<div>　　XML文件应放大/res/animator/中，通过以下方式应用动画：</div><br><div><br><div class="cnblogs_code"><br><pre>AnimatorSet set = (AnimatorSet) AnimatorInflater.loadAnimator(myContext, R.anim.property_animator);<br>set.setTarget(myObject);<br>set.start();</pre><br></div><br></div>

</li>
</ul>
<h2 id="3-10-ViewPropertyAnimator"><a href="#3-10-ViewPropertyAnimator" class="headerlink" title="3.10 ViewPropertyAnimator"></a>3.10 ViewPropertyAnimator</h2><p>　　如果需要对一个View的多个属性进行动画可以用ViewPropertyAnimator类，该类对多属性动画进行了优化，会合并一些invalidate()来减少刷新视图，该类在3.1中引入。</p>
<p>　　以下两段代码实现同样的效果：　</p>
<div class="cnblogs_code"><br><pre>PropertyValuesHolder pvhX = PropertyValuesHolder.ofFloat(“x”, 50f);<br>PropertyValuesHolder pvhY = PropertyValuesHolder.ofFloat(“y”, 100f);<br>ObjectAnimator.ofPropertyValuesHolder(myView, pvhX, pvyY).start();</pre><br></div><br><div class="cnblogs_code"><br><pre>myView.animate().x(50f).y(100f);</pre><br></div>

<p>&nbsp;</p>
<p>作者：AngelDevil<br>出处：www.cnblogs.com/angeldevil</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/my_avatar.jpg"
                alt="Wang Jie" />
            
              <p class="site-author-name" itemprop="name">Wang Jie</p>
              <p class="site-description motion-element" itemprop="description">Wang Jie's blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">144</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/wangjiegulu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:tiantian.china.2@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://plus.google.com/+%E5%A4%A9%E5%A4%A9wangjie" target="_blank" title="Google">
                      
                        <i class="fa fa-fw fa-google"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/wangjiegulu" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/2124006/wangjie" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/wangjiegulu" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i></a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.cnblogs.com/tiantianbyconan/" title="cnblog" target="_blank">cnblog</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wang Jie</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>








        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://blog-wangjiegulu-com.disqus.com/count.js" async></script>
    

    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "default";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "GooglePlus,Evernote,Twitter,Facebook,Douban,Weibo";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  

</body>
</html>
