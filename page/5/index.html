<!DOCTYPE html>




<html class="theme-next muse" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="WAND JIE" type="application/atom+xml" />






<meta name="description" content="Wang Jie&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="WAND JIE">
<meta property="og:url" content="http://blog.wangjiegulu.com/page/5/index.html">
<meta property="og:site_name" content="WAND JIE">
<meta property="og:description" content="Wang Jie&apos;s blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WAND JIE">
<meta name="twitter:description" content="Wang Jie&apos;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.wangjiegulu.com/page/5/"/>





  <title>WAND JIE</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-111189680-2', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">WAND JIE</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">TO BE AN ARTIST-ENGINNER</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2015/09/11/Kotlin语法（函数和lambda表达式）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/09/11/Kotlin语法（函数和lambda表达式）/" itemprop="url">Kotlin语法（函数和lambda表达式）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-09-11T18:35:00+08:00">
                2015-09-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/09/11/Kotlin语法（函数和lambda表达式）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/09/11/Kotlin语法（函数和lambda表达式）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#三、函数和lambda表达式</p>
<p>##1. 函数声明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fun double(x: Int): Int &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>函数参数是用 Pascal 符号定义的　name:type。参数之间用逗号隔开，每个参数必须指明类型。函数参数可以有默认参数。这样相比其他语言可以减少重载。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fun read(b: Array&lt;Byte&gt;, off: Int = 0, len: Int = b.size() ) &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##2. 命名参数<br>在调用函数时可以参数可以命名。这对于有很多参数或只有一个的函数来说很方便。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fun reformat(str: String, normalizeCase: Boolean = true,upperCaseFirstLetter: Boolean = true,</span><br><span class="line">             divideByCamelHumps: Boolean = false,</span><br><span class="line">             wordSeparator: Char = &apos; &apos;) &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">reformat(str,</span><br><span class="line">    normalizeCase = true,</span><br><span class="line">    uppercaseFirstLetter = true,</span><br><span class="line">    divideByCamelHumps = false,</span><br><span class="line">    wordSeparator = &apos;_&apos;</span><br><span class="line">  )</span><br></pre></td></tr></table></figure></p>
<p>##3. 变长参数:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fun asList&lt;T&gt;(vararg ts: T): List&lt;T&gt; &#123;</span><br><span class="line">    val result = ArrayList&lt;T&gt;()</span><br><span class="line">    for (t in ts)</span><br><span class="line">        result.add(t)</span><br><span class="line">    return result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>传递一个 array 的内容给函数，我们就可以使用 * 前缀操作符：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val a = array(1, 2, 3)</span><br><span class="line">val list = asList(-1, 0, *a, 4)</span><br></pre></td></tr></table></figure></p>
<p>Kotlin 中可以在文件个根级声明函数，这就意味者你不用创建一个类来持有函数。除了顶级函数，Kotlin 函数可以声明为局部的，作为成员函数或扩展函数。<br>Kotlin 支持局部函数，比如在另一个函数使用另一函数。局部函数可以访问外部函数的局部变量(比如闭包)。局部函数甚至可以返回到外部函数</p>
<p>##4. 高阶函数<br>高阶函数就是可以接受函数作为参数并返回一个函数的函数。比如 lock() 就是一个很好的例子，它接收一个 lock 对象和一个函数，运行函数并释放 lock;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fun lock&lt;T&gt;(lock: Lock, body: () -&gt; T ) : T &#123;</span><br><span class="line">    lock.lock()</span><br><span class="line">    try &#123;</span><br><span class="line">        return body()</span><br><span class="line">    &#125;</span><br><span class="line">    finally &#123;</span><br><span class="line">        lock.unlock()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其实最方便的办法是传递一个字面函数(通常是 lambda 表达式)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val result = lock(lock, &#123; sharedResource.operation() &#125;)</span><br></pre></td></tr></table></figure></p>
<p>在 kotlin 中有一个约定，如果最后一个参数是函数，可以省略括号：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lock (lock) &#123;</span><br><span class="line">    sharedResource.operation()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##5. 字面函数</p>
<ul>
<li>字面函数被包在大括号里</li>
<li>参数在 -&gt; 前面声明(参数类型可以省略)</li>
<li>函数体在 -&gt; 之后</li>
</ul>
<p>字面函数或函数表达式就是一个 “匿名函数”，也就是没有声明的函数，但立即作为表达式传递下去。</p>
<p>##6. 函数类型<br>如：(T, T) -&gt; Boolean<br>注意如果一个函数接受另一个函数做为最后一个参数，该函数文本参数可以在括号内的参数列表外的传递。</p>
<p>##7. 函数文本语法<br>函数文本的完全写法是下面这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val sum = &#123;x: Int,y: Int -&gt; x + y&#125;</span><br></pre></td></tr></table></figure></p>
<p>函数文本总是在大括号里包裹着，在完全语法中参数声明是在括号内，类型注解是可选的，函数体是在　-&gt; 之后，像下面这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val sum: (Int, Int) -&gt; Int = &#123;x, y -&gt; x+y &#125;</span><br></pre></td></tr></table></figure></p>
<p>##8. 函数表达式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fun(x: Int, y: Int ): Int = x + y</span><br></pre></td></tr></table></figure></p>
<p>##9. 内联函数<br>在高阶函数前增加inline注解可以指定函数內联。inline 标记即影响函数本身也影响传递进来的 lambda 函数：所有的这些都将被关联到调用点。<br>内联可能会引起生成代码增长，所以可以使用noinline来指定某些函数不进行內联。</p>
<p>注意有些内联函数可以调用传递进来的 lambda 函数，但不是在函数体，而是在另一个执行的上下文中，比如局部对象或者一个嵌套函数。在这样的情形中，非局部的控制流也不允许在lambda 函数中。为了表明，lambda 参数需要有 InlineOptions.ONLY_LOCAL_RETURN 注解</p>
<p><strong>参考：</strong><br>1. <a href="http://kotlinlang.org/docs/reference/basic-syntax.html" target="_blank" rel="noopener">http://kotlinlang.org/docs/reference/basic-syntax.html</a><br>2. <a href="http://huanglizhuo.gitbooks.io/kotlin-in-chinese" target="_blank" rel="noopener">http://huanglizhuo.gitbooks.io/kotlin-in-chinese</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2015/09/11/Kotlin语法（类和对象）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/09/11/Kotlin语法（类和对象）/" itemprop="url">Kotlin语法（类和对象）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-09-11T17:47:00+08:00">
                2015-09-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/09/11/Kotlin语法（类和对象）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/09/11/Kotlin语法（类和对象）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#二、类和对象：</p>
<p>##1. 类定义：<br>类的声明包含类名，类头(指定类型参数，主构造函数等等)，以及类主体，用大括号包裹。类头和类体是可选的；如果没有类体可以省略大括号。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class Invoice&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##2. 构造函数:<br>在 Kotlin 中类可以有一个主构造函数以及多个二级构造函数。主构造函数是类头的一部分：跟在类名后面(可以有可选的参数)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class Person(val firstName: String, val lastName: String, var age: Int)&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>初始化代码可以放在以 init 做前缀的初始化块内：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Customer(name: String)&#123;</span><br><span class="line">    init &#123;</span><br><span class="line">        logger,info(&quot;Customer initialized with value $&#123;name&#125;&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果构造函数有注解或可见性声明，则 constructor 关键字是不可少的，并且注解应该在前：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class Customer public inject constructor (name: String) &#123;...&#125;</span><br></pre></td></tr></table></figure></p>
<p>##3. 二级构造函数:<br>前缀是 constructor：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">    constructor(parent: Person) &#123;</span><br><span class="line">        parent.children.add(this)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果类有主构造函数，每个二级构造函数都要，或直接或间接通过另一个二级构造函数代理主构造函数。在同一个类中代理另一个构造函数使用 this 关键字：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Person(val name: String) &#123;</span><br><span class="line">    constructor (name: String, paret: Person) : this(name) &#123;</span><br><span class="line">        parent.children.add(this)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>没有声明构造函数，则有一个默认的无参构造函数。</p>
<p>##4. 创建类的实例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val invoice = Invoice()</span><br><span class="line">val customer = Customer(&quot;Joe Smith&quot;)</span><br></pre></td></tr></table></figure></p>
<p>##5. 继承<br>所有类的基类：Any，类似Java中的Object</p>
<p>所有非抽象类默认都是不可继承的（java中的final），如果要被子类继承，需要使用<code>open</code>关键字（与java中的final功能相反），继承用<code>:</code>操作符。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">open class Base(p: Ont)</span><br><span class="line">class Derived(p: Int) : Base(p)</span><br></pre></td></tr></table></figure></p>
<p>方法如果要被重写，则也需要是<code>open</code>的，不想被重写就加<code>final</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">open class AnotherDerived() : Base() &#123;</span><br><span class="line">    final override fun v() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>方法重写规则：如果有多个相同的方法（继承或者实现自其他类，如A、B类），则必须要重写该方法，使用super范型去选择性地调用父类的实现。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">open class A &#123;</span><br><span class="line">    open fun f () &#123; print(&quot;A&quot;) &#125;</span><br><span class="line">    fun a() &#123; print(&quot;a&quot;) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface B &#123;</span><br><span class="line">    fun f() &#123; print(&quot;B&quot;) &#125; //接口的成员变量默认是 open 的</span><br><span class="line">    fun b() &#123; print(&quot;b&quot;) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class C() : A() , B&#123;</span><br><span class="line">    override fun f() &#123;</span><br><span class="line">        super&lt;A&gt;.f()//调用 A.f()</span><br><span class="line">        super&lt;B&gt;.f()//调用 B.f()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##6. 抽象类<br><code>abstract</code>关键字，抽象类和函数默认是<code>open</code>的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">open class Base &#123;</span><br><span class="line">    open fun f() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract class Derived : Base() &#123;</span><br><span class="line">    override abstract fun f()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##7. 伴随对象<br>使用伴随对象可以直接使用类名来访问（用法类似Java中的static，但是不一样）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class MyClass &#123;</span><br><span class="line">    companion object &#123;</span><br><span class="line">        var BASE_URL: String = &quot;BASE_URL&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println(&quot;BASE_URL: &quot; + MyClass.BASE_URL)</span><br></pre></td></tr></table></figure></p>
<p>与java的static不同，运行时它们仍然是真正对象的成员实例，比如可以实现接口：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">inerface Factory&lt;T&gt; &#123;</span><br><span class="line">    fun create(): T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyClass &#123;</span><br><span class="line">    companion object : Factory&lt;MyClass&gt; &#123;</span><br><span class="line">        override fun create(): MyClass = MyClass()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>##8. Getter 和 Setter 函数<br>一般定义变量的时候有默认的getter/setter方法；如果使用$访问，则可以避开getter/setter方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var stringRepresentation: String</span><br><span class="line">    get() = this.toString()</span><br><span class="line">    set (value) &#123;</span><br><span class="line">        setDataFormString(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>改变一个访问者的可见性或者注解它，可以不用改变默认的实现:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var settVisibilite: String = &quot;abc&quot;//非空类型必须初始化</span><br><span class="line">    private set // setter 是私有的并且有默认的实现</span><br><span class="line">var setterVithAnnotation: Any?</span><br><span class="line">    @Inject set // 用 Inject 注解 setter</span><br></pre></td></tr></table></figure></p>
<p>##9. 接口<br>可以包含抽象方法，以及方法的默认实现。可以有属性但必须是抽象的。一个类或对象可以实现一个或多个接口。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface MyInterface &#123;</span><br><span class="line">    fun bar()</span><br><span class="line">    fun foo() &#123;</span><br><span class="line">        //函数体是可选的</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接口属性不能赋值，需要被子类override：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface MyInterface &#123;</span><br><span class="line">    val property: Int //抽象属性</span><br><span class="line">    fun foo() &#123;</span><br><span class="line">        println(property)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Child : MyInterface &#123;</span><br><span class="line">    override val property: Int = 29</span><br><span class="line">&#125;</span><br><span class="line">输出：29</span><br></pre></td></tr></table></figure></p>
<p>##10. 可见性修饰词</p>
<ul>
<li>private: 只在该类(以及它的成员)中可见</li>
<li>protected: 和 private 一样但在子类中也可见</li>
<li>internal: 在本模块的所有可以访问该类的均可以访问该类的所有 internal 成员</li>
<li>public: 任何地方可见</li>
</ul>
<p>##11. 数据类<br>使用<code>data</code>关键词修饰类，则会自动添加<code>equals()/hashCode</code>, <code>toString</code>, <code>[compontN()functions]对应按声明顺序出现的所有属性</code>, <code>copy()</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data class User(val name: String, val age: Int)</span><br></pre></td></tr></table></figure></p>
<p>组件函数允许数据类在多重声明中使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val jane = User(&quot;jane&quot;, 35)</span><br><span class="line">val (name, age) = jane</span><br><span class="line">println(&quot;$name, $age years of age&quot;)</span><br></pre></td></tr></table></figure></p>
<p>##12. 内部类<br>类可以标记为 inner 这样就可以访问外部类的成员。内部类拥有外部类的一个对象引用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class Outer &#123;</span><br><span class="line">    private val bar: Int = 1</span><br><span class="line">    inner class Inner &#123;</span><br><span class="line">        fun foo() = bar</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">val demo = Outer().Inner().foo()</span><br></pre></td></tr></table></figure></p>
<p>##13. 对象表达式<br>类似Java的匿名内部类，可以继承/实现多个：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var zhangsan = object : Person(), MyInterface&#123;</span><br><span class="line">        override val property: Int = 512</span><br><span class="line"></span><br><span class="line">        override fun toString(): String &#123;</span><br><span class="line">            return &quot;toString() modified&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">println(zhangsan.toString())</span><br></pre></td></tr></table></figure></p>
<p>一个没有父类的对象，我们可以这样写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val adHoc = object &#123;</span><br><span class="line">    var x: Int = 0</span><br><span class="line">    var y: Int = 0</span><br><span class="line">&#125;</span><br><span class="line">print(adHoc.x + adHoc.y)</span><br></pre></td></tr></table></figure></p>
<p>##14. 代理<br>类代理：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">interface Base &#123;</span><br><span class="line">    fun print()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class BaseImpl(val x: Int) : Base &#123;</span><br><span class="line">    override fun print() &#123; printz(x) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Derived(b: Base) : Base by b</span><br><span class="line"></span><br><span class="line">fun main() &#123;</span><br><span class="line">    val b = BaseImpl(10)</span><br><span class="line">    Derived(b).print()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>属性代理：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Example &#123;</span><br><span class="line">    var p: String by Delegate()</span><br><span class="line">&#125;</span><br><span class="line">class Delegate &#123;</span><br><span class="line">    fun get(thisRef: Any?, prop: PropertyMetadata): String &#123;</span><br><span class="line">        return &quot;$thisRef, thank you for delegating &apos;$&#123;prop.name&#125;&apos; to me !&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun set(thisRef: Any?, prop: PropertyMatada, value: String) &#123;</span><br><span class="line">        println(&quot;$value has been assigned to &apos;$&#123;prop.name&#125; in $thisRef.&apos;&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">val e = Example()</span><br><span class="line">pintln(e.p)</span><br><span class="line"></span><br><span class="line">输出：Example@33a17727, thank you for delegating ‘p’ to me!</span><br></pre></td></tr></table></figure></p>
<p><a href="http://huanglizhuo.gitbooks.io/kotlin-in-chinese/content/ClassesAndObjects/DelegationProperties.html" target="_blank" rel="noopener">标准代理</a></p>
<p><strong>参考：</strong><br>1. <a href="http://kotlinlang.org/docs/reference/basic-syntax.html" target="_blank" rel="noopener">http://kotlinlang.org/docs/reference/basic-syntax.html</a><br>2. <a href="http://huanglizhuo.gitbooks.io/kotlin-in-chinese" target="_blank" rel="noopener">http://huanglizhuo.gitbooks.io/kotlin-in-chinese</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2015/09/11/Kotlin语法（基础）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/09/11/Kotlin语法（基础）/" itemprop="url">Kotlin语法（基础）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-09-11T14:50:00+08:00">
                2015-09-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/09/11/Kotlin语法（基础）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/09/11/Kotlin语法（基础）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#一、基础语法：</p>
<p>##1. 定义包名：<br>包名应该在源文件的最开头，包名不必和文件夹路径一致：源文件可以放在任意位置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package my.demo</span><br></pre></td></tr></table></figure></p>
<p>##2. 定义函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fun sum(a: Int , b: Int) : Int&#123;</span><br><span class="line">　　return a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>表达式函数体自动推断型的返回值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fun sum(a: Int, b Int) = a + b</span><br></pre></td></tr></table></figure></p>
<p>要想函数在模块外面可见就必须有一个确定的返回值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public fun sum(a: Int, b: Int): Int = a + b</span><br></pre></td></tr></table></figure></p>
<p>Unit相当于Java中的void，可省略</p>
<p>##3. 定义变量：</p>
<ul>
<li><code>var a: Int = 1</code>，普通变量</li>
<li><code>val a: Int = 1</code>，只读变量，相当于Java中的final</li>
<li><code>var a = 1</code>，可推导出Int类型</li>
</ul>
<p>##4. 字符串模板<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fun main(args: Array&lt;String&gt;) &#123;</span><br><span class="line">    if (args.size() == 0) return</span><br><span class="line">    print(&quot;First argument: $&#123;args[0]&#125;&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>换行：\n</p>
<p>三个引号包(“””)裹的,不包含分割符并且可以包含其它字符：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val text = &quot;&quot;&quot;</span><br><span class="line">    for (c in &quot;foo&quot;)</span><br><span class="line">        print(c)</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure></p>
<p>###5. if语句<br>除了类似Java的用法，还可以当作表达式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fun max(a: Int,  b: Int) = if (a &gt; b) a else b</span><br></pre></td></tr></table></figure></p>
<p>可直接返回if结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fun foo(param: Int)&#123;</span><br><span class="line">    val result = if (param == 1) &#123;</span><br><span class="line">        &quot;one&quot;</span><br><span class="line">    &#125; else if (param == 2) &#123;</span><br><span class="line">        &quot;two&quot;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        &quot;three&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###6. 可空变量以及空值检查<br>声明可空变量：<code>var a:Int? = null</code><br>函数返回可空：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fun parseInt(str : String): Int?&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>调用时自动检查null：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val files = File(&quot;Test&quot;).listFiles()</span><br><span class="line">println(files?.size)</span><br></pre></td></tr></table></figure></p>
<p>调用时自动检查null（可设置如果为null时的默认值）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val files = File(&quot;test&quot;).listFiles()</span><br><span class="line">println(files?.size ?: &quot;empty&quot;)</span><br></pre></td></tr></table></figure></p>
<p>如果为空执行某操作：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val data = ...</span><br><span class="line">val email = data[&quot;email&quot;] ?: throw</span><br><span class="line">IllegalStateException(&quot;Email is missing!&quot;)</span><br></pre></td></tr></table></figure></p>
<p>如果不为空执行某操作：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val date = ...</span><br><span class="line">data?.let&#123;</span><br><span class="line">    ...//如果不为空执行该语句块</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###7. 使用值检查<br><code>is</code>：相当于Java中的instanceof, 是否是某个类型的实例。如果对一个不可变的局部变量属性检查是否是某种特定类型，就没有必要明确转换</p>
<p>###8. 循环<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (arg in args)&#123;</span><br><span class="line">    print(arg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>While</code>等循环与Java一样</p>
<p>###9. When表达式<br>相当于Java中的switch case，但是更强大。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fun cases(obj: Any) &#123;</span><br><span class="line">    when (obj) &#123;</span><br><span class="line">    1    -&gt; print(&quot;one&quot;)</span><br><span class="line">    &quot;hello&quot;    -&gt; print(&quot;Greeting&quot;)</span><br><span class="line">    is Long    -&gt; print(&quot;Long&quot;)</span><br><span class="line">    ! is Long    -&gt; print(&quot;Not a string&quot;)</span><br><span class="line">    else    -&gt; print(&quot;Ubknow&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可直接返回when的判断结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fun transform(color: String): Int &#123;</span><br><span class="line">    return when(color) &#123;</span><br><span class="line">        &quot;Red&quot; -&gt; 0</span><br><span class="line">        &quot;Green&quot; -&gt; 1</span><br><span class="line">        &quot;Blue&quot; -&gt; 2</span><br><span class="line">        else -&gt; throw IllegalArgumentException(&quot;Invalid color param value&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###10. ranges &amp; in<br>检查 in 操作符检查数值是否在某个范围内（同样适用于集合）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (x in 1..100)&#123;</span><br><span class="line">    print(&quot;$&#123;x&#125; in 1~100&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (x !in 1..100)&#123;</span><br><span class="line">    print(&quot;$&#123;x&#125; not in 1~100&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用 in 操作符检查集合中是否包含某个对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (text in names) //将会调用nemes.contains(text)方法</span><br><span class="line">    print(&quot;Yes)</span><br></pre></td></tr></table></figure></p>
<p>遍历 map：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for ((k, v) in map) &#123;</span><br><span class="line">    print(&quot;$k -&gt; $v&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>###11. 函数默认值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fun foo(a: Int = 0, b: String = &quot;&quot;) &#123;...&#125;</span><br></pre></td></tr></table></figure></p>
<p>###12. 过滤 list<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val positives = list.filter &#123; x -&gt; x &gt;0 &#125;</span><br></pre></td></tr></table></figure></p>
<p>或者更短：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val positives = list.filter &#123; it &gt; 0 &#125;</span><br></pre></td></tr></table></figure></p>
<p>###13. 只读 list/map<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val list = listOf(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)</span><br></pre></td></tr></table></figure></p>
<p>或者：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val map = maoOf(&quot;a&quot; to 1, &quot;b&quot; to 2, &quot;c&quot; to 3)</span><br></pre></td></tr></table></figure></p>
<p>获取map中的值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">println(map[&quot;key&quot;])</span><br><span class="line">map[&quot;key&quot;] = value</span><br></pre></td></tr></table></figure></p>
<p>###14. 扩展函数(给现有类增添新函数)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fun String.spcaceToCamelCase() &#123; ... &#125;</span><br><span class="line">&quot;Convert this to camelcase&quot;.spcaceToCamelCase()</span><br></pre></td></tr></table></figure></p>
<h3 id="15-创建单例模式"><a href="#15-创建单例模式" class="headerlink" title="15. 创建单例模式"></a>15. 创建单例模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">object Resource &#123;</span><br><span class="line">    val name = &quot;Name&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="16-try-catch"><a href="#16-try-catch" class="headerlink" title="16. try-catch"></a>16. try-catch</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">    count()</span><br><span class="line">&#125;catch (e: ArithmeticException) &#123;</span><br><span class="line">    throw IllegaStateException(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可直接返回try-catch结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fun test() &#123;</span><br><span class="line">    val result = try &#123;</span><br><span class="line">        count()</span><br><span class="line">    &#125;catch (e: ArithmeticException) &#123;</span><br><span class="line">        throw IllegaStateException(e)</span><br><span class="line">    &#125;</span><br><span class="line">    //处理 result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="17-返回与跳转"><a href="#17-返回与跳转" class="headerlink" title="17. 返回与跳转"></a>17. 返回与跳转</h3><p>return break 结束最近的闭合循环 continue 跳到最近的闭合循环的下一次循环。</p>
<p>使用标签快速跳转：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">loop@ for(i in 1..5)&#123;</span><br><span class="line">        println(&quot;-i: $i&quot;)</span><br><span class="line">        for(j in 11..17)&#123;</span><br><span class="line">            if(14 == j)&#123;</span><br><span class="line">                break@loop</span><br><span class="line">            &#125;</span><br><span class="line">            println(&quot;-&gt; j: $j&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-i: 1</span><br><span class="line">-&gt; j: 11</span><br><span class="line">-&gt; j: 12</span><br><span class="line">-&gt; j: 13</span><br></pre></td></tr></table></figure></p>
<p>break 是跳转标签后面的表达式，continue 是跳转到循环的下一次迭代。<br><br>return 允许我们返回到外层函数。最重要的例子就是从字面函数中返回。</p>
<p><strong>参考：</strong><br>1. <a href="http://kotlinlang.org/docs/reference/basic-syntax.html" target="_blank" rel="noopener">http://kotlinlang.org/docs/reference/basic-syntax.html</a><br>2. <a href="http://huanglizhuo.gitbooks.io/kotlin-in-chinese" target="_blank" rel="noopener">http://huanglizhuo.gitbooks.io/kotlin-in-chinese</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2015/09/11/Android-使用Kotlin-Anko开发Android（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/09/11/Android-使用Kotlin-Anko开发Android（一）/" itemprop="url">[Android]使用Kotlin+Anko开发Android（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-09-11T13:20:00+08:00">
                2015-09-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/09/11/Android-使用Kotlin-Anko开发Android（一）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/09/11/Android-使用Kotlin-Anko开发Android（一）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #ff0000;"><strong>以下内容为原创，欢迎转载，转载请注明</strong></span></p>
<p><span style="color: #ff0000;"><strong>来自天天博客：<a href="http://www.cnblogs.com/tiantianbyconan/p/4800656.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiantianbyconan/p/4800656.html</a>&nbsp;</strong></span></p>
<p>&nbsp;</p>
<p>Kotlin是由JetBrains开发并且开源的静态类型JVM语言。比Java语言语法简洁，支持很多Java中不支持的语法特性，如高阶函数、內联函数、null安全、灵活扩展、操作符重载等等。而且它还完全兼容Java，与Scala类似，但是Scala的宗旨是&ldquo;尽可能自己实现，不得已才使用Java&rdquo;，而Kotlin却相反：&ldquo;尽可能复用Java的实现，不得已才自己实现&rdquo;。所以相比之下Kotlin更简洁轻量，非常适合移动端的开发。另外JetBrains针对Android开发提供了一个由Kotlin实现的&ldquo;anko&rdquo;开源库，可以让你使用DSL的方式直接用代码编写UI，让你从繁琐的xml中解脱出来，而且避免了xml解析过程所带来的性能问题。</p>
<p>&nbsp;</p>
<p>这篇先讲怎么去使用idea（Android Studio用户也一样）搭建Kotlin的Android开发环境。</p>
<p>&nbsp;</p>
<p><span style="font-size: 15px;"><strong>一、下载以下相关idea插件：</strong></span></p>
<p>1. Kotlin</p>
<p>2. Kotlin Extensions For Android</p>
<p>3. Anko DSL Preview</p>
<p>其中Anko DSL Preview插件用于预览使用DSL编写的UI代码，就像以前使用xml编写UI文件时可以动态在&ldquo;Preview&rdquo;窗口预览效果一样。</p>
<p>&nbsp;</p>
<p><span style="font-size: 15px;"><strong>二、新建Android项目</strong></span></p>
<p>在src/main目录下，新建kotlin目录（用于放置kotlin代码），配置Gradle如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #000000;">buildscript {<br></span><span style="color: #008080;"> 2</span>     ext.kotlin_version = ‘0.12.1230’<br><span style="color: #008080;"> 3</span> <span style="color: #000000;">    repositories {<br></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        mavenCentral()<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    dependencies {<br></span><span style="color: #008080;"> 7</span>         classpath ‘com.android.tools.build:gradle:1.1.1’<br><span style="color: #008080;"> 8</span>         classpath “org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version”<br><span style="color: #008080;"> 9</span>         classpath “org.jetbrains.kotlin:kotlin-android-extensions:$kotlin_version”<br><span style="color: #008080;">10</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">11</span> <span style="color: #000000;">}<br></span><span style="color: #008080;">12</span> apply plugin: ‘com.android.application’<br><span style="color: #008080;">13</span> apply plugin: ‘kotlin-android’<br><span style="color: #008080;">14</span><br><span style="color: #008080;">15</span> <span style="color: #000000;">repositories {<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">    mavenCentral()<br></span><span style="color: #008080;">17</span> <span style="color: #000000;">}<br></span><span style="color: #008080;">18</span><br><span style="color: #008080;">19</span> <span style="color: #000000;">android {<br></span><span style="color: #008080;">20</span>     compileSdkVersion 22<br><span style="color: #008080;">21</span>     buildToolsVersion “22.0.1”<br><span style="color: #008080;">22</span><br><span style="color: #008080;">23</span> <span style="color: #000000;">    defaultConfig {<br></span><span style="color: #008080;">24</span>         applicationId “com.wangjie.androidwithkotlin”<br><span style="color: #008080;">25</span>         minSdkVersion 9<br><span style="color: #008080;">26</span>         targetSdkVersion 22<br><span style="color: #008080;">27</span>         versionCode 1<br><span style="color: #008080;">28</span>         versionName “1.0”<br><span style="color: #008080;">29</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">30</span><br><span style="color: #008080;">31</span> <span style="color: #000000;">    sourceSets {<br></span><span style="color: #008080;">32</span>         main.java.srcDirs += ‘src/main/kotlin’<br><span style="color: #008080;">33</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">34</span><br><span style="color: #008080;">35</span> <span style="color: #000000;">    buildTypes {<br></span><span style="color: #008080;">36</span> <span style="color: #000000;">        release {<br></span><span style="color: #008080;">37</span>             minifyEnabled <span style="color: #0000ff;">false</span><br><span style="color: #008080;">38</span>             proguardFiles getDefaultProguardFile(‘proguard-android.txt’), ‘proguard-rules.pro’<br><span style="color: #008080;">39</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">40</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">41</span> <span style="color: #000000;">}<br></span><span style="color: #008080;">42</span><br><span style="color: #008080;">43</span> <span style="color: #000000;">dependencies {<br></span><span style="color: #008080;">44</span>     compile fileTree(dir: ‘libs’, include: [‘*.jar’<span style="color: #000000;">])<br></span><span style="color: #008080;">45</span>     compile ‘com.android.support:appcompat-v7:22.2.0’<br><span style="color: #008080;">46</span>     compile “org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version”<br><span style="color: #008080;">47</span>     compile “org.jetbrains.kotlin:kotlin-reflect:$kotlin_version”<br><span style="color: #008080;">48</span>     compile ‘org.jetbrains.anko:anko:0.6.3-15’<br><span style="color: #008080;">49</span> }</pre><br></div>

<p>然后sync &amp; build。</p>
<p>&nbsp;</p>
<p><span style="font-size: 15px;"><strong>三、配置Kotlin</strong></span></p>
<p>调用&ldquo;Configuring Kotlin in the project&rdquo;这个Action</p>
<p><img src="http://kotlinlang.org/assets/images/tutorials//kotlin-android/configure-kotlin-in-project.png" alt=""></p>
<p><img src="http://kotlinlang.org/assets/images/tutorials//kotlin-android/configure-kotlin-in-project-details.png" alt=""></p>
<p>&nbsp;</p>
<p><span style="font-size: 15px;"><strong>四、把Java代码一键转成kotlin代码</strong></span></p>
<p>打开要转换的Java文件，调用&ldquo;Convert Java File to Kotlin File&rdquo;这个Action即可。</p>
<p><img src="http://kotlinlang.org/assets/images/tutorials//kotlin-android/convert-java-to-kotlin.png" alt=""></p>
<p>转换之前的Java代码：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MainActivity <span style="color: #0000ff;">extends</span><span style="color: #000000;"> ActionBarActivity {<br><br>    @Override<br>    </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onCreate(Bundle savedInstanceState) {<br>        </span><span style="color: #0000ff;">super</span><span style="color: #000000;">.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> onCreateOptionsMenu(Menu menu) {<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> Inflate the menu; this adds items to the action bar if it is present.</span><br><span style="color: #000000;">        getMenuInflater().inflate(R.menu.menu_main, menu);<br>        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> onOptionsItemSelected(MenuItem item) {<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> Handle action bar item clicks here. The action bar will<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> automatically handle clicks on the Home/Up button, so long<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> as you specify a parent activity in AndroidManifest.xml.</span><br>        <span style="color: #0000ff;">int</span> id =<span style="color: #000000;"> item.getItemId();<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">noinspection SimplifiableIfStatement</span><br>        <span style="color: #0000ff;">if</span> (id ==<span style="color: #000000;"> R.id.action_settings) {<br>            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;<br>        }<br><br>        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">super</span><span style="color: #000000;">.onOptionsItemSelected(item);<br>    }<br>}</span></pre><br></div>

<p>转换之后的Kotlin代码：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> MainActivity : ActionBarActivity() {<br><br>    override fun onCreate(savedInstanceState: Bundle</span>?<span style="color: #000000;">) {<br>        </span><span style="color: #0000ff;">super</span><span style="color: #000000;">.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br>    }<br><br>    override fun onCreateOptionsMenu(menu: Menu</span>?<span style="color: #000000;">): Boolean {<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> Inflate the menu; this adds items to the action bar if it is present.</span><br><span style="color: #000000;">        getMenuInflater().inflate(R.menu.menu_main, menu)<br>        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;"><br>    }<br><br>    override fun onOptionsItemSelected(item: MenuItem</span>?<span style="color: #000000;">): Boolean {<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> Handle action bar item clicks here. The action bar will<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> automatically handle clicks on the Home/Up button, so long<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;"> as you specify a parent activity in AndroidManifest.xml.</span><br>        val id = item!!<span style="color: #000000;">.getItemId()<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">noinspection SimplifiableIfStatement</span><br>        <span style="color: #0000ff;">if</span> (id ==<span style="color: #000000;"> R.id.action_settings) {<br>            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;"><br>        }<br><br>        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">super</span><span style="color: #000000;">.onOptionsItemSelected(item)<br>    }<br>}</span></pre><br></div>

<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2015/09/09/Kotlin：Android世界的Swift/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/09/09/Kotlin：Android世界的Swift/" itemprop="url">Kotlin：Android世界的Swift</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-09-09T14:23:00+08:00">
                2015-09-09
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/09/09/Kotlin：Android世界的Swift/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/09/09/Kotlin：Android世界的Swift/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>转自：<a href="http://www.infoq.com/cn/news/2015/06/Android-JVM-JetBrains-Kotlin" target="_blank" rel="noopener">http://www.infoq.com/cn/news/2015/06/Android-JVM-JetBrains-Kotlin</a></p>
<p><a href="http://kotlinlang.org/" target="_blank" rel="noopener">Kotlin</a>是一门与Swift类似的静态类型JVM语言，由<a href="https://www.jetbrains.com/" target="_blank" rel="noopener">JetBrains</a>设计开发并<a href="https://github.com/jetbrains/kotlin" target="_blank" rel="noopener">开源</a>。与Java相比，Kotlin的语法更简洁、更具表达性，而且提供了更多的特性，比如，高阶函数、操作符重载、字符串模板。它与Java高度可互操作，可以同时用在一个项目中。</p>
<p><a href="http://kotlinlang.org/docs/reference/faq.html" target="_blank" rel="noopener">按照JetBrains的说法</a>，根据他们多年的Java平台开发经验，他们认为Java编程语言有一定的局限性和问题，而且由于需要向后兼容，它们不可能或很难得到解决。因此，他们创建了Kotlin项目，主要目标是：</p>
<ul>
<li>创建一种兼容Java的语言</li>
<li>编译速度至少同Java一样快</li>
<li>比Java更安全</li>
<li>比Java更简洁</li>
<li>比最成熟的竞争者Scala还简单</li>
</ul>
<p><a href="http://tutsplus.com/authors/ashraff-hathibelagal" target="_blank" rel="noopener">Ashraff Hathibelagal</a>是一名喜欢研究新框架和SDK的独立开发者。近日，他<a href="http://code.tutsplus.com/tutorials/an-introduction-to-kotlin--cms-24051" target="_blank" rel="noopener">撰文</a>介绍了Kotlin的一些语法。按照他的说法，一个合格的Java程序员可以在很短的时间内学会使用Kotlin。</p>
<p><strong>类与构造函数</strong></p>
<p>Kotlin创建类的方式与Java类似，比如下面的代码创建了一个有三个属性的<code>Person</code>类：</p>
<pre><code>class Person{
    var name: String = &quot;&quot;
    var age: Int = 0
    var college: String? = null
}
`&lt;/pre&gt;

可以看到，Kotlin的变量声明方式略有些不同。在Kotline中，声明变量必须使用关键字`var`，而如果要创建一个只读/只赋值一次的变量，则需要使用`val`代替它。另外，为了实现&amp;ldquo;空安全（null safety）&amp;rdquo;，Kotlin对可以为空的变量和不可以为空的变量作了区分。在上述代码中，变量`name`和`age`不可为空，而`？`表明变量`college`可以为空。定义完类之后，创建实例就非常简单了：

&lt;pre&gt;`var jake = Person()
`&lt;/pre&gt;

注意，Kotlin没有关键字`new`。实例创建完成后，就可以像在Java中一样为变量赋值了：

&lt;pre&gt;`jake.name = &quot;Jake Hill&quot;
jake.age = 24
jake.college = &quot;Stephen&apos;s College&quot;
`&lt;/pre&gt;

变量可以采用上述方式赋值，也可以通过构造函数赋值，但后者是一种更好的编码实践。在Kotlin中，创建这样的一个构造函数非常简单：

&lt;pre&gt;`class Person(var name: String, var age: Int, var college: String?) {
}
`&lt;/pre&gt;

而实际上，由于构造函数中没有其它操作，所以花括号也可以省略，代码变得相当简洁：

&lt;pre&gt;`class Person(var name: String, var age: Int, var college: String?)

var jake = Person(&quot;Jake Hill&quot;, 24, &quot;Stephen&apos;s College&quot;)
`&lt;/pre&gt;

上述代码中的构造函数是类头的一部分，称为主构造函数。在Kotlin中，还可以使用`constructor`关键字创建辅助构造函数，例如，下面的代码增加了一个辅助构造函数初始化变量`email`：

&lt;pre&gt;`class Person(var name: String, var age: Int, var college: String?) {

    var email: String = &quot;&quot;

    constructor(name:String, age:Int, college: String?, email: String) : this(name, age, college) {
        this.email = email
    }
}
`&lt;/pre&gt;

Kotlin允许创建派生类，但要遵循如下规则：
</code></pre><ul>
<li>必须使用<code>：</code>代替Java中的<code>extends</code>关键字</li>
<li>基类头必须有<code>open</code>注解</li>
<li><p>基类必须有一个带参数的构造函数，派生类要在它自己的头中初始化那些参数</p>
<p>比如下面的代码创建了一个名为<code>Empoyee</code>的派生类：</p>
<pre>`open class Person(var name: String, var age: Int, var college: String?) {
    ...
}

class Employee(name: String, age: Int, college: String?, var company: String) : Person(name, age, college) {
}
`</pre>

<p><strong>函数与扩展</strong></p>
<p>有派生就有重载。与类的派生一样，允许重载的方法要有<code>open</code>注解，而在派生类中重载时要使用<code>override</code>注解。例如，下面是在<code>Employee</code>类中重载<code>Person</code>类的<code>isEligibleToVote</code>方法的代码：</p>
<pre>`override fun isEligibleToVote(): Boolean {
    return true
}
`</pre>

<p>除了改变类的已有行为，Kotlin还允许开发者在不修改类的原始定义的情况下实现对类的扩展，如下面的代码为<code>Person</code>类增加了一个名为<code>isTeenager</code>的扩展：</p>
<pre>`fun Person.isTeenager(): Boolean {
    return age in 13..19
}
`</pre>

<p>在需要扩展来自其它项目的类时，这个特性特别有用。</p>
<p>上面提到的函数都与Java中的函数类似，但Kotlin还支持其它类型的函数。如果一个函数返回单个表达式的值，那么可以使用<code>=</code>来定义函数。下面是一个创建单表达式函数的例子：</p>
<pre>`fun isOctogenarian(): Boolean = age in 80 .. 89
`</pre>

<p>Kotlin还支持高阶函数和Lambda表达式。例如，lambda表达式<code>{x,y-&amp;gt;x+y}</code>可以像下面这样给一个变量赋值：</p>
<pre>`val sumLambda: (Int, Int) -&gt; Int = {x,y -&gt; x+y}
`</pre>

<p>而下面的高阶函数将上述表达式作为一个参数，并将表达式的计算结果翻倍：</p>
<pre>`fun doubleTheResult(x:Int, y:Int, f:(Int, Int)-&gt;Int): Int {
    return f(x,y) * 2
}
`</pre>

<p>该函数可以使用下面的其中一种方式调用：</p>
<pre>`val result1 = doubleTheResult(3, 4, sumLambda)
`</pre>

<p>或</p>
<pre>`val result2 = doubleTheResult(3, 4, {x,y -&gt; x+y})
`</pre>

<p><strong>范围表达式</strong></p>
<p>在Kotlin中，范围表达式用的比较多。范围创建只需要<code>..</code>操作符，例如：</p>
<pre>`val r1 = 1..5
//该范围包含数值1,2,3,4,5
`</pre>

<p>如果创建一个降序范围，则需要使用<code>downTo</code>函数，例如：</p>
<pre>`val r2 = 5 downTo 1
//该范围包含数值5,4,3,2,1
`</pre>

<p>如果步长不是1，则需要使用<code>step</code>函数，例如：</p>
<pre>`val r3 = 5 downTo 1 step 2
//该范围包含数值5,3,1
`</pre>

<p><strong>条件结构</strong></p>
<p>在Kotlin中，if是一个表达式，根据条件是否满足返回不同的值，例如，下面的代码将<code>isEligibleToVote</code>设置为&ldquo;Yes&rdquo;</p>
<pre>`var age = 20
val isEligibleToVote = if(age &gt; 18) "Yes" else "No"
`</pre>

<p><code>when</code>表达式相当于Java的<code>switch</code>，但功能更强大，例如，下面的代码将<code>typeOfPerson</code>设置为&ldquo;Teenager&rdquo;：</p>
<pre>`val age = 17

val typeOfPerson = when(age){
    0 -&gt; "New born"
    in 1..12 -&gt; "Child"
    in 13..19 -&gt; "Teenager"
    else -&gt; "Adult"
}
`</pre>

<p><strong>循环结构</strong></p>
<p>Kotlin使用<code>for..in</code>遍历数组、集合及其它提供了迭代器的数据结构，语法同Java几乎完全相同，只是用<code>in</code>操作符取代了<code>:</code>操作符，例如，下面的代码将遍历一个<code>String</code>对象数组：</p>
<pre>`val names = arrayOf("Jake", "Jill", "Ashley", "Bill")

for (name in names) {
    println(name)
}
`</pre>

<p><code>while</code>和<code>do..while</code>循环的语法与Java完全相同。</p>
<p><strong>字符串模板</strong></p>
<p>Kotlin允许在字符串中嵌入变量和表达式，例如：</p>
<p><pre>`val name = “Bob”<br>println(“My name is ${name}”) //打印”My name is Bob”</pre></p>
<p>val a = 10<br>val b = 20<br>println(“The sum is ${a+b}”) //打印”The sum is 30”</p>
</li>
</ul>
<p>此外，Kotlin与Java高度可互操作。Kotlin可以用一种自然的方式调用现有的Java代码，而Java也很容易调用Kotlin代码。同时，Kotlin也可以与JavaScript互操作。</p>
<p>上面介绍的只是Kotlin的一些基本语法和特性，更多细节请查阅<a href="http://kotlinlang.org/docs/reference/" target="_blank" rel="noopener">官方文档</a>。事实上，到目前为止，Kotlin还仍然只是一个预览版本，接下来的几个月中还会有多项重大改进及新增特性。尽管如此，<a href="https://github.com/search?q=Kotlin&amp;ref=cmdform" target="_blank" rel="noopener">GitHub上已有400多个与Kotlin项目相关的库</a>。</p>
<p>在另外一篇<a href="http://code.tutsplus.com/tutorials/how-to-use-kotlin-in-your-android-projects--cms-24052" target="_blank" rel="noopener">文章</a>中，Hathibelagal写道，&ldquo;如果你正在为Android开发寻找一种替代编程语言，那么应该试下Kotlin。它很容易在Android项目中替代Java或者同Java一起使用。&rdquo;想要了解如何在Android Studio中使用Kotlin开发Android项目的读者，可以读下这篇文章。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2015/08/21/Android-Android端ORM框架——RapidORM-v1-0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/21/Android-Android端ORM框架——RapidORM-v1-0/" itemprop="url">[Android]Android端ORM框架——RapidORM(v1.0)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-08-21T15:39:00+08:00">
                2015-08-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/08/21/Android-Android端ORM框架——RapidORM-v1-0/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/08/21/Android-Android端ORM框架——RapidORM-v1-0/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #ff0000;"><strong>以下内容为原创，欢迎转载，转载请注明</strong></span></p>
<p><span style="color: #ff0000;"><strong>来自天天博客：<a href="http://www.cnblogs.com/tiantianbyconan/p/4748077.html" title="view: [Android]Android端ORM框架&mdash;&mdash;RapidORM" target="_blank" rel="noopener">http://www.cnblogs.com/tiantianbyconan/p/4748077.html</a>&nbsp;</strong></span></p>
<p>&nbsp;</p>
<p>Android上主流的ORM框架有很多，常用的有ORMLite、GreenDao等。</p>
<p>ORMLite：</p>
<p>－优点：API很友好，使用比较方便简单稳定，相关功能比较完整。</p>
<p>－缺点：内部使用反射实现，性能并不是很好。</p>
<p>GreenDao：</p>
<p>－优点：性能很不错，</p>
<p>－缺点：API却不太友好，而且不支持复合主键，主键必须要有并且必须是long或者Long。持久类可以用它提供的模版生成，但是一旦使用了它的模版，持久类、DAO就不能随意去修改，扩展性不是很好。如果不使用它的模版，代码写起来就很繁琐。</p>
<p>&nbsp;</p>
<p>所以结合了两者重新写了一个ORM：<strong><a href="https://github.com/wangjiegulu/RapidORM" target="_blank" rel="noopener">RapidORM</a></strong>（<a href="https://github.com/wangjiegulu/RapidORM" target="_blank" rel="noopener"><strong>https://github.com/wangjiegulu/RapidORM</strong></a>）</p>
<p>特点：</p>
<p>1. 支持使用反射和非反射（模版生成）两种方式实现执行SQL。</p>
<p>2. 支持复合主键</p>
<p>3. 支持任何主键类型</p>
<p>4. 兼容android原生的&nbsp;<span style="color: #000000; background-color: #e1e1e1;">android.database.sqlite.SQLiteDatabase</span>&nbsp;和SqlCipher的 <span style="background-color: #e1e1e1;">net.sqlcipher.database.SQLiteDatabase</span>。<span style="background-color: #e1e1e1;"><br></span></p>
<p>缺点：</p>
<p>1. 不支持链表查询。</p>
<p>&nbsp;</p>
<p><span style="font-size: 18px;"><strong>快速指南：</strong></span></p>
<p><strong><span style="font-size: 14px;">一、新建持久类Person：</span></strong></p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;">  Author: wangjie<br></span><span style="color: #008080;"> 3</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 4</span> <span style="color: #008000;">  Date: 6/25/15.<br></span><span style="color: #008080;"> 5</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 6</span> @Table(propertyClazz = PersonProperty.<span style="color: #0000ff;">class</span><span style="color: #000000;">)<br></span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> Person <span style="color: #0000ff;">implements</span><span style="color: #000000;"> Serializable{<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span>     @Column(primaryKey = <span style="color: #0000ff;">true</span><span style="color: #000000;">)<br></span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Integer id;<br></span><span style="color: #008080;">11</span><br><span style="color: #008080;">12</span>     @Column(primaryKey = <span style="color: #0000ff;">true</span><span style="color: #000000;">)<br></span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Integer typeId;<br></span><span style="color: #008080;">14</span><br><span style="color: #008080;">15</span> <span style="color: #000000;">    @Column<br></span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String name;<br></span><span style="color: #008080;">17</span><br><span style="color: #008080;">18</span> <span style="color: #000000;">    @Column<br></span><span style="color: #008080;">19</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Integer age;<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span> <span style="color: #000000;">    @Column<br></span><span style="color: #008080;">22</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String address;<br></span><span style="color: #008080;">23</span><br><span style="color: #008080;">24</span> <span style="color: #000000;">    @Column<br></span><span style="color: #008080;">25</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Long birth;<br></span><span style="color: #008080;">26</span><br><span style="color: #008080;">27</span> <span style="color: #000000;">    @Column<br></span><span style="color: #008080;">28</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Boolean student;<br></span><span style="color: #008080;">29</span><br><span style="color: #008080;">30</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> getter/setter…</span><br><span style="color: #008080;">31</span><br><span style="color: #008080;">32</span> }</pre><br></div>

<p>&nbsp;</p>
<p><span style="line-height: 1.5;">1. Table注解用于标记这个类需要映射到数据表，RapidORM会创建这个表。</span></p>
<p>－name属性：表示对应表的名称，默认为类的simpleName。</p>
<p>－propertyClazz属性：表示如果不使用反射执行sql时，需要的ModelProperty类的Class，RapidORM会自动在这个ModelProperty中去绑定需要执行SQL的数据。不填写则表示使用默认的反射的方式执行SQL。具体后面会讲到。</p>
<p>2. Column注解用语标记这个字段映射到的数据表的列（如果）。</p>
<p>－name属性：表示对应列的名称。默认为字段的名称。</p>
<p>－primaryKey属性：表示改列是否是主键，默认是false。（可以在多个字段都适用这个属性，表示为复合主键）。</p>
<p>－autoincrement属性：表示主键是否是自增长，只有该字段是主键并且只有一个主键并且是Integer或int类型才会生效。</p>
<p>－defaultValue属性：表示该列默认值。</p>
<p>－notNull属性：表示该列不能为空。</p>
<p>－unique属性：表示该列唯一约束。</p>
<p>－uniqueCombo属性：暂未实现。</p>
<p>－index属性：暂未实现。</p>
<p>&nbsp;</p>
<p><strong><span style="font-size: 14px;">二、注册持久类，并指定SQLiteOpenHelper：</span></strong></p>
<p>新建类DatabaseFactory，继承RapidORMConnection：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;">  Author: wangjie<br></span><span style="color: #008080;"> 3</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 4</span> <span style="color: #008000;">  Date: 6/25/15.<br></span><span style="color: #008080;"> 5</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> DatabaseFactory <span style="color: #0000ff;">extends</span> RapidORMConnection&lt;RapidORMDefaultSQLiteOpenHelperDelegate&gt;<span style="color: #000000;"> {<br></span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">int</span> VERSION = 1<span style="color: #000000;">;<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> DatabaseFactory instance;<br></span><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">synchronized</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> DatabaseFactory getInstance() {<br></span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> instance) {<br></span><span style="color: #008080;">13</span>             instance = <span style="color: #0000ff;">new</span><span style="color: #000000;"> DatabaseFactory();<br></span><span style="color: #008080;">14</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">15</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> instance;<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">17</span><br><span style="color: #008080;">18</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> DatabaseFactory() {<br></span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">();<br></span><span style="color: #008080;">20</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">21</span><br><span style="color: #008080;">22</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">23</span>     <span style="color: #0000ff;">protected</span><span style="color: #000000;"> RapidORMDefaultSQLiteOpenHelperDelegate getRapidORMDatabaseOpenHelper(@NonNull String databaseName) {<br></span><span style="color: #008080;">24</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> RapidORMDefaultSQLiteOpenHelperDelegate(<span style="color: #0000ff;">new</span><span style="color: #000000;"> MyDatabaseOpenHelper(MyApplication.getInstance(), databaseName, VERSION));<br></span><span style="color: #008080;">25</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">26</span><br><span style="color: #008080;">27</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">28</span>     <span style="color: #0000ff;">protected</span> List&lt;Class&lt;?&gt;&gt;<span style="color: #000000;"> registerAllTableClass() {<br></span><span style="color: #008080;">29</span>         List&lt;Class&lt;?&gt;&gt; allTableClass = <span style="color: #0000ff;">new</span> ArrayList&lt;&gt;<span style="color: #000000;">();<br></span><span style="color: #008080;">30</span>         allTableClass.add(Person.<span style="color: #0000ff;">class</span><span style="color: #000000;">);<br></span><span style="color: #008080;">31</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> all table class</span><br><span style="color: #008080;">32</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> allTableClass;<br></span><span style="color: #008080;">33</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">34</span> }</pre><br></div>

<p>DatabaseFactory推荐使用单例，实现RapidORMConnection的getRapidORMDatabaseOpenHelper()方法，该方法需要返回一个RapidORMDatabaseOpenHelperDelegate或者它的子类对象，RapidORMDatabaseOpenHelperDelegate是SQLiteOpenHelper的委托，因为需要兼容android原生的&nbsp;<span style="background-color: #e1e1e1;">android.database.sqlite.SQLiteDatabase</span>&nbsp;和SqlCipher的&nbsp;<span style="background-color: #e1e1e1;">net.sqlcipher.database.SQLiteDatabase</span> 两种方式。</p>
<p>如果使用&nbsp;<span style="background-color: #e1e1e1;">android.database.sqlite.SQLiteDatabase</span>&nbsp;，则可以使用RapidORMDefaultSQLiteOpenHelperDelegate，然后构造方法中传入真正的<span style="background-color: #e1e1e1;">android.database.sqlite.SQLiteDatabase</span>&nbsp;（也就是这里的MyDatabaseOpenHelper）即可，使用SqlCipher的方式后面再讲。</p>
<p>还需要实现registerAllTableClass()方法，这里返回一个所有需要映射表的持久类Class集合。</p>
<p>&nbsp;</p>
<p><strong><span style="font-size: 14px;">三、在需要的地方进行初始化RapidORM（比如在登录完成之后）：</span></strong></p>
<div class="cnblogs_code"><br><pre>DatabaseFactory.getInstance().resetDatabase(“hello_rapid_orm.db”);</pre><br></div>

<p>如上，调用resetDatabase()方法即可初始化数据库。</p>
<p>&nbsp;</p>
<p><strong>四、编写Dao：</strong></p>
<p>新建PersonDaoImpl继承BaseDaoImpl&lt;Person&gt;（这里简略了PersonDao接口）：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;">  Author: wangjie<br></span><span style="color: #008080;"> 3</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 4</span> <span style="color: #008000;">  Date: 6/26/15.<br></span><span style="color: #008080;"> 5</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> PersonDaoImpl <span style="color: #0000ff;">extends</span> BaseDaoImpl&lt;Person&gt;<span style="color: #000000;"> {<br></span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> PersonDaoImpl() {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">super</span>(Person.<span style="color: #0000ff;">class</span><span style="color: #000000;">);<br></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span> }</pre><br></div>

<p>BaseDaoImpl中默认实现了下面的基本方法（T为范型，指具体的持久类）：</p>
<p>－void insert(T model) throws Exception;　　//&nbsp;插入一条数据。</p>
<p>－void update(T model) throws Exception;　　//&nbsp;更新一条数据。</p>
<p>－void delete(T model) throws Exception;　　// 删除一条数据。</p>
<p>－void deleteAll() throws Exception;　　　　　　// 删除表中所有的数据</p>
<p>－void insertOrReplace(T model) throws Exception;　　　　// 删除或者替换（暂不支持）</p>
<p>－List&lt;T&gt; queryAll() throws Exception;　　　　　　// 查询表中所有数据</p>
<p>－List&lt;T&gt; rawQuery(String sql, String[] selectionArgs) throws Exception;　　　　　　// 使用原生sql查询表中所有的数据</p>
<p>－void rawExecute(String sql, Object[] bindArgs) throws Exception;　　　　　　　　// 使用原生sql执行一条sql语句</p>
<p>－void insertInTx(T… models) throws Exception;　　　　　　　　　　// 插入多条数据（在一个事务中）</p>
<p>－void insertInTx(Iterable&lt;T&gt; models) throws Exception;　　　　　　// 同上</p>
<p>－void updateInTx(T… models) throws Exception;　　　　　　　　　　// 更新多条数据（在一个事务中）</p>
<p>－void updateInTx(Iterable&lt;T&gt; models) throws Exception;　　　　　　// 同上</p>
<p>－void deleteInTx(T… models) throws Exception;　　　　　　　　　　　　// 删除多条数据（在一个事务中）</p>
<p>－void deleteInTx(Iterable&lt;T&gt; models) throws Exception;　　　　　　　　// 同上</p>
<p>－void executeInTx(RapidORMSQLiteDatabaseDelegate db, RapidOrmFunc1 func1) throws Exception;&nbsp;// 执行一个方法（可多个sql），在一个事务中</p>
<p>－void executeInTx(RapidOrmFunc1 func1) throws Exception;　　　　// 同上</p>
<p>&nbsp;</p>
<p><span style="font-size: 15px;"><strong>面向对象的方式使用Where和Builder来构建sql语句：</strong></span></p>
<p><strong>1. Where：</strong></p>
<p>Where表示一系列的条件语句，含义与SQL中的where关键字一致。</p>
<p>支持的where操作：</p>
<p>－eq(String column, Object value)　　　　//&nbsp;相等条件判断</p>
<p>－ne(String column, Object value)　　　　// 不相等条件判断</p>
<p>－gt(String column, Object value)　　　　 // 大于条件判断</p>
<p>－lt(String column, Object value)　　　　　// 小于条件判断</p>
<p>－ge(String column, Object value)　　　　 //&nbsp;大于等于条件</p>
<p>－le(String column, Object value)　　　　　// 小于等于条件</p>
<p>－in(String column, Object… values)　　　 // 包含条件</p>
<p>－ni(String column, Object… values)　　　 // 不包含条件</p>
<p>－isNull(String column)　　　　　　　　　　//&nbsp;null条件判断</p>
<p>－notNull(String column)　　　　　　　　　// 不为null条件判断</p>
<p>－between(String column, Object value1, Object value2)　　//&nbsp;BETWEEN … AND …” condition</p>
<p>－like(String column, Object value)　　　　　　// 模糊匹配条件</p>
<p>－Where raw(String rawWhere, Object… values)　　// 原生sql条件</p>
<p>－and(Where… wheres)　　　　　　　　　　// 多个Where与</p>
<p>－or(Where… wheres)　　　　　　　　　　// 多个Where或</p>
<p>&nbsp;</p>
<p>Where举例：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #000000;">    Where.and(<br></span><span style="color: #008080;">2</span>                 Where.like(PersonProperty.name.column, “%wangjie%”<span style="color: #000000;">),<br></span><span style="color: #008080;">3</span>                 Where.lt(PersonProperty.id.column, 200<span style="color: #000000;">),<br></span><span style="color: #008080;">4</span> <span style="color: #000000;">                Where.or(<br></span><span style="color: #008080;">5</span>                         Where.between(PersonProperty.age.column, 19, 39<span style="color: #000000;">),<br></span><span style="color: #008080;">6</span> <span style="color: #000000;">                        Where.isNull(PersonProperty.address.column)<br></span><span style="color: #008080;">7</span> <span style="color: #000000;">                ),<br></span><span style="color: #008080;">8</span>                 Where.eq(PersonProperty.typeId.column, 1<span style="color: #000000;">)<br></span><span style="color: #008080;">9</span>         )</pre><br></div>

<p>如上，</p>
<p>Line2条件：name模糊匹配wangjie</p>
<p>Line3条件：id小于200</p>
<p>Line5条件：age在19到39之间</p>
<p>Line6条件：address不是null</p>
<p>Line8条件：typeId等于1</p>
<p>Line4条件：Line5条件和Line6条件是or关系；</p>
<p>Line1条件：Line2、Line3、Line4、Line8条件是and关系。</p>
<p>&nbsp;</p>
<p><strong>2. QueryBuilder：</strong></p>
<p>QueryBuilder用于构建查询语句。</p>
<p>－setWhere(Where where)　　　　// 设置Where条件；</p>
<p>－setLimit(Integer limit)　　　　　　// 设置limit</p>
<p>－addSelectColumn(String… selectColumn)　　　　// 设置查询的数据列名（可以调用多遍来设置多个，默认是查询所有数据）</p>
<p>－addOrder(String column, boolean isAsc)　　　　　// 设置查询结果的排序（可以调用多遍来设置多个）</p>
<p>&nbsp;</p>
<p>QueryBuilder举例：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">public</span> List&lt;Person&gt; findPersonsByWhere() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {<br></span><span style="color: #008080;"> 2</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> queryBuilder()<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                .addSelectColumn(PersonProperty.id.column, PersonProperty.typeId.column, PersonProperty.name.column,<br></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">                        PersonProperty.age.column, PersonProperty.birth.column, PersonProperty.address.column)<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">                .setWhere(Where.and(<br></span><span style="color: #008080;"> 6</span>                         Where.like(PersonProperty.name.column, “%wangjie%”<span style="color: #000000;">),<br></span><span style="color: #008080;"> 7</span>                         Where.lt(PersonProperty.id.column, 200<span style="color: #000000;">),<br></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">                        Where.or(<br></span><span style="color: #008080;"> 9</span>                                 Where.between(PersonProperty.age.column, 19, 39<span style="color: #000000;">),<br></span><span style="color: #008080;">10</span> <span style="color: #000000;">                                Where.isNull(PersonProperty.address.column)<br></span><span style="color: #008080;">11</span> <span style="color: #000000;">                        ),<br></span><span style="color: #008080;">12</span>                         Where.eq(PersonProperty.typeId.column, 1<span style="color: #000000;">)<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">                ))<br></span><span style="color: #008080;">14</span>                 .addOrder(PersonProperty.id.column, <span style="color: #0000ff;">false</span><span style="color: #000000;">)<br></span><span style="color: #008080;">15</span>                 .addOrder(PersonProperty.name.column, <span style="color: #0000ff;">true</span><span style="color: #000000;">)<br></span><span style="color: #008080;">16</span>                 .setLimit(10<span style="color: #000000;">)<br></span><span style="color: #008080;">17</span>                 .query(<span style="color: #0000ff;">this</span><span style="color: #000000;">);<br></span><span style="color: #008080;">18</span>     }</pre><br></div>

<p>如上，通过queryBuilder()方法构建一个QueryBuilder，并设置查询的列名、Where、排序、limit等参数，最后调用query()执行查询。</p>
<p>&nbsp;</p>
<p><strong>3. UpdateBuilder：</strong></p>
<p>UpdateBuilder用于构建更新语句。</p>
<p>－setWhere(Where where)　　　　// 设置Where条件；</p>
<p>－addUpdateColumn(String column, Object value)　　　　// 添加需要更新的字段；</p>
<p>&nbsp;</p>
<p>UpdateBuilder举例：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> updatePerson() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {<br></span><span style="color: #008080;"> 2</span>         <span style="color: #0000ff;">long</span> now =<span style="color: #000000;"> System.currentTimeMillis();<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">        updateBuilder()<br></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">                .setWhere(Where.and(<br></span><span style="color: #008080;"> 5</span>                         Where.like(PersonProperty.name.column, “%wangjie%”<span style="color: #000000;">),<br></span><span style="color: #008080;"> 6</span>                         Where.lt(PersonProperty.id.column, 200<span style="color: #000000;">),<br></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">                        Where.or(<br></span><span style="color: #008080;"> 8</span>                                 Where.between(PersonProperty.age.column, 19, 39<span style="color: #000000;">),<br></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">                                Where.isNull(PersonProperty.address.column)<br></span><span style="color: #008080;">10</span> <span style="color: #000000;">                        ),<br></span><span style="color: #008080;">11</span>                         Where.eq(PersonProperty.typeId.column, 1<span style="color: #000000;">)<br></span><span style="color: #008080;">12</span> <span style="color: #000000;">                ))<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">                .addUpdateColumn(PersonProperty.birth.column, now)<br></span><span style="color: #008080;">14</span>                 .addUpdateColumn(PersonProperty.address.column, “address_” + now).update(<span style="color: #0000ff;">this</span><span style="color: #000000;">);<br></span><span style="color: #008080;">15</span>     }</pre><br></div>

<p>如上，通过updateBuilder()方法构建一个UpdateBuilder，并设置要更新的字段，最后调用update()执行查询。</p>
<p>&nbsp;</p>
<p><strong>4. DeleteBuilder：&nbsp;</strong></p>
<p>DeleteBuilder用于构建删除语句。</p>
<p>－setWhere(Where where)　　　　// 设置Where条件；</p>
<p>&nbsp;</p>
<p>DeleteBuilder举例：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> deletePerson() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {<br></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">        deleteBuilder()<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">                .setWhere(Where.and(<br></span><span style="color: #008080;"> 4</span>                         Where.like(PersonProperty.name.column, “%wangjie%”<span style="color: #000000;">),<br></span><span style="color: #008080;"> 5</span>                         Where.lt(PersonProperty.id.column, 200<span style="color: #000000;">),<br></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">                        Where.or(<br></span><span style="color: #008080;"> 7</span>                                 Where.between(PersonProperty.age.column, 19, 39<span style="color: #000000;">),<br></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">                                Where.isNull(PersonProperty.address.column)<br></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">                        ),<br></span><span style="color: #008080;">10</span>                         Where.eq(PersonProperty.typeId.column, 1<span style="color: #000000;">)<br></span><span style="color: #008080;">11</span> <span style="color: #000000;">                ))<br></span><span style="color: #008080;">12</span>                 .delete(<span style="color: #0000ff;">this</span><span style="color: #000000;">);<br></span><span style="color: #008080;">13</span>     }</pre><br></div>

<p>如上，通过deleteBuilder()方法构建一个DeleteBuilder，并设置Where条件，最后调用delete()执行查询。</p>
<p>&nbsp;</p>
<p><span style="font-size: 15px;"><strong>使用模版生成ModelProperty：</strong></span></p>
<p>如果你打算使用非反射的方式执行sql，则可以使用ModelPropertyGenerator模版来生成</p>
<p>1. 新建一个类，在main方法中执行：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008000;">/<em>*</em></span><span style="color: #008000;">
  Author: wangjie<br> <em> Email: tiantian.china.2@gmail.com
 </em> Date: 7/2/15.<br> </span><span style="color: #008000;">*/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> MyGenerator {<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {<br><br>        Class tableClazz </span>= Person.<span style="color: #0000ff;">class</span><span style="color: #000000;">;<br>        </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ModelPropertyGenerator().generate(tableClazz,<br>                </span>“example/src/main/java”<span style="color: #000000;">,<br>                tableClazz.getPackage().getName() </span>+ “.config”<span style="color: #000000;">);<br><br>    }<br><br>}</span></pre><br></div>

<p>如上，generate()方法参数如下：</p>
<p>generate(Class tableClazz, String outerDir, String packageName)</p>
<p>参数一：要生成的Property持久类的Class</p>
<p>参数二：生成的ModelProperty类文件存放目录</p>
<p>参数三：生成的ModelProperty类文件的包名</p>
<p>执行完毕后，就会在com.wangjie.rapidorm.example.database.model.config包下生成如下的ModelProperty：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">  1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> THIS CODE IS GENERATED BY RapidORM, DO NOT EDIT.</span><br><span style="color: #008080;">  2</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;">  3</span> <span style="color: #008000;"> Property of Person<br></span><span style="color: #008080;">  4</span> <span style="color: #008000;">*/</span><br><span style="color: #008080;">  5</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> PersonProperty <span style="color: #0000ff;">implements</span> IModelProperty&lt;Person&gt;<span style="color: #000000;"> {<br></span><span style="color: #008080;">  6</span><br><span style="color: #008080;">  7</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> ModelFieldMapper id = <span style="color: #0000ff;">new</span> ModelFieldMapper(0, “id”, “id”<span style="color: #000000;">);<br></span><span style="color: #008080;">  8</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> ModelFieldMapper typeId = <span style="color: #0000ff;">new</span> ModelFieldMapper(1, “typeId”, “typeId”<span style="color: #000000;">);<br></span><span style="color: #008080;">  9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> ModelFieldMapper name = <span style="color: #0000ff;">new</span> ModelFieldMapper(2, “name”, “name”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 10</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> ModelFieldMapper age = <span style="color: #0000ff;">new</span> ModelFieldMapper(3, “age”, “age”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 11</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> ModelFieldMapper address = <span style="color: #0000ff;">new</span> ModelFieldMapper(4, “address”, “address”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 12</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> ModelFieldMapper birth = <span style="color: #0000ff;">new</span> ModelFieldMapper(5, “birth”, “birth”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 13</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> ModelFieldMapper student = <span style="color: #0000ff;">new</span> ModelFieldMapper(6, “student”, “student”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 14</span><br><span style="color: #008080;"> 15</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> PersonProperty() {<br></span><span style="color: #008080;"> 16</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;"> 17</span><br><span style="color: #008080;"> 18</span><br><span style="color: #008080;"> 19</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;"> 20</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> bindInsertArgs(Person model, List&lt;Object&gt;<span style="color: #000000;"> insertArgs) {<br></span><span style="color: #008080;"> 21</span>         Integer id =<span style="color: #000000;"> model.getId();<br></span><span style="color: #008080;"> 22</span>         insertArgs.add(<span style="color: #0000ff;">null</span> == id ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : id);<br></span><span style="color: #008080;"> 23</span><br><span style="color: #008080;"> 24</span>         Integer typeId =<span style="color: #000000;"> model.getTypeId();<br></span><span style="color: #008080;"> 25</span>         insertArgs.add(<span style="color: #0000ff;">null</span> == typeId ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : typeId);<br></span><span style="color: #008080;"> 26</span><br><span style="color: #008080;"> 27</span>         String name =<span style="color: #000000;"> model.getName();<br></span><span style="color: #008080;"> 28</span>         insertArgs.add(<span style="color: #0000ff;">null</span> == name ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : name);<br></span><span style="color: #008080;"> 29</span><br><span style="color: #008080;"> 30</span>         Integer age =<span style="color: #000000;"> model.getAge();<br></span><span style="color: #008080;"> 31</span>         insertArgs.add(<span style="color: #0000ff;">null</span> == age ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : age);<br></span><span style="color: #008080;"> 32</span><br><span style="color: #008080;"> 33</span>         String address =<span style="color: #000000;"> model.getAddress();<br></span><span style="color: #008080;"> 34</span>         insertArgs.add(<span style="color: #0000ff;">null</span> == address ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : address);<br></span><span style="color: #008080;"> 35</span><br><span style="color: #008080;"> 36</span>         Long birth =<span style="color: #000000;"> model.getBirth();<br></span><span style="color: #008080;"> 37</span>         insertArgs.add(<span style="color: #0000ff;">null</span> == birth ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : birth);<br></span><span style="color: #008080;"> 38</span><br><span style="color: #008080;"> 39</span>         Boolean student =<span style="color: #000000;"> model.isStudent();<br></span><span style="color: #008080;"> 40</span>         insertArgs.add(<span style="color: #0000ff;">null</span> == student ? <span style="color: #0000ff;">null</span> : student ? 1 : 0<span style="color: #000000;">);<br></span><span style="color: #008080;"> 41</span><br><span style="color: #008080;"> 42</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;"> 43</span><br><span style="color: #008080;"> 44</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;"> 45</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> bindUpdateArgs(Person model, List&lt;Object&gt;<span style="color: #000000;"> updateArgs) {<br></span><span style="color: #008080;"> 46</span>         String name =<span style="color: #000000;"> model.getName();<br></span><span style="color: #008080;"> 47</span>         updateArgs.add(<span style="color: #0000ff;">null</span> == name ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : name);<br></span><span style="color: #008080;"> 48</span><br><span style="color: #008080;"> 49</span>         Integer age =<span style="color: #000000;"> model.getAge();<br></span><span style="color: #008080;"> 50</span>         updateArgs.add(<span style="color: #0000ff;">null</span> == age ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : age);<br></span><span style="color: #008080;"> 51</span><br><span style="color: #008080;"> 52</span>         String address =<span style="color: #000000;"> model.getAddress();<br></span><span style="color: #008080;"> 53</span>         updateArgs.add(<span style="color: #0000ff;">null</span> == address ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : address);<br></span><span style="color: #008080;"> 54</span><br><span style="color: #008080;"> 55</span>         Long birth =<span style="color: #000000;"> model.getBirth();<br></span><span style="color: #008080;"> 56</span>         updateArgs.add(<span style="color: #0000ff;">null</span> == birth ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : birth);<br></span><span style="color: #008080;"> 57</span><br><span style="color: #008080;"> 58</span>         Boolean student =<span style="color: #000000;"> model.isStudent();<br></span><span style="color: #008080;"> 59</span>         updateArgs.add(<span style="color: #0000ff;">null</span> == student ? <span style="color: #0000ff;">null</span> : student ? 1 : 0<span style="color: #000000;">);<br></span><span style="color: #008080;"> 60</span><br><span style="color: #008080;"> 61</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;"> 62</span><br><span style="color: #008080;"> 63</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;"> 64</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> bindPkArgs(Person model, List&lt;Object&gt;<span style="color: #000000;"> pkArgs) {<br></span><span style="color: #008080;"> 65</span>         Integer id =<span style="color: #000000;"> model.getId();<br></span><span style="color: #008080;"> 66</span>         pkArgs.add(<span style="color: #0000ff;">null</span> == id ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : id);<br></span><span style="color: #008080;"> 67</span><br><span style="color: #008080;"> 68</span>         Integer typeId =<span style="color: #000000;"> model.getTypeId();<br></span><span style="color: #008080;"> 69</span>         pkArgs.add(<span style="color: #0000ff;">null</span> == typeId ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : typeId);<br></span><span style="color: #008080;"> 70</span><br><span style="color: #008080;"> 71</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;"> 72</span><br><span style="color: #008080;"> 73</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;"> 74</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Person parseFromCursor(Cursor cursor) {<br></span><span style="color: #008080;"> 75</span>         Person model = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Person();<br></span><span style="color: #008080;"> 76</span>         <span style="color: #0000ff;">int</span><span style="color: #000000;"> index;<br></span><span style="color: #008080;"> 77</span>         index = cursor.getColumnIndex(“id”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 78</span>         <span style="color: #0000ff;">if</span>(-1 !=<span style="color: #000000;"> index){<br></span><span style="color: #008080;"> 79</span>             model.setId(cursor.isNull(index) ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : (cursor.getInt(index)));<br></span><span style="color: #008080;"> 80</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;"> 81</span><br><span style="color: #008080;"> 82</span>         index = cursor.getColumnIndex(“typeId”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 83</span>         <span style="color: #0000ff;">if</span>(-1 !=<span style="color: #000000;"> index){<br></span><span style="color: #008080;"> 84</span>             model.setTypeId(cursor.isNull(index) ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : (cursor.getInt(index)));<br></span><span style="color: #008080;"> 85</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;"> 86</span><br><span style="color: #008080;"> 87</span>         index = cursor.getColumnIndex(“name”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 88</span>         <span style="color: #0000ff;">if</span>(-1 !=<span style="color: #000000;"> index){<br></span><span style="color: #008080;"> 89</span>             model.setName(cursor.isNull(index) ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : (cursor.getString(index)));<br></span><span style="color: #008080;"> 90</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;"> 91</span><br><span style="color: #008080;"> 92</span>         index = cursor.getColumnIndex(“age”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 93</span>         <span style="color: #0000ff;">if</span>(-1 !=<span style="color: #000000;"> index){<br></span><span style="color: #008080;"> 94</span>             model.setAge(cursor.isNull(index) ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : (cursor.getInt(index)));<br></span><span style="color: #008080;"> 95</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;"> 96</span><br><span style="color: #008080;"> 97</span>         index = cursor.getColumnIndex(“address”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 98</span>         <span style="color: #0000ff;">if</span>(-1 !=<span style="color: #000000;"> index){<br></span><span style="color: #008080;"> 99</span>             model.setAddress(cursor.isNull(index) ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : (cursor.getString(index)));<br></span><span style="color: #008080;">100</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">101</span><br><span style="color: #008080;">102</span>         index = cursor.getColumnIndex(“birth”<span style="color: #000000;">);<br></span><span style="color: #008080;">103</span>         <span style="color: #0000ff;">if</span>(-1 !=<span style="color: #000000;"> index){<br></span><span style="color: #008080;">104</span>             model.setBirth(cursor.isNull(index) ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : (cursor.getLong(index)));<br></span><span style="color: #008080;">105</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">106</span><br><span style="color: #008080;">107</span>         index = cursor.getColumnIndex(“student”<span style="color: #000000;">);<br></span><span style="color: #008080;">108</span>         <span style="color: #0000ff;">if</span>(-1 !=<span style="color: #000000;"> index){<br></span><span style="color: #008080;">109</span>             model.setStudent(cursor.isNull(index) ? <span style="color: #0000ff;">null</span> : (cursor.getInt(index) == 1<span style="color: #000000;">));<br></span><span style="color: #008080;">110</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">111</span><br><span style="color: #008080;">112</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> model;<br></span><span style="color: #008080;">113</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">114</span><br><span style="color: #008080;">115</span> }</pre><br></div>

<p>注意：此Property类一旦生成，则不能修改；如果该持久类相关的注解属性改变，则需要重新生成这个Property类。</p>
<p>2. 在相应的持久类的@Table注解中设置propertyClazz：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> @Table(propertyClazz = PersonProperty.<span style="color: #0000ff;">class</span><span style="color: #000000;">)<br></span><span style="color: #008080;">2</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> Person <span style="color: #0000ff;">implements</span> Serializable{</pre><br></div>

<p>&nbsp;</p>
<p><span style="font-size: 16px;"><strong>如何兼容SqlCipher</strong></span></p>
<p>1. 新建MySQLCipherOpenHelper，继承net.sqlcipher.database.SQLiteOpenHelper：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.content.Context;<br></span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.rapidorm.core.dao.DatabaseProcessor;<br></span><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.rapidorm.core.delegate.database.RapidORMSQLiteDatabaseDelegate;<br></span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> net.sqlcipher.database.SQLiteDatabase;<br></span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> net.sqlcipher.database.SQLiteDatabaseHook;<br></span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> net.sqlcipher.database.SQLiteOpenHelper;<br></span><span style="color: #008080;"> 7</span><br><span style="color: #008080;"> 8</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 9</span> <span style="color: #008000;">  Author: wangjie<br></span><span style="color: #008080;">10</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;">11</span> <span style="color: #008000;">  Date: 8/17/15.<br></span><span style="color: #008080;">12</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;">13</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MySQLCipherOpenHelper <span style="color: #0000ff;">extends</span><span style="color: #000000;"> SQLiteOpenHelper {<br></span><span style="color: #008080;">14</span><br><span style="color: #008080;">15</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> RapidORMSQLiteDatabaseDelegate rapidORMSQLiteDatabaseDelegate;<br></span><span style="color: #008080;">16</span><br><span style="color: #008080;">17</span>     <span style="color: #0000ff;">public</span> MySQLCipherOpenHelper(Context context, String name, <span style="color: #0000ff;">int</span><span style="color: #000000;"> version) {<br></span><span style="color: #008080;">18</span>         <span style="color: #0000ff;">super</span>(context, name, <span style="color: #0000ff;">null</span><span style="color: #000000;">, version);<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span>     <span style="color: #0000ff;">public</span> MySQLCipherOpenHelper(Context context, String name, SQLiteDatabase.CursorFactory factory, <span style="color: #0000ff;">int</span><span style="color: #000000;"> version) {<br></span><span style="color: #008080;">22</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">(context, name, factory, version);<br></span><span style="color: #008080;">23</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">24</span><br><span style="color: #008080;">25</span>     <span style="color: #0000ff;">public</span> MySQLCipherOpenHelper(Context context, String name, SQLiteDatabase.CursorFactory factory, <span style="color: #0000ff;">int</span><span style="color: #000000;"> version, SQLiteDatabaseHook hook) {<br></span><span style="color: #008080;">26</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">(context, name, factory, version, hook);<br></span><span style="color: #008080;">27</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">28</span><br><span style="color: #008080;">29</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">30</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onCreate(SQLiteDatabase db) {<br></span><span style="color: #008080;">31</span> <span style="color: #008000;">//</span><span style="color: #008000;">        super.onCreate(db);</span><br><span style="color: #008080;">32</span>         rapidORMSQLiteDatabaseDelegate = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MySQLCipherDatabaseDelegate(db);<br></span><span style="color: #008080;">33</span>         DatabaseProcessor databaseProcessor =<span style="color: #000000;"> DatabaseProcessor.getInstance();<br></span><span style="color: #008080;">34</span>         <span style="color: #0000ff;">for</span> (Class&lt;?&gt;<span style="color: #000000;"> tableClazz : databaseProcessor.getAllTableClass()) {<br></span><span style="color: #008080;">35</span>             databaseProcessor.createTable(rapidORMSQLiteDatabaseDelegate, tableClazz, <span style="color: #0000ff;">true</span><span style="color: #000000;">);<br></span><span style="color: #008080;">36</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">37</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">38</span><br><span style="color: #008080;">39</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">40</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onUpgrade(SQLiteDatabase db, <span style="color: #0000ff;">int</span> oldVersion, <span style="color: #0000ff;">int</span><span style="color: #000000;"> newVersion) {<br></span><span style="color: #008080;">41</span> <span style="color: #008000;">//</span><span style="color: #008000;">        super.onUpgrade(db, oldVersion, newVersion);</span><br><span style="color: #008080;">42</span>         rapidORMSQLiteDatabaseDelegate = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MySQLCipherDatabaseDelegate(db);<br></span><span style="color: #008080;">43</span>         DatabaseProcessor databaseProcessor =<span style="color: #000000;"> DatabaseProcessor.getInstance();<br></span><span style="color: #008080;">44</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> todo: dev only!!!!!</span><br><span style="color: #008080;">45</span> <span style="color: #000000;">        databaseProcessor.dropAllTable(rapidORMSQLiteDatabaseDelegate);<br></span><span style="color: #008080;">46</span><br><span style="color: #008080;">47</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">48</span> }</pre><br></div>

<p>&nbsp;</p>
<p>2. 新建MySQLCipherDatabaseDelegate继承RapidORMSQLiteDatabaseDelegate，并实现以下的方法：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.database.Cursor;<br></span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.database.SQLException;<br></span><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.rapidorm.core.delegate.database.RapidORMSQLiteDatabaseDelegate;<br></span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> net.sqlcipher.database.SQLiteDatabase;<br></span><span style="color: #008080;"> 5</span><br><span style="color: #008080;"> 6</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 7</span> <span style="color: #008000;">  Author: wangjie<br></span><span style="color: #008080;"> 8</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 9</span> <span style="color: #008000;">  Date: 8/17/15.<br></span><span style="color: #008080;">10</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;">11</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MySQLCipherDatabaseDelegate <span style="color: #0000ff;">extends</span> RapidORMSQLiteDatabaseDelegate&lt;SQLiteDatabase&gt;<span style="color: #000000;"> {<br></span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> MySQLCipherDatabaseDelegate(SQLiteDatabase db) {<br></span><span style="color: #008080;">13</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">(db);<br></span><span style="color: #008080;">14</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">15</span><br><span style="color: #008080;">16</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">17</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> execSQL(String sql) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException {<br></span><span style="color: #008080;">18</span> <span style="color: #000000;">        db.execSQL(sql);<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">22</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isDbLockedByCurrentThread() {<br></span><span style="color: #008080;">23</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> db.isDbLockedByCurrentThread();<br></span><span style="color: #008080;">24</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">25</span><br><span style="color: #008080;">26</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">27</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> execSQL(String sql, Object[] bindArgs) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {<br></span><span style="color: #008080;">28</span> <span style="color: #000000;">        db.execSQL(sql, bindArgs);<br></span><span style="color: #008080;">29</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">30</span><br><span style="color: #008080;">31</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">32</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Cursor rawQuery(String sql, String[] selectionArgs) {<br></span><span style="color: #008080;">33</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> db.rawQuery(sql, selectionArgs);<br></span><span style="color: #008080;">34</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">35</span><br><span style="color: #008080;">36</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">37</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> beginTransaction() {<br></span><span style="color: #008080;">38</span> <span style="color: #000000;">        db.beginTransaction();<br></span><span style="color: #008080;">39</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">40</span><br><span style="color: #008080;">41</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">42</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setTransactionSuccessful() {<br></span><span style="color: #008080;">43</span> <span style="color: #000000;">        db.setTransactionSuccessful();<br></span><span style="color: #008080;">44</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">45</span><br><span style="color: #008080;">46</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">47</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> endTransaction() {<br></span><span style="color: #008080;">48</span> <span style="color: #000000;">        db.endTransaction();<br></span><span style="color: #008080;">49</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">50</span><br><span style="color: #008080;">51</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">52</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> close() {<br></span><span style="color: #008080;">53</span> <span style="color: #000000;">        db.close();<br></span><span style="color: #008080;">54</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">55</span> }</pre><br></div>

<p>注意这里的import，这里的SQLiteDatabase需要导入&nbsp;<span style="background-color: #d8d8d8;">net.sqlcipher.database.SQLiteDatabase</span>&nbsp;。</p>
<p>&nbsp;</p>
<p>3. 新建MySQLCipherOpenHelperDelegate继承RapidORMDatabaseOpenHelperDelegate，实现如下方法：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.wangjie.rapidorm.core.delegate.openhelper.RapidORMDatabaseOpenHelperDelegate;<br></span><span style="color: #008080;"> 2</span> <span style="color: #008080;"> 3</span><br><span style="color: #008080;"> 4</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 5</span> <span style="color: #008000;">  Author: wangjie<br></span><span style="color: #008080;"> 6</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 7</span> <span style="color: #008000;">  Date: 6/18/15.<br></span><span style="color: #008080;"> 8</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MySQLCipherOpenHelperDelegate <span style="color: #0000ff;">extends</span> RapidORMDatabaseOpenHelperDelegate&lt;MySQLCipherOpenHelper, MySQLCipherOpenHelperDelegate&gt;<span style="color: #000000;"> {<br></span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> MySQLCipherOpenHelperDelegate(MySQLCipherOpenHelper sqLiteOpenHelper) {<br></span><span style="color: #008080;">11</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">(sqLiteOpenHelper);<br></span><span style="color: #008080;">12</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">13</span><br><span style="color: #008080;">14</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> String SECRET_KEY = “1234567890abcdef”<span style="color: #000000;">;<br></span><span style="color: #008080;">15</span><br><span style="color: #008080;">16</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">17</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> MySQLCipherOpenHelperDelegate getReadableDatabase() {<br></span><span style="color: #008080;">18</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> MySQLCipherDatabaseDelegate(openHelper.getReadableDatabase(SECRET_KEY));<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">22</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> MySQLCipherOpenHelperDelegate getWritableDatabase() {<br></span><span style="color: #008080;">23</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> MySQLCipherDatabaseDelegate(openHelper.getWritableDatabase(SECRET_KEY));<br></span><span style="color: #008080;">24</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">25</span><br><span style="color: #008080;">26</span> }</pre><br></div>

<p>&nbsp;</p>
<p>4. 在DatabaseFactory中使用SqlCipher版本：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;">  Author: wangjie<br></span><span style="color: #008080;"> 3</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 4</span> <span style="color: #008000;">  Date: 6/25/15.<br></span><span style="color: #008080;"> 5</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> DatabaseFactory <span style="color: #0000ff;">extends</span> RapidORMConnection&lt;MySQLCipherOpenHelperDelegate&gt;<span style="color: #000000;"> {<br></span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">int</span> VERSION = 1<span style="color: #000000;">;<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> DatabaseFactory instance;<br></span><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">synchronized</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> DatabaseFactory getInstance() {<br></span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> instance) {<br></span><span style="color: #008080;">13</span>             instance = <span style="color: #0000ff;">new</span><span style="color: #000000;"> DatabaseFactory();<br></span><span style="color: #008080;">14</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">15</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> instance;<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">17</span><br><span style="color: #008080;">18</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> DatabaseFactory() {<br></span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">();<br></span><span style="color: #008080;">20</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">21</span><br><span style="color: #008080;">22</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">23</span>     <span style="color: #0000ff;">protected</span><span style="color: #000000;"> MySQLCipherOpenHelperDelegate getRapidORMDatabaseOpenHelper(@NonNull String databaseName) {<br></span><span style="color: #008080;">24</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> MySQLCipherOpenHelperDelegate(<span style="color: #0000ff;">new</span><span style="color: #000000;"> MySQLCipherOpenHelper(applicationContext, databaseName, VERSION));<br></span><span style="color: #008080;">25</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">26</span><br><span style="color: #008080;">27</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">28</span>     <span style="color: #0000ff;">protected</span> List&lt;Class&lt;?&gt;&gt;<span style="color: #000000;"> registerAllTableClass() {<br></span><span style="color: #008080;">29</span>         List&lt;Class&lt;?&gt;&gt; allTableClass = <span style="color: #0000ff;">new</span> ArrayList&lt;&gt;<span style="color: #000000;">();<br></span><span style="color: #008080;">30</span>         allTableClass.add(Person.<span style="color: #0000ff;">class</span><span style="color: #000000;">);<br></span><span style="color: #008080;">31</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> register all table class here…</span><br><span style="color: #008080;">32</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> allTableClass;<br></span><span style="color: #008080;">33</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">34</span> }</pre><br></div>

<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2015/06/15/Android-基于RxJava、RxAndroid的EventBus实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/06/15/Android-基于RxJava、RxAndroid的EventBus实现/" itemprop="url">[Android]基于RxJava、RxAndroid的EventBus实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-06-15T17:09:00+08:00">
                2015-06-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/06/15/Android-基于RxJava、RxAndroid的EventBus实现/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/06/15/Android-基于RxJava、RxAndroid的EventBus实现/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>以下内容为原创，欢迎转载，转载请注明</strong></p>
<p><strong><span style="color: #ff0000;">来自天天博客：<a href="http://www.cnblogs.com/tiantianbyconan/p/4578699.html%20" title="view: [Android]基于RxJava、RxAndroid的EventBus实现" target="_blank" rel="noopener"><span style="color: #ff0000;">http://www.cnblogs.com/tiantianbyconan/p/4578699.html</span></a></span>&nbsp;</strong></p>
<p>&nbsp;</p>
<p><strong><span style="line-height: 1.5;">Github：<a href="https://github.com/wangjiegulu/RxAndroidEventsSample" target="_blank" rel="noopener">https://github.com/wangjiegulu/RxAndroidEventsSample</a></span></strong></p>
<p>EventBus的作用是发布/订阅事件总线，因为项目中用到RxJava、RxAndroid，所以完全可以使用RxJava、RxAndroid来实现EventBus。</p>
<p>&nbsp;</p>
<p>1. 编写RxBus，用于存储所有事件Subjects。</p>
<p>事件是传递的最小单位，可以把任何类作为一个事件。</p>
<p>RxBus代码如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;">  Author: wangjie<br></span><span style="color: #008080;"> 3</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 4</span> <span style="color: #008000;">  Date: 6/11/15.<br></span><span style="color: #008080;"> 5</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> RxBus {<br></span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> String TAG = RxBus.<span style="color: #0000ff;">class</span><span style="color: #000000;">.getSimpleName();<br></span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> RxBus instance;<br></span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">boolean</span> DEBUG = <span style="color: #0000ff;">false</span><span style="color: #000000;">;<br></span><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">synchronized</span><span style="color: #000000;"> RxBus get() {<br></span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> instance) {<br></span><span style="color: #008080;">13</span>             instance = <span style="color: #0000ff;">new</span><span style="color: #000000;"> RxBus();<br></span><span style="color: #008080;">14</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">15</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> instance;<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">17</span><br><span style="color: #008080;">18</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> RxBus() {<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span>     <span style="color: #0000ff;">private</span> ConcurrentHashMap&lt;Object, List&lt;Subject&gt;&gt; subjectMapper = <span style="color: #0000ff;">new</span> ConcurrentHashMap&lt;&gt;<span style="color: #000000;">();<br></span><span style="color: #008080;">22</span><br><span style="color: #008080;">23</span>     @SuppressWarnings(“unchecked”<span style="color: #000000;">)<br></span><span style="color: #008080;">24</span>     <span style="color: #0000ff;">public</span> &lt;T&gt; Observable&lt;T&gt; register(@NonNull Object tag, @NonNull Class&lt;T&gt;<span style="color: #000000;"> clazz) {<br></span><span style="color: #008080;">25</span>         List&lt;Subject&gt; subjectList =<span style="color: #000000;"> subjectMapper.get(tag);<br></span><span style="color: #008080;">26</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> subjectList) {<br></span><span style="color: #008080;">27</span>             subjectList = <span style="color: #0000ff;">new</span> ArrayList&lt;&gt;<span style="color: #000000;">();<br></span><span style="color: #008080;">28</span> <span style="color: #000000;">            subjectMapper.put(tag, subjectList);<br></span><span style="color: #008080;">29</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">30</span><br><span style="color: #008080;">31</span>         Subject&lt;T, T&gt;<span style="color: #000000;"> subject;<br></span><span style="color: #008080;">32</span>         subjectList.add(subject =<span style="color: #000000;"> PublishSubject.create());<br></span><span style="color: #008080;">33</span>         <span style="color: #0000ff;">if</span> (DEBUG) Log.d(TAG, “[register]subjectMapper: “ +<span style="color: #000000;"> subjectMapper);<br></span><span style="color: #008080;">34</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> subject;<br></span><span style="color: #008080;">35</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">36</span><br><span style="color: #008080;">37</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> unregister(@NonNull Object tag, @NonNull Observable observable) {<br></span><span style="color: #008080;">38</span>         List&lt;Subject&gt; subjects =<span style="color: #000000;"> subjectMapper.get(tag);<br></span><span style="color: #008080;">39</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> !=<span style="color: #000000;"> subjects) {<br></span><span style="color: #008080;">40</span> <span style="color: #000000;">            subjects.remove((Subject) observable);<br></span><span style="color: #008080;">41</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (ABTextUtil.isEmpty(subjects)) {<br></span><span style="color: #008080;">42</span> <span style="color: #000000;">                subjectMapper.remove(tag);<br></span><span style="color: #008080;">43</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">44</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">45</span><br><span style="color: #008080;">46</span>         <span style="color: #0000ff;">if</span> (DEBUG) Log.d(TAG, “[unregister]subjectMapper: “ +<span style="color: #000000;"> subjectMapper);<br></span><span style="color: #008080;">47</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">48</span><br><span style="color: #008080;">49</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> post(@NonNull Object content) {<br></span><span style="color: #008080;">50</span> <span style="color: #000000;">        post(content.getClass().getName(), content);<br></span><span style="color: #008080;">51</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">52</span><br><span style="color: #008080;">53</span>     @SuppressWarnings(“unchecked”<span style="color: #000000;">)<br></span><span style="color: #008080;">54</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> post(@NonNull Object tag, @NonNull Object content) {<br></span><span style="color: #008080;">55</span>         List&lt;Subject&gt; subjectList =<span style="color: #000000;"> subjectMapper.get(tag);<br></span><span style="color: #008080;">56</span><br><span style="color: #008080;">57</span>         <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">ABTextUtil.isEmpty(subjectList)) {<br></span><span style="color: #008080;">58</span>             <span style="color: #0000ff;">for</span><span style="color: #000000;"> (Subject subject : subjectList) {<br></span><span style="color: #008080;">59</span> <span style="color: #000000;">                subject.onNext(content);<br></span><span style="color: #008080;">60</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">61</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">62</span>         <span style="color: #0000ff;">if</span> (DEBUG) Log.d(TAG, “[send]subjectMapper: “ +<span style="color: #000000;"> subjectMapper);<br></span><span style="color: #008080;">63</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">64</span> }</pre><br></div>

<p>如上述代码，RxBus只提供了register、unregister、post三个方法。</p>
<p>这里又加入了一个tag的概念，也可以理解为channel，注册Subject、反注册Subject和post事件的时候都需要这个tag，只有tag一致才能正常接收到事件。</p>
<p>比如有一个事件类HelloEvent，这个事件的作用是接收到后toast一个提示&ldquo;hello&rdquo;，如果两个Activity都注册了这个HelloEvent事件，但是没有tag去限制，一旦post了一个helloEvent事件后，两个Activity都会收到这个事件，导致两个Activity都会toast。如果使用tag，post这个HelloEvent的时候可以设置这个tag，只有register时也使用了这个tag才会接收到这个event。</p>
<p>2. 在Present（如Activity的onCreate）中注册一个Observer（以下以发送一个String类型的事件为例）</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> Observable&lt;String&gt; addOb =<span style="color: #000000;"> RxBus.get()<br></span><span style="color: #008080;">2</span>                 .register(“addFeedTag”, String.<span style="color: #0000ff;">class</span><span style="color: #000000;">);<br></span><span style="color: #008080;">3</span><br><span style="color: #008080;">4</span> <span style="color: #000000;">addOb.observeOn(AndroidSchedulers.mainThread())<br></span><span style="color: #008080;">5</span>                 .subscribe(s -&gt;<span style="color: #000000;"> {<br></span><span style="color: #008080;">6</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> todo: Accept event and process here</span><br><span style="color: #008080;">7</span>                 });</pre><br></div>

<p>如上，注册了一个String类型的事件，事件的tag是&ldquo;addFeedTag&rdquo;，用来增加一个Feed。使用RxAndroid在Action1中处理接收到的这个事件。</p>
<p>3. 在任何地方发送一个事件：</p>
<div class="cnblogs_code"><br><pre>RxBus.get().post(“addFeedTag”, “hello RxBus!”);</pre><br></div>

<p>这里发送了一个tag为&ldquo;addFeedTag&rdquo;的String类型的事件。</p>
<p>4. 反注册Observer：</p>
<div class="cnblogs_code"><br><pre>RxBus.get().unregister(“addFeedTag”, addOb);</pre><br></div>

<p>注意：这里的Tag都为&ldquo;addFeedTag&rdquo;。</p>
<p>&nbsp;</p>
<p><strong>下面使用注解的方式更简单方便地使用RxBus（嗯－。－这里才是重点）。</strong></p>
<p>首先来看下使用注解后的代码：</p>
<p>1. 注册Observer</p>
<p>这一步可以省略掉。</p>
<p>2. 发送一个事件（这里我们换一个事件：FeedItemClickEvent，我们定义这个事件是用来处理当Feed被点击后的事件）</p>
<div class="cnblogs_code"><br><pre>RxBus.get().post(<span style="color: #0000ff;">new</span> FeedItemClickEvent().setPosition(position).setFeed(feed));</pre><br></div>

<p>3. 接收事件，然后处理</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #000000;">@Accept<br></span><span style="color: #008080;">2</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onPostAccept(Object tag, FeedItemClickEvent event) {<br></span><span style="color: #008080;">3</span> 　　Logger.d(TAG, “onPostAccept event: “ +<span style="color: #000000;"> event);<br></span><span style="color: #008080;">4</span> 　　Feed feed =<span style="color: #000000;"> event.getFeed();<br></span><span style="color: #008080;">5</span> 　　<span style="color: #008000;">//</span><span style="color: #008000;"> 跳转到feed详情页面…</span><br><span style="color: #008080;">6</span> }</pre><br></div>

<p>如上，这里只需要编写一个方法，加上Accept注解，然后在方法中进行事件处理即可。</p>
<p>注意：方法名可以任意</p>
<p>方法参数一：必须为Object类型的tag；</p>
<p>方法参数二，如果这个方法只接收一种事件，则写明具体的事件类型，如上；如果这个方法接收多种事件，则类型需要为Object。</p>
<p>4. 反注册Observer</p>
<p>这一步也可以省略掉。</p>
<p>&nbsp;</p>
<p>接收多种事件：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #000000;">@Accept(<br></span><span style="color: #008080;"> 2</span>             acceptScheduler =<span style="color: #000000;"> AcceptScheduler.NEW_THREAD,<br></span><span style="color: #008080;"> 3</span>             value =<span style="color: #000000;"> {<br></span><span style="color: #008080;"> 4</span>                     @AcceptType(tag = ActionEvent.CLOSE, clazz = String.<span style="color: #0000ff;">class</span><span style="color: #000000;">),<br></span><span style="color: #008080;"> 5</span>                     @AcceptType(tag = ActionEvent.BACK, clazz = String.<span style="color: #0000ff;">class</span><span style="color: #000000;">),<br></span><span style="color: #008080;"> 6</span>                     @AcceptType(tag = ActionEvent.EDIT, clazz = String.<span style="color: #0000ff;">class</span><span style="color: #000000;">),<br></span><span style="color: #008080;"> 7</span>                     @AcceptType(tag = ActionEvent.REFRESH, clazz = String.<span style="color: #0000ff;">class</span><span style="color: #000000;">)<br></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    )<br></span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onPostAccept(Object tag, Object actionEvent) {<br></span><span style="color: #008080;">11</span>         Logger.d(TAG, “[ActionEvent]onPostAccept action event name: “ +<span style="color: #000000;"> actionEvent);<br></span><span style="color: #008080;">12</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> todo: Accept event and process here (in new thread)</span><br><span style="color: #008080;">13</span>     }</pre><br></div>

<p>这里@Accept注解中设置了acceptScheduler为AcceptScheduler.NEW_THREAD，指明方法运行在子线程中.</p>
<p>value中指明了接收的事件类型，这里表示这个方法接收4种类型的事件：CLOSE, BACK, EDIT, REFRESH.</p>
<p>&nbsp;</p>
<p><strong>注解解释：</strong></p>
<p><strong>@Accept注解</strong></p>
<p>acceptScheduler: 指定被注解的方法运行的Scheduler。</p>
<p>value[]: AcceptType注解数组，用于指定接收事件的tag和class。</p>
<p>&nbsp;</p>
<p><strong>@AcceptType注解：</strong></p>
<p>tag: 接收事件的tag<br>clazz: 接收事件的类型</p>
<p>&nbsp;</p>
<p><strong>AcceptScheduler：</strong></p>
<p>详情见：rx.schedulers.Schedulers和rx.android.schedulers.AndroidSchedulers</p>
<p>如果设置的是AcceptScheduler.EXECUTOR或AcceptScheduler.HANDLER，则需要在Application中配置Executor和Handler：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;">  Author: wangjie<br></span><span style="color: #008080;"> 3</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 4</span> <span style="color: #008000;">  Date: 6/15/15.<br></span><span style="color: #008080;"> 5</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MyApplication <span style="color: #0000ff;">extends</span><span style="color: #000000;"> Application {<br></span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">private</span> Executor acceptExecutor =<span style="color: #000000;"> Executors.newCachedThreadPool();<br></span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">private</span> Handler handler = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Handler(Looper.getMainLooper());<br></span><span style="color: #008080;"> 9</span><br><span style="color: #008080;">10</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onCreate() {<br></span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">.onCreate();<br></span><span style="color: #008080;">13</span>         RxBus.DEBUG = <span style="color: #0000ff;">true</span><span style="color: #000000;">;<br></span><span style="color: #008080;">14</span><br><span style="color: #008080;">15</span>         DefaultAcceptConfiguration.getInstance().registerAcceptConfiguration(<span style="color: #0000ff;">new</span><span style="color: #000000;"> DefaultAcceptConfiguration.OnDefaultAcceptConfiguration() {<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">            @Override<br></span><span style="color: #008080;">17</span>             <span style="color: #0000ff;">public</span><span style="color: #000000;"> Executor applyAcceptExecutor() {<br></span><span style="color: #008080;">18</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> acceptExecutor;<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span> <span style="color: #000000;">            @Override<br></span><span style="color: #008080;">22</span>             <span style="color: #0000ff;">public</span><span style="color: #000000;"> Handler applyAcceptHandler() {<br></span><span style="color: #008080;">23</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> handler;<br></span><span style="color: #008080;">24</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">25</span> <span style="color: #000000;">        });<br></span><span style="color: #008080;">26</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">27</span> }</pre><br></div>

<p>因为需要对Accept和AcceptType注解的解析，所以项目的BaseActivity需要使用<strong><a href="https://github.com/wangjiegulu/androidInject/blob/master/src/com/wangjie/androidinject/annotation/present/AIAppCompatActivity.java" target="_blank" rel="noopener">AIAppCompatActivity</a></strong>，然后实现parserMethodAnnotations()方法，使用<strong><a href="https://github.com/wangjiegulu/RxAndroidEventsSample/blob/master/sample/src/main/java/com/wangjie/rxandroideventssample/rxbus/RxBusAnnotationManager.java" target="_blank" rel="noopener">RxBusAnnotationManager</a></strong>对注解进行解析。</p>
<p>&nbsp;</p>
<p>参考：<a href="http://nerds.weddingpartyapp.com/tech/2014/12/24/implementing-an-event-bus-with-rxjava-rxbus/" target="_blank" rel="noopener">http://nerds.weddingpartyapp.com/tech/2014/12/24/implementing-an-event-bus-with-rxjava-rxbus/</a></p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2015/05/11/Learn-RxJava/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/05/11/Learn-RxJava/" itemprop="url">Learn RxJava</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-05-11T19:33:00+08:00">
                2015-05-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/05/11/Learn-RxJava/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/05/11/Learn-RxJava/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Learn&nbsp;RxJava</p>
<p>　　<a href="http://reactivex.io/documentation/operators.html" target="_blank" rel="noopener">http://reactivex.io/documentation/operators.html</a></p>
<p><span style="line-height: 1.5;">　　</span><a href="https://github.com/ReactiveX/RxJava/wiki/The-RxJava-Android-Module" target="_blank" rel="noopener">https://github.com/ReactiveX/RxJava/wiki/The-RxJava-Android-Module</a></p>
<p>　　<a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="noopener">https://github.com/ReactiveX/RxJava</a></p>
<p>&nbsp;</p>
<ul>
<li><a href="http://open.blogs.nytimes.com/2014/08/18/getting-groovy-with-reactive-android/?_php=true&amp;_type=blogs&amp;_php=true&amp;_type=blogs&amp;_r=1&amp;" target="_blank" rel="noopener">How the New York Times is building its Android app with Groovy/RxJava</a>&nbsp;by Mohit Pandey</li>
<li><a href="http://mttkay.github.io/blog/2013/08/25/functional-reactive-programming-on-android-with-rxjava/" target="_blank" rel="noopener">Functional Reactive Programming on Android With RxJava</a>&nbsp;and&nbsp;<a href="https://speakerdeck.com/mttkay/conquering-concurrency-bringing-the-reactive-extensions-to-the-android-platform" target="_blank" rel="noopener">Conquering concurrency - bringing the Reactive Extensions to the Android platform</a>&nbsp;by Matthias K&auml;ppler</li>
<li><a href="https://github.com/kaushikgopal/Android-RxJava" target="_blank" rel="noopener">Learning RxJava for Android by example</a>&nbsp;by Kaushik Gopal</li>
<li><a href="http://blog.futurice.com/top-7-tips-for-rxjava-on-android" target="_blank" rel="noopener">Top 7 Tips for RxJava on Android</a>&nbsp;and&nbsp;<a href="http://www.slideshare.net/TimoTuominen1/rxjava-architectures-on-android-8-android-livecode-32531688" target="_blank" rel="noopener">Rx Architectures in Android</a>&nbsp;by Timo Tuominen</li>
<li><a href="http://slid.es/yaroslavheriatovych/frponandroid" target="_blank" rel="noopener">FRP on Android</a>&nbsp;by Yaroslav Heriatovych</li>
<li><a href="http://blog.futurice.com/tech-pick-of-the-week-rx-for-net-and-rxjava-for-android" target="_blank" rel="noopener">Rx for .NET and RxJava for Android</a>&nbsp;by Olli Salonen</li>
<li><a href="http://blog.futurice.com/android-development-has-its-own-swift" target="_blank" rel="noopener">RxJava in Xtend for Android</a>&nbsp;by Andre Medeiros</li>
<li><a href="http://mnmlst-dvlpr.blogspot.de/2014/07/rxjava-and-xtend.html" target="_blank" rel="noopener">RxJava and Xtend</a>&nbsp;by Stefan Oehme</li>
<li>Grokking RxJava,&nbsp;<a href="http://blog.danlew.net/2014/09/15/grokking-rxjava-part-1/" target="_blank" rel="noopener">Part 1: The Basics</a>,&nbsp;<a href="http://blog.danlew.net/2014/09/22/grokking-rxjava-part-2/" target="_blank" rel="noopener">Part 2: Operator, Operator</a>,&nbsp;<a href="http://blog.danlew.net/2014/09/30/grokking-rxjava-part-3/" target="_blank" rel="noopener">Part 3: Reactive with Benefits</a>,&nbsp;<a href="http://blog.danlew.net/2014/10/08/grokking-rxjava-part-4/" target="_blank" rel="noopener">Part 4: Reactive Android</a>&nbsp;- published in Sep/Oct 2014 by Daniel Lew</li>
<li><a href="http://blog.dreamtobe.cn/2289.html" target="_blank" rel="noopener">http://blog.dreamtobe.cn/2289.html</a>（中文）</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2015/05/03/Android-RapidFloatingActionButton框架正式出炉/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/05/03/Android-RapidFloatingActionButton框架正式出炉/" itemprop="url">[Android]RapidFloatingActionButton框架正式出炉</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-05-03T21:28:00+08:00">
                2015-05-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/05/03/Android-RapidFloatingActionButton框架正式出炉/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/05/03/Android-RapidFloatingActionButton框架正式出炉/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #ff0000;"><strong>以下内容为原创，欢迎转载，转载请注明</strong></span></p>
<p><span style="color: #ff0000;"><strong>来自天天博客：<a href="http://www.cnblogs.com/tiantianbyconan/p/4474748.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiantianbyconan/p/4474748.html</a></strong></span></p>
<h1 id="RapidFloatingActionButton"><a href="#RapidFloatingActionButton" class="headerlink" title="RapidFloatingActionButton"></a>RapidFloatingActionButton</h1><p>Google推出了MaterialDesign的设计语言，其中FloatingActionButton就是一部分，但是Google却没有提供一个官方的FloatingActionButton控件，网上找了几个试用了下，但是始终没有找到合适的，所以，自己动手丰衣足食了。</p>
<p><a href="http://www.cnblogs.com/RapidFloatingActionButton" target="_blank" rel="noopener">RapidFloatingActionButton</a>（以下简称RFAB）是Floating Action Button的快速实现。</p>
<p><strong><span style="color: #ff0000;">Github地址：<a href="https://github.com/wangjiegulu/RapidFloatingActionButton" target="_blank" rel="noopener"><span style="color: #ff0000;">https://github.com/wangjiegulu/RapidFloatingActionButton</span></a></span></strong></p>
<p><a href="https://raw.githubusercontent.com/wangjiegulu/RapidFloatingActionButton/master/screenshot/rfab_label_list.gif" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/wangjiegulu/RapidFloatingActionButton/master/screenshot/rfab_label_list.gif" alt=""></a>&nbsp;<a href="https://raw.githubusercontent.com/wangjiegulu/RapidFloatingActionButton/master/screenshot/rfabg.gif" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/wangjiegulu/RapidFloatingActionButton/master/screenshot/rfabg.gif" alt=""></a>&nbsp;</p>
<p><a href="https://raw.githubusercontent.com/wangjiegulu/RapidFloatingActionButton/master/screenshot/rfab_01.png" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/wangjiegulu/RapidFloatingActionButton/master/screenshot/rfab_01.png" alt=""></a>&nbsp;<a href="https://raw.githubusercontent.com/wangjiegulu/RapidFloatingActionButton/master/screenshot/rfab_03.png" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/wangjiegulu/RapidFloatingActionButton/master/screenshot/rfab_03.png" alt=""></a></p>
<h1 id="使用方式："><a href="#使用方式：" class="headerlink" title="使用方式："></a><a href="https://github.com/wangjiegulu/RapidFloatingActionButton#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F" target="_blank" rel="noopener"></a>使用方式：</h1><p>依赖：<br><strong><a href="https://github.com/wangjiegulu/AndroidBucket" target="_blank" rel="noopener">AndroidBucket</a>(<a href="https://github.com/wangjiegulu/AndroidBucket" target="_blank" rel="noopener">https://github.com/wangjiegulu/AndroidBucket</a>)</strong>：基础工具包<br><strong><a href="https://github.com/wangjiegulu/androidInject" target="_blank" rel="noopener">AndroidInject</a>(<a href="https://github.com/wangjiegulu/androidInject" target="_blank" rel="noopener">https://github.com/wangjiegulu/androidInject</a>)</strong>：注解框架</p>
<p><strong><a href="https://github.com/JakeWharton/NineOldAndroids" target="_blank" rel="noopener">NineOldAndroids</a>(<a href="https://github.com/JakeWharton/NineOldAndroids" target="_blank" rel="noopener">https://github.com/JakeWharton/NineOldAndroids</a>)</strong>：兼容低版本的动画框架</p>
<h2 id="activity-main-xml："><a href="#activity-main-xml：" class="headerlink" title="activity_main.xml："></a><a href="https://github.com/wangjiegulu/RapidFloatingActionButton#activity_mainxml" target="_blank" rel="noopener"></a>activity_main.xml：</h2><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> &lt;<span style="color: #000000;">com.wangjie.rapidfloatingactionbutton.RapidFloatingActionLayout<br></span><span style="color: #008080;"> 2</span>       xmlns:rfal=”<a href="http://schemas.android.com/apk/res-auto" target="_blank" rel="noopener">http://schemas.android.com/apk/res-auto</a>“<br><span style="color: #008080;"> 3</span>       android:id=”@+id/activity_main_rfal”<br><span style="color: #008080;"> 4</span>       android:layout_width=”match_parent”<br><span style="color: #008080;"> 5</span>       android:layout_height=”match_parent”<br><span style="color: #008080;"> 6</span>       rfal:rfal_frame_color=”#ffffff”<br><span style="color: #008080;"> 7</span>       rfal:rfal_frame_alpha=”0.7”<br><span style="color: #008080;"> 8</span>       &gt;<br><span style="color: #008080;"> 9</span>   &lt;<span style="color: #000000;">com.wangjie.rapidfloatingactionbutton.RapidFloatingActionButton<br></span><span style="color: #008080;">10</span>           xmlns:rfab=”<a href="http://schemas.android.com/apk/res-auto" target="_blank" rel="noopener">http://schemas.android.com/apk/res-auto</a>“<br><span style="color: #008080;">11</span>           android:id=”@+id/activity_main_rfab”<br><span style="color: #008080;">12</span>           android:layout_width=”wrap_content”<br><span style="color: #008080;">13</span>           android:layout_height=”wrap_content”<br><span style="color: #008080;">14</span>           android:layout_alignParentRight=”true”<br><span style="color: #008080;">15</span>           android:layout_alignParentBottom=”true”<br><span style="color: #008080;">16</span>           android:layout_marginRight=”15dp”<br><span style="color: #008080;">17</span>           android:layout_marginBottom=”15dp”<br><span style="color: #008080;">18</span>           android:padding=”8dp”<br><span style="color: #008080;">19</span>           rfab:rfab_size=”normal”<br><span style="color: #008080;">20</span>           rfab:rfab_drawable=”@drawable/rfab__drawable_rfab_default”<br><span style="color: #008080;">21</span>           rfab:rfab_color_normal=”#37474f”<br><span style="color: #008080;">22</span>           rfab:rfab_color_pressed=”#263238”<br><span style="color: #008080;">23</span>           rfab:rfab_shadow_radius=”7dp”<br><span style="color: #008080;">24</span>           rfab:rfab_shadow_color=”#999999”<br><span style="color: #008080;">25</span>           rfab:rfab_shadow_dx=”0dp”<br><span style="color: #008080;">26</span>           rfab:rfab_shadow_dy=”5dp”<br><span style="color: #008080;">27</span>           /&gt;<br><span style="color: #008080;">28</span> &lt;/com.wangjie.rapidfloatingactionbutton.RapidFloatingActionLayout&gt;</pre><br></div>

<p>在需要增加RFAB最外层使用<code>&amp;lt;com.wangjie.rapidfloatingactionbutton.RapidFloatingActionLayout&amp;gt;</code>，按钮使用<code>&amp;lt;com.wangjie.rapidfloatingactionbutton.RapidFloatingActionButton&amp;gt;</code></p>
<h3 id="属性解释"><a href="#属性解释" class="headerlink" title="属性解释"></a><a href="https://github.com/wangjiegulu/RapidFloatingActionButton#%E5%B1%9E%E6%80%A7%E8%A7%A3%E9%87%8A" target="_blank" rel="noopener"></a>属性解释</h3><h4 id="RapidFloatingActionLayout"><a href="#RapidFloatingActionLayout" class="headerlink" title="RapidFloatingActionLayout:"></a><a href="https://github.com/wangjiegulu/RapidFloatingActionButton#rapidfloatingactionlayout" target="_blank" rel="noopener"></a>RapidFloatingActionLayout:</h4><div class="cnblogs_code"><br><pre><span style="color: #000000;">  rfal_frame_color: 展开RFAB时候最外覆盖层的颜色，默认是纯白色<br>  rfal_frame_alpha: 展开RFAB时候最外覆盖层的透明度(0 ~ 1)，默认是0.7</span></pre><br></div>

<h4 id="RapidFloatingActionButton-1"><a href="#RapidFloatingActionButton-1" class="headerlink" title="RapidFloatingActionButton:"></a><a href="https://github.com/wangjiegulu/RapidFloatingActionButton#rapidfloatingactionbutton-1" target="_blank" rel="noopener"></a>RapidFloatingActionButton:</h4><div class="cnblogs_code"><br><pre><span style="color: #000000;">　rfab_size: RFAB的尺寸大小，只支持两种尺寸（Material Design规范）：<br>          normal: 直径56dp<br>          mini: 直径40dp<br>  rfab_drawable: RFAB中间的图标，默认是一个”+”图标<br>  rfab_color_normal: RFAB背景的普通状态下的颜色。默认是白色<br>  rfab_color_pressed: RFAB背景的触摸按下状态的颜色。默认颜色是”#dddddd”<br>  rfab_shadow_radius: RFAB的阴影半径。默认是0，表示没有阴影<br>  rfab_shadow_color: RFAB的阴影颜色。默认是透明，另外如果rfab_shadow_radius为0，则该属性无效<br>  rfab_shadow_dx: RFAB的阴影X轴偏移量。默认是0<br>  rfab_shadow_dy: RFAB的阴影Y轴偏移量。默认是0</span></pre><br></div>

<h2 id="MainActivity："><a href="#MainActivity：" class="headerlink" title="MainActivity："></a><a href="https://github.com/wangjiegulu/RapidFloatingActionButton#mainactivity" target="_blank" rel="noopener"></a>MainActivity：</h2><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #000000;">@AILayout(R.layout.activity_main)<br></span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MainActivity <span style="color: #0000ff;">extends</span> AIActionBarActivity <span style="color: #0000ff;">implements</span><span style="color: #000000;"> RapidFloatingActionContentLabelList.OnRapidFloatingActionContentListener {<br></span><span style="color: #008080;"> 3</span><br><span style="color: #008080;"> 4</span> <span style="color: #000000;">    @AIView(R.id.activity_main_rfal)<br></span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> RapidFloatingActionLayout rfaLayout;<br></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    @AIView(R.id.activity_main_rfab)<br></span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> RapidFloatingActionButton rfaBtn;<br></span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> RapidFloatingActionButtonHelper rfabHelper;<br></span><span style="color: #008080;"> 9</span><br><span style="color: #008080;">10</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onCreate(Bundle savedInstanceState) {<br></span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">.onCreate(savedInstanceState);<br></span><span style="color: #008080;">13</span><br><span style="color: #008080;">14</span>         RapidFloatingActionContentLabelList rfaContent = <span style="color: #0000ff;">new</span><span style="color: #000000;"> RapidFloatingActionContentLabelList(context);<br></span><span style="color: #008080;">15</span>         rfaContent.setOnRapidFloatingActionContentListener(<span style="color: #0000ff;">this</span><span style="color: #000000;">);<br></span><span style="color: #008080;">16</span>         List&lt;RFACLabelItem&gt; items = <span style="color: #0000ff;">new</span> ArrayList&lt;&gt;<span style="color: #000000;">();<br></span><span style="color: #008080;">17</span>         items.add(<span style="color: #0000ff;">new</span> RFACLabelItem&lt;Integer&gt;<span style="color: #000000;">()<br></span><span style="color: #008080;">18</span>                         .setLabel(“Github: wangjiegulu”<span style="color: #000000;">)<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">                        .setResId(R.drawable.ic_launcher)<br></span><span style="color: #008080;">20</span>                         .setIconNormalColor(0xffd84315<span style="color: #000000;">)<br></span><span style="color: #008080;">21</span>                         .setIconPressedColor(0xffbf360c<span style="color: #000000;">)<br></span><span style="color: #008080;">22</span>                         .setWrapper(0<span style="color: #000000;">)<br></span><span style="color: #008080;">23</span> <span style="color: #000000;">        );<br></span><span style="color: #008080;">24</span>         items.add(<span style="color: #0000ff;">new</span> RFACLabelItem&lt;Integer&gt;<span style="color: #000000;">()<br></span><span style="color: #008080;">25</span>                         .setLabel(“tiantian.china.2@gmail.com”<span style="color: #000000;">)<br></span><span style="color: #008080;">26</span> <span style="color: #000000;">                        .setResId(R.drawable.ic_launcher)<br></span><span style="color: #008080;">27</span>                         .setIconNormalColor(0xff4e342e<span style="color: #000000;">)<br></span><span style="color: #008080;">28</span>                         .setIconPressedColor(0xff3e2723<span style="color: #000000;">)<br></span><span style="color: #008080;">29</span>                         .setWrapper(1<span style="color: #000000;">)<br></span><span style="color: #008080;">30</span> <span style="color: #000000;">        );<br></span><span style="color: #008080;">31</span>         items.add(<span style="color: #0000ff;">new</span> RFACLabelItem&lt;Integer&gt;<span style="color: #000000;">()<br></span><span style="color: #008080;">32</span>                         .setLabel(“WangJie”<span style="color: #000000;">)<br></span><span style="color: #008080;">33</span> <span style="color: #000000;">                        .setResId(R.drawable.ic_launcher)<br></span><span style="color: #008080;">34</span>                         .setIconNormalColor(0xff056f00<span style="color: #000000;">)<br></span><span style="color: #008080;">35</span>                         .setIconPressedColor(0xff0d5302<span style="color: #000000;">)<br></span><span style="color: #008080;">36</span>                         .setWrapper(2<span style="color: #000000;">)<br></span><span style="color: #008080;">37</span> <span style="color: #000000;">        );<br></span><span style="color: #008080;">38</span>         items.add(<span style="color: #0000ff;">new</span> RFACLabelItem&lt;Integer&gt;<span style="color: #000000;">()<br></span><span style="color: #008080;">39</span>                         .setLabel(“Compose”<span style="color: #000000;">)<br></span><span style="color: #008080;">40</span> <span style="color: #000000;">                        .setResId(R.drawable.ic_launcher)<br></span><span style="color: #008080;">41</span>                         .setIconNormalColor(0xff283593<span style="color: #000000;">)<br></span><span style="color: #008080;">42</span>                         .setIconPressedColor(0xff1a237e<span style="color: #000000;">)<br></span><span style="color: #008080;">43</span>                         .setWrapper(3<span style="color: #000000;">)<br></span><span style="color: #008080;">44</span> <span style="color: #000000;">        );<br></span><span style="color: #008080;">45</span> <span style="color: #000000;">        rfaContent<br></span><span style="color: #008080;">46</span> <span style="color: #000000;">                .setItems(items)<br></span><span style="color: #008080;">47</span>                 .setIconShadowRadius(ABTextUtil.dip2px(context, 5<span style="color: #000000;">))<br></span><span style="color: #008080;">48</span>                 .setIconShadowColor(0xff999999<span style="color: #000000;">)<br></span><span style="color: #008080;">49</span>                 .setIconShadowDy(ABTextUtil.dip2px(context, 5<span style="color: #000000;">))<br></span><span style="color: #008080;">50</span> <span style="color: #000000;">        ;<br></span><span style="color: #008080;">51</span><br><span style="color: #008080;">52</span>         rfabHelper = <span style="color: #0000ff;">new</span><span style="color: #000000;"> RapidFloatingActionButtonHelper(<br></span><span style="color: #008080;">53</span> <span style="color: #000000;">                context,<br></span><span style="color: #008080;">54</span> <span style="color: #000000;">                rfaLayout,<br></span><span style="color: #008080;">55</span> <span style="color: #000000;">                rfaBtn,<br></span><span style="color: #008080;">56</span> <span style="color: #000000;">                rfaContent<br></span><span style="color: #008080;">57</span> <span style="color: #000000;">        ).build();<br></span><span style="color: #008080;">58</span><br><span style="color: #008080;">59</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">60</span><br><span style="color: #008080;">61</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">62</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onRFACItemLabelClick(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position, RFACLabelItem item) {<br></span><span style="color: #008080;">63</span>         Toast.makeText(getContext(), “clicked label: “ +<span style="color: #000000;"> position, Toast.LENGTH_SHORT).show();<br></span><span style="color: #008080;">64</span> <span style="color: #000000;">        rfabHelper.toggleContent();<br></span><span style="color: #008080;">65</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">66</span><br><span style="color: #008080;">67</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">68</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onRFACItemIconClick(<span style="color: #0000ff;">int</span><span style="color: #000000;"> position, RFACLabelItem item) {<br></span><span style="color: #008080;">69</span>         Toast.makeText(getContext(), “clicked icon: “ +<span style="color: #000000;"> position, Toast.LENGTH_SHORT).show();<br></span><span style="color: #008080;">70</span> <span style="color: #000000;">        rfabHelper.toggleContent();<br></span><span style="color: #008080;">71</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">72</span> }</pre><br></div>

<p>除了xml中设置的<code>RapidFloatingActionLayout</code>和<code>RapidFloatingActionButton</code>之外，还需要<code>RapidFloatingActionContent</code>的实现类来填充和指定RFAB的内容和形式。<br>这里提供了一个快速的<code>RapidFloatingActionContent</code>的实现解决方案:<code>RapidFloatingActionContentLabelList</code>。你可以加入多个item（RFACLabelItem，当然，不建议加太多的item，导致超过一个屏幕），然后设置每个item的颜色、图标、阴影、label的背景图片、字体大小颜色甚至动画。<br>它的效果可参考<a href="https://github.com/wangjiegulu/RapidFloatingActionButton/tree/master/screenshot" target="_blank" rel="noopener">最上面的效果图片</a>或者<a href="https://play.google.com/store/apps/details?id=com.google.android.apps.inbox" target="_blank" rel="noopener">Google的Inbox</a>的效果。<br>除此之外，你还需要使用<code>RapidFloatingActionButtonHelper</code>来把以上所有零散的组件组合起来。</p>
<h1 id="关于扩展："><a href="#关于扩展：" class="headerlink" title="关于扩展："></a><a href="https://github.com/wangjiegulu/RapidFloatingActionButton#%E5%85%B3%E4%BA%8E%E6%89%A9%E5%B1%95" target="_blank" rel="noopener"></a>关于扩展：</h1><p>如果你不喜欢默认提供的<code>RapidFloatingActionContentLabelList</code>，理论上你可以扩展自己的内容样式。方法是继承<code>com.wangjie.rapidfloatingactionbutton.RapidFloatingActionContent</code>，然后初始化内容布局和样式，并调用父类的<code>setRootView(xxx);</code>方法即可。如果你需要增加动画，可以重写如下方法：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onExpandAnimator(AnimatorSet animatorSet);<br></span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onCollapseAnimator(AnimatorSet animatorSet);</pre><br></div>

<p>把需要的Animator增加到animatorSet中即可<br><code>另外，作者也会不定期增加更多的RapidFloatingActionContent的扩展</code></p>
<h1 id="License"><a href="#License" class="headerlink" title="License"></a><a href="https://github.com/wangjiegulu/RapidFloatingActionButton#license" target="_blank" rel="noopener"></a>License</h1><div class="cnblogs_code"><br><pre><span style="color: #000000;">Copyright 2015 Wang Jie<br><br>Licensed under the Apache License, Version 2.0 (the “License”);<br>you may not use this file except in compliance with the License.<br>You may obtain a copy of the License at<br><br>   <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener">http://www.apache.org/licenses/LICENSE-2.0</a><br><br>Unless required by applicable law or agreed to in writing, software<br>distributed under the License is distributed on an “AS IS” BASIS,<br>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.<br>See the License for the specific language governing permissions and<br>limitations under the License.</span></pre><br></div>

<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2015/04/03/Android-Activity跳转传递任意类型的数据、Activity为SingleTask时代替StartActivityForResult的解决方案/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/04/03/Android-Activity跳转传递任意类型的数据、Activity为SingleTask时代替StartActivityForResult的解决方案/" itemprop="url">[Android]Activity跳转传递任意类型的数据、Activity为SingleTask时代替StartActivityForResult的解决方案</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-04-03T12:15:00+08:00">
                2015-04-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/04/03/Android-Activity跳转传递任意类型的数据、Activity为SingleTask时代替StartActivityForResult的解决方案/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/04/03/Android-Activity跳转传递任意类型的数据、Activity为SingleTask时代替StartActivityForResult的解决方案/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #ff0000;"><strong>以下内容为原创，欢迎转载，转载请注明</strong></span></p>
<p><span style="color: #ff0000;"><strong>来自天天博客：<a href="http://www.cnblogs.com/tiantianbyconan/p/4389674.html" title="view: [Android]Activity跳转传递任意类型的数据、Activity为SingleTask时代替StartActivity的解决方案" target="_blank" rel="noopener">http://www.cnblogs.com/tiantianbyconan/p/4389674.html</a><a href="http://www.cnblogs.com/tiantianbyconan/p/4388175.html%20" target="_blank" rel="noopener"><span style="color: #ff0000;"><br></span></a></strong></span></p>
<p>&nbsp;</p>
<p>需求：在ActivityA跳转到ActivityB，然后在ActivityB操作完返回数据给ActivityA。</p>
<p>这个很普遍的需求，一般情况是使用startActivityForResult的方式去完成。</p>
<p>但是当ActivityB为SingleTask时，这个方式就无效了。你会发现当你执行startActivityForResult后，onActivityResult方法马上就会被回调。至于为什么会出现这种情况，参考这位老兄的文章就可以理解<a href="http://blog.csdn.net/sodino/article/details/22101881" target="_blank" rel="noopener">http://blog.csdn.net/sodino/article/details/22101881</a>。</p>
<p>解决这种情况的方法，第一种是把ActivityA也设置为SingleTask，然后在ActivityB中startActivity(context, ActivityA.class)，然后ActivityA在onNewIntent(Intent intent)方法中去获取传递数据，这样的方式不仅破坏了ActivityA的lauchMode，而且还需要ActivityB中启动指定的ActivityA。</p>
<p>所以，如果能把ActivityA的当前对象（实现某个接口）传到ActivityB中，然后ActivityB中通过接口直接回调那就解决问题了。</p>
<p>但是问题是怎么把当前对象传过去，使用Intent显然不行。</p>
<p>思路是维护一个StoragePool，里面可以暂存需要传递的数据。相当于一个暂存区，ActivityA跳转前，把数据放入这个暂存区，获得一个唯一标识，然后把这个唯一标识使用Intent的方式传递给ActivityB，然后ActivityB拿到这个唯一标识后去暂存区去取数据就好了。</p>
<p>暂存区StoragePool代码如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<strong></strong></span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;"> <em> Author: wangjie<br></em></span><span style="color: #008080;"> 3</span> <span style="color: #008000;">  Email: tiantian.china.2@gmail.com<br></span><span style="color: #008080;"> 4</span> <span style="color: #008000;"> <em> Date: 3/30/15.<br></em></span><span style="color: #008080;"> 5</span>  <span style="color: #008000;">/</span><br><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> StoragePool {<br></span><span style="color: #008080;"> 7</span>     <span style="color: #008000;">/</span><br><span style="color: #008080;"> 8</span> <span style="color: #008000;">     <em> key   – 标识是哪一个intent的（UUID）<br></em></span><span style="color: #008080;"> 9</span> <span style="color: #008000;">     <br></span><span style="color: #008080;">10</span> <span style="color: #008000;">     <em>         |- key – 存储的对象标识（StorageKey，使用UUID唯一）<br></em></span><span style="color: #008080;">11</span> <span style="color: #008000;">      value –|<br></span><span style="color: #008080;">12</span> <span style="color: #008000;">     <em>         |- value – 存储的内容<br></em></span><span style="color: #008080;">13</span>      <span style="color: #008000;">/</span><br><span style="color: #008080;">14</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> ConcurrentHashMap&lt;String, HashMap&lt;StorageKey, WeakReference&lt;Object&gt;&gt;&gt; storageMapper = <span style="color: #0000ff;">new</span> ConcurrentHashMap&lt;&gt;<span style="color: #000000;">();<br></span><span style="color: #008080;">15</span><br><span style="color: #008080;">16</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> StoragePool() {<br></span><span style="color: #008080;">17</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">18</span><br><span style="color: #008080;">19</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> storage(String tagUUID, StorageKey key, Object content) {<br></span><span style="color: #008080;">20</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> == key || <span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> content) {<br></span><span style="color: #008080;">21</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;<br></span><span style="color: #008080;">22</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">23</span>         HashMap&lt;StorageKey, WeakReference&lt;Object&gt;&gt; extraMapper =<span style="color: #000000;"> storageMapper.get(tagUUID);<br></span><span style="color: #008080;">24</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> extraMapper) {<br></span><span style="color: #008080;">25</span>             extraMapper = <span style="color: #0000ff;">new</span> HashMap&lt;&gt;<span style="color: #000000;">();<br></span><span style="color: #008080;">26</span> <span style="color: #000000;">            storageMapper.put(tagUUID, extraMapper);<br></span><span style="color: #008080;">27</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">28</span>         extraMapper.put(key, <span style="color: #0000ff;">new</span> WeakReference&lt;&gt;<span style="color: #000000;">(content));<br></span><span style="color: #008080;">29</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">30</span><br><span style="color: #008080;">31</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> Object remove(String tagUUID, StorageKey key) {<br></span><span style="color: #008080;">32</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> key) {<br></span><span style="color: #008080;">33</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;<br></span><span style="color: #008080;">34</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">35</span>         HashMap&lt;StorageKey, WeakReference&lt;Object&gt;&gt; extraMapper =<span style="color: #000000;"> storageMapper.get(tagUUID);<br></span><span style="color: #008080;">36</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> extraMapper) {<br></span><span style="color: #008080;">37</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;<br></span><span style="color: #008080;">38</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">39</span><br><span style="color: #008080;">40</span>         WeakReference&lt;Object&gt; ref =<span style="color: #000000;"> extraMapper.remove(key);<br></span><span style="color: #008080;">41</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (ABTextUtil.isEmpty(extraMapper)) {<br></span><span style="color: #008080;">42</span> <span style="color: #000000;">            storageMapper.remove(tagUUID);<br></span><span style="color: #008080;">43</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">44</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span> == ref ? <span style="color: #0000ff;">null</span><span style="color: #000000;"> : ref.get();<br></span><span style="color: #008080;">45</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">46</span><br><span style="color: #008080;">47</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> HashMap&lt;StorageKey, WeakReference&lt;Object&gt;&gt;<span style="color: #000000;"> remove(String tagUUID) {<br></span><span style="color: #008080;">48</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> tagUUID) {<br></span><span style="color: #008080;">49</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;<br></span><span style="color: #008080;">50</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">51</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> storageMapper.remove(tagUUID);<br></span><span style="color: #008080;">52</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">53</span><br><span style="color: #008080;">54</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> clear() {<br></span><span style="color: #008080;">55</span> <span style="color: #000000;">        storageMapper.clear();<br></span><span style="color: #008080;">56</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">57</span><br><span style="color: #008080;">58</span> }</pre><br></div>

<p>如上代码，StoragePool维护了一个HashMap，key是一个UUID，代表唯一的一个Intent跳转，ActivityA跳转时会把这个UUID传递到ActivityB，ActivityB就是通过这个UUID来获取这次跳转需要传递的数据的。value也是一个HashMap，里面存储了某次跳转传递的所有数据。key是StorageKey，实质上也是一个UUID，value是任意的数据。</p>
<p>跳转前的存储数据和真正的StartActivity都需要使用StorageIntentCenter来进行操作，代码如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;">  Author: wangjie<br></span><span style="color: #008080;"> 3</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 4</span> <span style="color: #008000;">  Date: 3/31/15.<br></span><span style="color: #008080;"> 5</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> StorageIntentCenter {<br></span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> String STORAGE_INTENT_CENTER_KEY_UUID = StorageIntentCenter.<span style="color: #0000ff;">class</span>.getSimpleName() + “_UUID”<span style="color: #000000;">;<br></span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> String TAG = StorageIntentCenter.<span style="color: #0000ff;">class</span><span style="color: #000000;">.getSimpleName();<br></span><span style="color: #008080;"> 9</span><br><span style="color: #008080;">10</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Intent intent;<br></span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String uuid;<br></span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">private</span> HashMap&lt;StorageKey, Object&gt;<span style="color: #000000;"> extras;<br></span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isUsed;<br></span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> StorageIntentCenter() {<br></span><span style="color: #008080;">15</span>         intent = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Intent();<br></span><span style="color: #008080;">16</span>         uuid =<span style="color: #000000;"> java.util.UUID.randomUUID().toString();<br></span><span style="color: #008080;">17</span> <span style="color: #000000;">        intent.putExtra(STORAGE_INTENT_CENTER_KEY_UUID, uuid);<br></span><span style="color: #008080;">18</span>         isUsed = <span style="color: #0000ff;">false</span><span style="color: #000000;">;<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> StorageIntentCenter putExtra(String intentKey, Object content){<br></span><span style="color: #008080;">22</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> content) {<br></span><span style="color: #008080;">23</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;<br></span><span style="color: #008080;">24</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">25</span>         StorageKey storageKey = <span style="color: #0000ff;">new</span><span style="color: #000000;"> StorageKey(content.getClass());<br></span><span style="color: #008080;">26</span> <span style="color: #000000;">        intent.putExtra(intentKey, storageKey);<br></span><span style="color: #008080;">27</span>         <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> extras){<br></span><span style="color: #008080;">28</span>             extras = <span style="color: #0000ff;">new</span> HashMap&lt;&gt;<span style="color: #000000;">();<br></span><span style="color: #008080;">29</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">30</span> <span style="color: #000000;">        extras.put(storageKey, content);<br></span><span style="color: #008080;">31</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">;<br></span><span style="color: #008080;">32</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">33</span><br><span style="color: #008080;">34</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> startActivity(Context packageContext, Class&lt;?&gt;<span style="color: #000000;"> cls){<br></span><span style="color: #008080;">35</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;">(isUsed){<br></span><span style="color: #008080;">36</span>             Logger.e(TAG, <span style="color: #0000ff;">this</span> + “ can not be reuse!”<span style="color: #000000;">);<br></span><span style="color: #008080;">37</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;<br></span><span style="color: #008080;">38</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">39</span> <span style="color: #000000;">        intent.setClass(packageContext, cls);<br></span><span style="color: #008080;">40</span>         <span style="color: #0000ff;">if</span>(!<span style="color: #000000;">ABTextUtil.isEmpty(extras)){<br></span><span style="color: #008080;">41</span>             Set&lt;Map.Entry&lt;StorageKey, Object&gt;&gt; entrySet =<span style="color: #000000;"> extras.entrySet();<br></span><span style="color: #008080;">42</span>             <span style="color: #0000ff;">for</span>(Map.Entry&lt;StorageKey, Object&gt;<span style="color: #000000;"> entry : entrySet){<br></span><span style="color: #008080;">43</span> <span style="color: #000000;">                StoragePool.storage(uuid, entry.getKey(), entry.getValue());<br></span><span style="color: #008080;">44</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">45</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">46</span>         isUsed = <span style="color: #0000ff;">true</span><span style="color: #000000;">;<br></span><span style="color: #008080;">47</span> <span style="color: #000000;">        packageContext.startActivity(intent);<br></span><span style="color: #008080;">48</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">49</span><br><span style="color: #008080;">50</span><br><span style="color: #008080;">51</span> }</pre><br></div>

<p>每个StorageIntentCenter都维护了一个真正跳转的Intent，一个此次跳转的uuid和所有需要传递的数据。</p>
<p>&nbsp;</p>
<p>使用方式（以从MainActivity跳转到OtherActivity为例）：</p>
<p>MainActivity中：</p>
<div class="cnblogs_code"><br><pre><span style="color: #000000;">@AILayout(R.layout.main)<br></span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MainActivity <span style="color: #0000ff;">extends</span> BaseActivity <span style="color: #0000ff;">implements</span><span style="color: #000000;"> ICommunicate {<br><br>    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> String TAG = MainActivity.<span style="color: #0000ff;">class</span><span style="color: #000000;">.getSimpleName();<br><br>    @Override<br>    @AIClick({R.id.ac_test_a_btn})<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onClickCallbackSample(View view) {<br>        </span><span style="color: #0000ff;">switch</span><span style="color: #000000;"> (view.getId()) {<br>            </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> R.id.ac_test_a_btn:<br>                </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> StorageIntentCenter()<br>                        .putExtra(</span>“iCommunicate”, <span style="color: #0000ff;">this</span><span style="color: #000000;">)<br>                        .putExtra(</span>“testString”, “hello world”<span style="color: #000000;">)<br>                        .putExtra(</span>“testFloat”, 3.2f<span style="color: #000000;">)<br>                        .startActivity(context, OtherActivity.</span><span style="color: #0000ff;">class</span><span style="color: #000000;">);<br><br>                </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br>        }<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> hello(String content) {<br>        Logger.d(TAG, </span>“hello received: “ +<span style="color: #000000;"> content);<br>    }<br><br>}</span></pre><br></div>

<p>&nbsp;</p>
<p>OtherActivity继承了BaseActivity。</p>
<p>BaseActivity：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;">  Author: wangjie<br></span><span style="color: #008080;"> 3</span> <span style="color: #008000;"> <em> Email: tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 4</span> <span style="color: #008000;">  Date: 4/2/15.<br></span><span style="color: #008080;"> 5</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> BaseActivity <span style="color: #0000ff;">extends</span><span style="color: #000000;"> AIActivity {<br></span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String storageIntentCenterUUID;<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onCreate(Bundle savedInstanceState) {<br></span><span style="color: #008080;">11</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">.onCreate(savedInstanceState);<br></span><span style="color: #008080;">12</span><br><span style="color: #008080;">13</span> <span style="color: #000000;">        initExtraFromStorage();<br></span><span style="color: #008080;">14</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> remove extra from StoragePool</span><br><span style="color: #008080;">15</span> <span style="color: #000000;">        StoragePool.remove(storageIntentCenterUUID);<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">17</span><br><span style="color: #008080;">18</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> initExtraFromStorage() {<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">final</span> &lt;T&gt; T getExtraFromStorage(String key, Class&lt;T&gt;<span style="color: #000000;"> contentType) {<br></span><span style="color: #008080;">22</span>         StorageKey storageKey =<span style="color: #000000;"> (StorageKey) getIntent().getSerializableExtra(key);<br></span><span style="color: #008080;">23</span>         <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> storageIntentCenterUUID) {<br></span><span style="color: #008080;">24</span>             storageIntentCenterUUID =<span style="color: #000000;"> getIntent().getStringExtra(StorageIntentCenter.STORAGE_INTENT_CENTER_KEY_UUID);<br></span><span style="color: #008080;">25</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">26</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> (T) StoragePool.remove(storageIntentCenterUUID, storageKey);<br></span><span style="color: #008080;">27</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">28</span><br><span style="color: #008080;">29</span> }</pre><br></div>

<p>Line15：为了防止跳转到OtherActivity后，如果没有去暂存区把数据取出来从而导致暂存区有无用的数据（甚至内存泄漏，暂存区使用软引用也是为了防止这种情况的发生），所以这里提供一个initExtraFromStorage方法让子类重写，子类可以在这个方法中去把数据取出来。然后在initExtraFromStorage方法执行完毕后，再及时把暂存区的数据删除。</p>
<p>Line21～27:这里提供了从暂存区提取数据的方法供子类调用。</p>
<p>&nbsp;</p>
<p>OtherActivity：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008000;">/<em>*</em></span><span style="color: #008000;">
  Author: wangjie<br> <em> Email: tiantian.china.2@gmail.com
 </em> Date: 4/2/15.<br> </span><span style="color: #008000;">*/</span><span style="color: #000000;"><br>@AILayout(R.layout.other)<br></span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> OtherActivity <span style="color: #0000ff;">extends</span><span style="color: #000000;"> BaseActivity{<br>    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> String TAG = OtherActivity.<span style="color: #0000ff;">class</span><span style="color: #000000;">.getSimpleName();<br><br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> ICommunicate iCommunicate;<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> String testString;<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Float testFloat;<br><br>    @Override<br>    </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onCreate(Bundle savedInstanceState) {<br>        </span><span style="color: #0000ff;">super</span><span style="color: #000000;">.onCreate(savedInstanceState);<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> initExtraFromStorage() {<br>        iCommunicate </span>= getExtraFromStorage(“iCommunicate”, ICommunicate.<span style="color: #0000ff;">class</span><span style="color: #000000;">);<br>        testString </span>= getExtraFromStorage(“testString”, String.<span style="color: #0000ff;">class</span><span style="color: #000000;">);<br>        testFloat </span>= getExtraFromStorage(“testFloat”, Float.<span style="color: #0000ff;">class</span><span style="color: #000000;">);<br>    }<br><br>    @Override<br>    @AIClick({R.id.other_btn})<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onClickCallbackSample(View view) {<br>        </span><span style="color: #0000ff;">switch</span><span style="color: #000000;">(view.getId()){<br>            </span><span style="color: #0000ff;">case</span><span style="color: #000000;"> R.id.other_btn:<br>                </span><span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> iCommunicate){<br>                    </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;<br>                }<br>                Logger.d(TAG, </span>“iCommunicate: “ +<span style="color: #000000;"> iCommunicate);<br>                iCommunicate.hello(</span>“content from ACTestBActivity!”<span style="color: #000000;">);<br><br>                Logger.d(TAG, </span>“testString: “ +<span style="color: #000000;"> testString);<br>                Logger.d(TAG, </span>“testFloat: “ +<span style="color: #000000;"> testFloat);<br>                finish();<br><br>                </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br>        }<br>    }<br>}</span></pre><br></div>

<p>如上代码OtherActivity中获取了从MainActivity中传递过来的MainActivity实例，在点击事件发生后通过MainActivity实例进行直接回调。</p>
<p>日志打印如下：</p>
<div class="cnblogs_code"><br><pre>04-03 12:09:52.184  25529-25529/com.wangjie.androidstorageintent D/<span style="color: #000000;">OtherActivity﹕ iCommunicate: com.wangjie.androidstorageintent.sample.MainActivity@42879ff8<br></span>04-03 12:09:52.184  25529-25529/com.wangjie.androidstorageintent D/MainActivity﹕ hello received: content from ACTestBActivity!<br>04-03 12:09:52.184  25529-25529/com.wangjie.androidstorageintent D/<span style="color: #000000;">OtherActivity﹕ testString: hello world<br></span>04-03 12:09:52.184  25529-25529/com.wangjie.androidstorageintent D/OtherActivity﹕ testFloat: 3.2</pre><br></div>

<p>MainActivity被回调，并获取了数据&ldquo;content from ACTestBActivity!&rdquo;字符串。</p>
<p>&nbsp;</p>
<p><span style="color: #ff0000;"><strong>注：</strong></span></p>
<p><span style="color: #ff0000;"><strong>1. 以上使用的代码已托管到github：<a href="https://github.com/wangjiegulu/AndroidStorageIntent" target="_blank" rel="noopener"><span style="color: #ff0000;">https://github.com/wangjiegulu/AndroidStorageIntent</span></a></strong></span></p>
<p><span style="color: #ff0000;"><strong>2. 上面的注解实现使用AndroidInject：<a href="https://github.com/wangjiegulu/androidInject" target="_blank" rel="noopener"><span style="color: #ff0000;">https://github.com/wangjiegulu/androidInject</span></a></strong></span></p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/my_avatar.jpg"
                alt="Wang Jie" />
            
              <p class="site-author-name" itemprop="name">Wang Jie</p>
              <p class="site-description motion-element" itemprop="description">Wang Jie's blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">144</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/wangjiegulu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:tiantian.china.2@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://plus.google.com/+%E5%A4%A9%E5%A4%A9wangjie" target="_blank" title="Google">
                      
                        <i class="fa fa-fw fa-google"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/wangjiegulu" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/2124006/wangjie" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/wangjiegulu" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i></a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.cnblogs.com/tiantianbyconan/" title="cnblog" target="_blank">cnblog</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wang Jie</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>








        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://blog-wangjiegulu-com.disqus.com/count.js" async></script>
    

    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "default";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "GooglePlus,Evernote,Twitter,Facebook,Douban,Weibo";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  

</body>
</html>
