<!DOCTYPE html>




<html class="theme-next muse" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="WAND JIE" type="application/atom+xml" />






<meta name="description" content="Wang Jie&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="WAND JIE">
<meta property="og:url" content="http://blog.wangjiegulu.com/page/10/index.html">
<meta property="og:site_name" content="WAND JIE">
<meta property="og:description" content="Wang Jie&apos;s blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WAND JIE">
<meta name="twitter:description" content="Wang Jie&apos;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.wangjiegulu.com/page/10/"/>





  <title>WAND JIE</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-111189680-2', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">WAND JIE</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">TO BE AN ARTIST-ENGINNER</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2013/09/24/java使用动态代理来实现AOP（日志记录）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/09/24/java使用动态代理来实现AOP（日志记录）/" itemprop="url">java使用动态代理来实现AOP（日志记录）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-09-24T12:05:00+08:00">
                2013-09-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/09/24/java使用动态代理来实现AOP（日志记录）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/09/24/java使用动态代理来实现AOP（日志记录）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="line-height: 1.5; color: #ff0000;">以下内容为原创，转载时请注明链接地址：<a href="http://www.cnblogs.com/tiantianbyconan/p/3336627.html" target="_blank" rel="noopener"><span style="color: #ff0000;">http://www.cnblogs.com/tiantianbyconan/p/3336627.html</span></a></span></p>
<p><span style="line-height: 1.5;">AOP（面向方面）的思想，就是把项目共同的那部分功能分离开来，比如日志记录，避免在业务逻辑里面夹杂着跟业务逻辑无关的代码。</span></p>
<p>下面是一个AOP实现的简单例子：</p>
<p><img src="http://images.cnitblog.com/blog/378300/201309/24111801-c8f719406a074bf5805d2a94ac2dcccb.jpg" alt=""></p>
<p>首先定义一些业务方法：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<strong></strong></span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;"> <em> Created with IntelliJ IDEA.<br></em></span><span style="color: #008080;"> 3</span> <span style="color: #008000;">  Author: wangjie  email:tiantian.china.2@gmail.com<br></span><span style="color: #008080;"> 4</span> <span style="color: #008000;"> <em> Date: 13-9-23<br></em></span><span style="color: #008080;"> 5</span> <span style="color: #008000;">  Time: 下午3:49<br></span><span style="color: #008080;"> 6</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> BussinessService {<br></span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String login(String username, String password);<br></span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String find();<br></span><span style="color: #008080;">10</span> <span style="color: #000000;">}<br></span><span style="color: #008080;">11</span><br><span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> BussinessServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> BussinessService {<br></span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">private</span> Logger logger = Logger.getLogger(<span style="color: #0000ff;">this</span><span style="color: #000000;">.getClass().getSimpleName());<br></span><span style="color: #008080;">14</span><br><span style="color: #008080;">15</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String login(String username, String password) {<br></span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">return</span> “login success”<span style="color: #000000;">;<br></span><span style="color: #008080;">18</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">19</span><br><span style="color: #008080;">20</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">21</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String find() {<br></span><span style="color: #008080;">22</span>         <span style="color: #0000ff;">return</span> “find success”<span style="color: #000000;">;<br></span><span style="color: #008080;">23</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">24</span><br><span style="color: #008080;">25</span> }</pre><br></div><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/</span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;"> <em> Created with IntelliJ IDEA.<br></em></span><span style="color: #008080;"> 3</span> <span style="color: #008000;">  Author: wangjie  email:tiantian.china.2@gmail.com<br></span><span style="color: #008080;"> 4</span> <span style="color: #008000;"> <em> Date: 13-9-24<br></em></span><span style="color: #008080;"> 5</span> <span style="color: #008000;">  Time: 上午10:27<br></span><span style="color: #008080;"> 6</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> WorkService {<br></span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String work();<br></span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String sleep();<br></span><span style="color: #008080;">10</span> <span style="color: #000000;">}<br></span><span style="color: #008080;">11</span><br><span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> WorkServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> WorkService{<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String work() {<br></span><span style="color: #008080;">15</span>         <span style="color: #0000ff;">return</span> “work success”<span style="color: #000000;">;<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">17</span><br><span style="color: #008080;">18</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">19</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String sleep() {<br></span><span style="color: #008080;">20</span>         <span style="color: #0000ff;">return</span> “sleep success”<span style="color: #000000;">;<br></span><span style="color: #008080;">21</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">22</span> }</pre><br></div>

<p>实现InvocationHandler接口，使用map来存储不同的InvocationHandler对象，避免生成过多。</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.aoptest2.invohandler;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.reflect.InvocationHandler;<br></span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.reflect.Method;<br></span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.reflect.Proxy;<br></span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Arrays;<br></span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.HashMap;<br></span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.logging.Logger;<br></span><span style="color: #008080;"> 9</span><br><span style="color: #008080;">10</span> <span style="color: #008000;">/<strong></strong></span><br><span style="color: #008080;">11</span> <span style="color: #008000;"> <em> Created with IntelliJ IDEA.<br></em></span><span style="color: #008080;">12</span> <span style="color: #008000;">  Author: wangjie  email:tiantian.china.2@gmail.com<br></span><span style="color: #008080;">13</span> <span style="color: #008000;"> <em> Date: 13-9-23<br></em></span><span style="color: #008080;">14</span> <span style="color: #008000;">  Time: 下午3:47<br></span><span style="color: #008080;">15</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;">16</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> LogInvoHandler <span style="color: #0000ff;">implements</span><span style="color: #000000;"> InvocationHandler{<br></span><span style="color: #008080;">17</span>     <span style="color: #0000ff;">private</span> Logger logger = Logger.getLogger(<span style="color: #0000ff;">this</span><span style="color: #000000;">.getClass().getSimpleName());<br></span><span style="color: #008080;">18</span><br><span style="color: #008080;">19</span>     <span style="color: #0000ff;">private</span> Object target; <span style="color: #008000;">//</span><span style="color: #008000;"> 代理目标</span><br><span style="color: #008080;">20</span>     <span style="color: #0000ff;">private</span> Object proxy; <span style="color: #008000;">//</span><span style="color: #008000;"> 代理对象</span><br><span style="color: #008080;">21</span><br><span style="color: #008080;">22</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> HashMap&lt;Class&lt;?&gt;, LogInvoHandler&gt; invoHandlers = <span style="color: #0000ff;">new</span> HashMap&lt;Class&lt;?&gt;, LogInvoHandler&gt;<span style="color: #000000;">();<br></span><span style="color: #008080;">23</span><br><span style="color: #008080;">24</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> LogInvoHandler() {<br></span><span style="color: #008080;">25</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">26</span><br><span style="color: #008080;">27</span>     <span style="color: #008000;">/</span><br><span style="color: #008080;">28</span> <span style="color: #008000;">     <em> 通过Class来生成动态代理对象Proxy<br></em></span><span style="color: #008080;">29</span> <span style="color: #008000;">      </span><span style="color: #808080;">@param</span><span style="color: #008000;"> clazz<br></span><span style="color: #008080;">30</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@return</span><br><span style="color: #008080;">31</span>      <span style="color: #008000;">/</span><br><span style="color: #008080;">32</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">synchronized</span> <span style="color: #0000ff;">static</span>&lt;T&gt; T getProxyInstance(Class&lt;T&gt;<span style="color: #000000;"> clazz){<br></span><span style="color: #008080;">33</span>         LogInvoHandler invoHandler =<span style="color: #000000;"> invoHandlers.get(clazz);<br></span><span style="color: #008080;">34</span><br><span style="color: #008080;">35</span>         <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> invoHandler){<br></span><span style="color: #008080;">36</span>             invoHandler = <span style="color: #0000ff;">new</span><span style="color: #000000;"> LogInvoHandler();<br></span><span style="color: #008080;">37</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {<br></span><span style="color: #008080;">38</span>                 T tar =<span style="color: #000000;"> clazz.newInstance();<br></span><span style="color: #008080;">39</span> <span style="color: #000000;">                invoHandler.setTarget(tar);<br></span><span style="color: #008080;">40</span> <span style="color: #000000;">                invoHandler.setProxy(Proxy.newProxyInstance(tar.getClass().getClassLoader(),<br></span><span style="color: #008080;">41</span> <span style="color: #000000;">                        tar.getClass().getInterfaces(), invoHandler));<br></span><span style="color: #008080;">42</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {<br></span><span style="color: #008080;">43</span> <span style="color: #000000;">                e.printStackTrace();<br></span><span style="color: #008080;">44</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">45</span> <span style="color: #000000;">            invoHandlers.put(clazz, invoHandler);<br></span><span style="color: #008080;">46</span><br><span style="color: #008080;">47</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">48</span><br><span style="color: #008080;">49</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> (T)invoHandler.getProxy();<br></span><span style="color: #008080;">50</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">51</span><br><span style="color: #008080;">52</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">53</span>     <span style="color: #0000ff;">public</span> Object invoke(Object proxy, Method method, Object[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Throwable {<br></span><span style="color: #008080;">54</span><br><span style="color: #008080;">55</span>         Object result = method.invoke(target, args); <span style="color: #008000;">//</span><span style="color: #008000;"> 执行业务处理<br></span><span style="color: #008080;">56</span><br><span style="color: #008080;">57</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 打印日志</span><br><span style="color: #008080;">58</span>         logger.info(“____invoke method: “ +<span style="color: #000000;"> method.getName()<br></span><span style="color: #008080;">59</span>                     + “; args: “ + (<span style="color: #0000ff;">null</span> == args ? “null”<span style="color: #000000;"> : Arrays.asList(args).toString())<br></span><span style="color: #008080;">60</span>                     + “; return: “ +<span style="color: #000000;"> result);<br></span><span style="color: #008080;">61</span><br><span style="color: #008080;">62</span><br><span style="color: #008080;">63</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> result;<br></span><span style="color: #008080;">64</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">65</span><br><span style="color: #008080;">66</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Object getTarget() {<br></span><span style="color: #008080;">67</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> target;<br></span><span style="color: #008080;">68</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">69</span><br><span style="color: #008080;">70</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setTarget(Object target) {<br></span><span style="color: #008080;">71</span>         <span style="color: #0000ff;">this</span>.target =<span style="color: #000000;"> target;<br></span><span style="color: #008080;">72</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">73</span><br><span style="color: #008080;">74</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Object getProxy() {<br></span><span style="color: #008080;">75</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> proxy;<br></span><span style="color: #008080;">76</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">77</span><br><span style="color: #008080;">78</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setProxy(Object proxy) {<br></span><span style="color: #008080;">79</span>         <span style="color: #0000ff;">this</span>.proxy =<span style="color: #000000;"> proxy;<br></span><span style="color: #008080;">80</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">81</span> }</pre><br></div>

<p>&nbsp;</p>
<p>然后编写一个Test类测试：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 2</span> <span style="color: #008000;">  Created with IntelliJ IDEA.<br></span><span style="color: #008080;"> 3</span> <span style="color: #008000;"> <em> Author: wangjie  email:tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 4</span> <span style="color: #008000;">  Date: 13-9-24<br></span><span style="color: #008080;"> 5</span> <span style="color: #008000;"> <em> Time: 上午9:54<br></em></span><span style="color: #008080;"> 6</span>  <span style="color: #008000;">/</span><br><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Test {<br></span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> Logger logger = Logger.getLogger(Test.<span style="color: #0000ff;">class</span><span style="color: #000000;">.getSimpleName());<br></span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {<br></span><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span>         BussinessService bs = LogInvoHandler.getProxyInstance(BussinessServiceImpl.<span style="color: #0000ff;">class</span><span style="color: #000000;">);<br></span><span style="color: #008080;">12</span>         bs.login(“zhangsan”, “123456”<span style="color: #000000;">);<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">        bs.find();<br></span><span style="color: #008080;">14</span><br><span style="color: #008080;">15</span>         logger.info(“————————————–”<span style="color: #000000;">);<br></span><span style="color: #008080;">16</span><br><span style="color: #008080;">17</span>         WorkService ws = LogInvoHandler.getProxyInstance(WorkServiceImpl.<span style="color: #0000ff;">class</span><span style="color: #000000;">);<br></span><span style="color: #008080;">18</span> <span style="color: #000000;">        ws.work();<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">        ws.sleep();<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span>         logger.info(“————————————–”<span style="color: #000000;">);<br></span><span style="color: #008080;">22</span><br><span style="color: #008080;">23</span>         BussinessService bss = LogInvoHandler.getProxyInstance(BussinessServiceImpl.<span style="color: #0000ff;">class</span><span style="color: #000000;">);<br></span><span style="color: #008080;">24</span>         bss.login(“lisi”, “654321”<span style="color: #000000;">);<br></span><span style="color: #008080;">25</span> <span style="color: #000000;">        bss.find();<br></span><span style="color: #008080;">26</span><br><span style="color: #008080;">27</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">28</span> }</pre><br></div>

<p>以后需要添加新的业务逻辑XXXService，只需要调用</p>
<p>XXXService xs = LogInvoHandler.getProxyInstance(XXXServiceImpl.class);</p>
<p>即可。</p>
<p>也可以模仿Spring等框架的配置，把bean的类名配置在xml文件中，如：</p>
<p>&lt;bean id=”bussinessService” class=”com.wangjie.aoptest2.service.impl.BussinessServiceImpl”&gt;</p>
<p>然后在java代码中解析xml，通过Class.forName(“com.wangjie.aoptest2.service.impl.BussinessServiceImpl”);获得Class对象</p>
<p>然后通过LogInvoHandler.getProxyInstance(Class.forName(“com.wangjie.aoptest2.service.impl.BussinessServiceImpl”));获得代理对象Proxy</p>
<p>再使用反射去调用代理对象的方法。</p>
<p>&nbsp;</p>
<p>运行结果如下：</p>
<p>九月 24, 2013 11:08:03 上午 com.wangjie.aoptest2.invohandler.LogInvoHandler invoke<br>INFO: <strong><strong>invoke method: login; args: [zhangsan, 123456]; return: login success<br>九月 24, 2013 11:08:03 上午 com.wangjie.aoptest2.invohandler.LogInvoHandler invoke<br>INFO: </strong></strong>invoke method: find; args: null; return: find success<br>九月 24, 2013 11:08:03 上午 com.wangjie.aoptest2.Test main<br>INFO: ————————————–<br>九月 24, 2013 11:08:03 上午 com.wangjie.aoptest2.invohandler.LogInvoHandler invoke<br>INFO: <strong><strong>invoke method: work; args: null; return: work success<br>九月 24, 2013 11:08:03 上午 com.wangjie.aoptest2.invohandler.LogInvoHandler invoke<br>INFO: </strong></strong>invoke method: sleep; args: null; return: sleep success<br>九月 24, 2013 11:08:03 上午 com.wangjie.aoptest2.Test main<br>INFO: ————————————–<br>九月 24, 2013 11:08:03 上午 com.wangjie.aoptest2.invohandler.LogInvoHandler invoke<br>INFO: <strong><strong>invoke method: login; args: [lisi, 654321]; return: login success<br>九月 24, 2013 11:08:03 上午 com.wangjie.aoptest2.invohandler.LogInvoHandler invoke<br>INFO: </strong></strong>invoke method: find; args: null; return: find success</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2013/09/10/Android自定义ScrollView分段加载大文本数据到TextView/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/09/10/Android自定义ScrollView分段加载大文本数据到TextView/" itemprop="url">Android自定义ScrollView分段加载大文本数据到TextView</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-09-10T10:19:00+08:00">
                2013-09-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/09/10/Android自定义ScrollView分段加载大文本数据到TextView/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/09/10/Android自定义ScrollView分段加载大文本数据到TextView/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #ff0000;">以下内容为原创，转载时请注明链接地址：<a href="http://www.cnblogs.com/tiantianbyconan/p/3311658.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiantianbyconan/p/3311658.html</a></span></p>
<p>这是我现在碰到的一个问题，如果需要在TextView中加载大文本的时候，比如几M的txt文件时，TextView载入的时候会出现卡死的现象，甚至会出现异常等待退出出现。</p>
<p>解决办法之一就是通过&ldquo;分段&rdquo;或&ldquo;分页&rdquo;来显示数据，在TextView（嵌入在ScrollView之中实现了TextView的滚动）中滚动到底部的时候，再去加载下一部分的数据，依次类推，这样每次加载的数据相对来说都比较小，不会出现卡顿的现象。</p>
<p>遇到的问题是，如何监听ScrollView滚动的位置（滚动到顶部还是底部？）。</p>
<p>&nbsp;</p>
<p>如下，通过自定义ScrollView类(BorderScrollView)：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.bigtextloadtest;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.content.Context;<br></span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.graphics.Rect;<br></span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.util.AttributeSet;<br></span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.ScrollView;<br></span><span style="color: #008080;"> 7</span><br><span style="color: #008080;"> 8</span> <span style="color: #008000;">/<strong></strong></span><br><span style="color: #008080;"> 9</span> <span style="color: #008000;"> <em> Created with IntelliJ IDEA.<br></em></span><span style="color: #008080;">10</span> <span style="color: #008000;">  Author: wangjie  email:tiantian.china.2@gmail.com<br></span><span style="color: #008080;">11</span> <span style="color: #008000;"> <em> Date: 13-9-6<br></em></span><span style="color: #008080;">12</span> <span style="color: #008000;">  Time: 下午2:06<br></span><span style="color: #008080;">13</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;">14</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> BorderScrollView <span style="color: #0000ff;">extends</span><span style="color: #000000;"> ScrollView{<br></span><span style="color: #008080;">15</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">long</span><span style="color: #000000;"> millis;<br></span><span style="color: #008080;">16</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 滚动监听者</span><br><span style="color: #008080;">17</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> OnScrollChangedListener onScrollChangedListener;<br></span><span style="color: #008080;">18</span><br><span style="color: #008080;">19</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> BorderScrollView(Context context) {<br></span><span style="color: #008080;">20</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">(context);<br></span><span style="color: #008080;">21</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">22</span><br><span style="color: #008080;">23</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> BorderScrollView(Context context, AttributeSet attrs) {<br></span><span style="color: #008080;">24</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">(context, attrs);<br></span><span style="color: #008080;">25</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">26</span><br><span style="color: #008080;">27</span>     <span style="color: #0000ff;">public</span> BorderScrollView(Context context, AttributeSet attrs, <span style="color: #0000ff;">int</span><span style="color: #000000;"> defStyle) {<br></span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">(context, attrs, defStyle);<br></span><span style="color: #008080;">29</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">30</span><br><span style="color: #008080;">31</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">32</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span> onScrollChanged(<span style="color: #0000ff;">int</span> l, <span style="color: #0000ff;">int</span> t, <span style="color: #0000ff;">int</span> oldl, <span style="color: #0000ff;">int</span><span style="color: #000000;"> oldt) {<br></span><span style="color: #008080;">33</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">.onScrollChanged(l, t, oldl, oldt);<br></span><span style="color: #008080;">34</span><br><span style="color: #008080;">35</span>         <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span> ==<span style="color: #000000;"> onScrollChangedListener){<br></span><span style="color: #008080;">36</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;<br></span><span style="color: #008080;">37</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">38</span><br><span style="color: #008080;">39</span>         <span style="color: #0000ff;">long</span> now =<span style="color: #000000;"> System.currentTimeMillis();<br></span><span style="color: #008080;">40</span><br><span style="color: #008080;">41</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 通知监听者当前滚动的具体信息</span><br><span style="color: #008080;">42</span> <span style="color: #000000;">        onScrollChangedListener.onScrollChanged(l, t, oldl, oldt);<br></span><span style="color: #008080;">43</span><br><span style="color: #008080;">44</span>         <span style="color: #0000ff;">if</span>(now - millis &gt; 1000l<span style="color: #000000;">){<br></span><span style="color: #008080;">45</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 滚动到底部（前提：从不是底部滚动到底部）</span><br><span style="color: #008080;">46</span>             <span style="color: #0000ff;">if</span>((<span style="color: #0000ff;">this</span>.getHeight() + oldt) != <span style="color: #0000ff;">this</span><span style="color: #000000;">.getTotalVerticalScrollRange()<br></span><span style="color: #008080;">47</span>                     &amp;&amp; (<span style="color: #0000ff;">this</span>.getHeight() + t) == <span style="color: #0000ff;">this</span><span style="color: #000000;">.getTotalVerticalScrollRange()){<br></span><span style="color: #008080;">48</span><br><span style="color: #008080;">49</span>                 onScrollChangedListener.onScrollBottom(); <span style="color: #008000;">//</span><span style="color: #008000;"> 通知监听者滚动到底部</span><br><span style="color: #008080;">50</span><br><span style="color: #008080;">51</span>                 millis =<span style="color: #000000;"> now;<br></span><span style="color: #008080;">52</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">53</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">54</span><br><span style="color: #008080;">55</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 滚动到顶部（前提：从不是顶部滚动到顶部）</span><br><span style="color: #008080;">56</span>         <span style="color: #0000ff;">if</span>(oldt != 0 &amp;&amp; t == 0<span style="color: #000000;">){<br></span><span style="color: #008080;">57</span>             onScrollChangedListener.onScrollTop(); <span style="color: #008000;">//</span><span style="color: #008000;"> 通知监听者滚动到顶部</span><br><span style="color: #008080;">58</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">59</span><br><span style="color: #008080;">60</span><br><span style="color: #008080;">61</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">62</span><br><span style="color: #008080;">63</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> OnScrollChangedListener getOnScrollChangedListener() {<br></span><span style="color: #008080;">64</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> onScrollChangedListener;<br></span><span style="color: #008080;">65</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">66</span><br><span style="color: #008080;">67</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setOnScrollChangedListener(OnScrollChangedListener onScrollChangedListener) {<br></span><span style="color: #008080;">68</span>         <span style="color: #0000ff;">this</span>.onScrollChangedListener =<span style="color: #000000;"> onScrollChangedListener;<br></span><span style="color: #008080;">69</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">70</span><br><span style="color: #008080;">71</span>     <span style="color: #008000;">/</span><br><span style="color: #008080;">72</span> <span style="color: #008000;">     <em> 获得滚动总长度<br></em></span><span style="color: #008080;">73</span> <span style="color: #008000;">      </span><span style="color: #808080;">@return</span><br><span style="color: #008080;">74</span>      <span style="color: #008000;">*/</span><br><span style="color: #008080;">75</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> getTotalVerticalScrollRange() {<br></span><span style="color: #008080;">76</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.computeVerticalScrollRange();<br></span><span style="color: #008080;">77</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">78</span><br><span style="color: #008080;">79</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">80</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> computeScrollDeltaToGetChildRectOnScreen(Rect rect) {<br></span><span style="color: #008080;">81</span>         <span style="color: #0000ff;">return</span> 0; <span style="color: #008000;">//</span><span style="color: #008000;"> 禁止ScrollView在子控件的布局改变时自动滚动</span><br><span style="color: #008080;">82</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">83</span><br><span style="color: #008080;">84</span> }</pre><br></div>

<p>&nbsp;</p>
<p>滚动监听器接口OnScrollChangedListener：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.bigtextloadtest;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #008000;">/<strong></strong></span><br><span style="color: #008080;"> 4</span> <span style="color: #008000;"> <em> Created with IntelliJ IDEA.<br></em></span><span style="color: #008080;"> 5</span> <span style="color: #008000;">  Author: wangjie  email:tiantian.china.2@gmail.com<br></span><span style="color: #008080;"> 6</span> <span style="color: #008000;"> <em> Date: 13-9-6<br></em></span><span style="color: #008080;"> 7</span> <span style="color: #008000;">  Time: 下午2:53<br></span><span style="color: #008080;"> 8</span>  <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> OnScrollChangedListener {<br></span><span style="color: #008080;">10</span>     <span style="color: #008000;">/</span><br><span style="color: #008080;">11</span> <span style="color: #008000;">     <em> 监听滚动变化<br></em></span><span style="color: #008080;">12</span> <span style="color: #008000;">      </span><span style="color: #808080;">@param</span><span style="color: #008000;"> l<br></span><span style="color: #008080;">13</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@param</span><span style="color: #008000;"> t<br></span><span style="color: #008080;">14</span> <span style="color: #008000;">      </span><span style="color: #808080;">@param</span><span style="color: #008000;"> oldl<br></span><span style="color: #008080;">15</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@param</span><span style="color: #008000;"> oldt<br></span><span style="color: #008080;">16</span>      <span style="color: #008000;">/</span><br><span style="color: #008080;">17</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onScrollChanged(<span style="color: #0000ff;">int</span> l, <span style="color: #0000ff;">int</span> t, <span style="color: #0000ff;">int</span> oldl, <span style="color: #0000ff;">int</span><span style="color: #000000;"> oldt);<br></span><span style="color: #008080;">18</span><br><span style="color: #008080;">19</span>     <span style="color: #008000;">/<strong></strong></span><br><span style="color: #008080;">20</span> <span style="color: #008000;">     <em> 监听滚动到顶部<br></em></span><span style="color: #008080;">21</span>      <span style="color: #008000;">/</span><br><span style="color: #008080;">22</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onScrollTop();<br></span><span style="color: #008080;">23</span><br><span style="color: #008080;">24</span>     <span style="color: #008000;">/</span><br><span style="color: #008080;">25</span> <span style="color: #008000;">     <em> 监听滚动到底部<br></em></span><span style="color: #008080;">26</span>      <span style="color: #008000;">/</span><br><span style="color: #008080;">27</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onScrollBottom();<br></span><span style="color: #008080;">28</span><br><span style="color: #008080;">29</span> }</pre><br></div>

<p>&nbsp;</p>
<p>滚动监听器的空实现OnScrollChangedListenerSimple（简洁真正用时候的代码）：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.bigtextloadtest;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 4</span> <span style="color: #008000;">  Created with IntelliJ IDEA.<br></span><span style="color: #008080;"> 5</span> <span style="color: #008000;"> <em> Author: wangjie  email:tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;"> 6</span> <span style="color: #008000;">  Date: 13-9-9<br></span><span style="color: #008080;"> 7</span> <span style="color: #008000;"> <em> Time: 下午2:39<br></em></span><span style="color: #008080;"> 8</span>  <span style="color: #008000;">/</span><br><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> OnScrollChangedListenerSimple <span style="color: #0000ff;">implements</span><span style="color: #000000;"> OnScrollChangedListener{<br></span><span style="color: #008080;">10</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> onScrollChanged(<span style="color: #0000ff;">int</span> l, <span style="color: #0000ff;">int</span> t, <span style="color: #0000ff;">int</span> oldl, <span style="color: #0000ff;">int</span><span style="color: #000000;"> oldt) {}<br></span><span style="color: #008080;">12</span><br><span style="color: #008080;">13</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onScrollTop() {}<br></span><span style="color: #008080;">15</span><br><span style="color: #008080;">16</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">17</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onScrollBottom() {}<br></span><span style="color: #008080;">18</span> }</pre><br></div>

<p>&nbsp;</p>
<p>异步加载分段文本（这里每次加载50行）：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.bigtextloadtest;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.content.Context;<br></span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.os.AsyncTask;<br></span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.os.Handler;<br></span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.view.View;<br></span><span style="color: #008080;"> 7</span><br><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span> java.io.<em><span style="color: #000000;">;<br></span><span style="color: #008080;"> 9</span><br><span style="color: #008080;">10</span> <span style="color: #008000;">/**</span><br><span style="color: #008080;">11</span> <span style="color: #008000;"> </span></em> Created with IntelliJ IDEA.<br><span style="color: #008080;">12</span> <span style="color: #008000;"> <em> Author: wangjie  email:tiantian.china.2@gmail.com<br></em></span><span style="color: #008080;">13</span> <span style="color: #008000;">  Date: 13-9-6<br></span><span style="color: #008080;">14</span> <span style="color: #008000;"> <em> Time: 上午11:34<br></em></span><span style="color: #008080;">15</span>  <span style="color: #008000;">/</span><br><span style="color: #008080;">16</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> AsyncTextLoadTask <span style="color: #0000ff;">extends</span> AsyncTask&lt;Object, String, String&gt;<span style="color: #000000;"> {<br></span><span style="color: #008080;">17</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Context context;<br></span><span style="color: #008080;">18</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> MainActivity activity;<br></span><span style="color: #008080;">19</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> BufferedReader br;<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> AsyncTextLoadTask(Context context, BufferedReader br) {<br></span><span style="color: #008080;">22</span>         <span style="color: #0000ff;">this</span>.context =<span style="color: #000000;"> context;<br></span><span style="color: #008080;">23</span>         <span style="color: #0000ff;">this</span>.br =<span style="color: #000000;"> br;<br></span><span style="color: #008080;">24</span>         activity =<span style="color: #000000;"> (MainActivity)context;<br></span><span style="color: #008080;">25</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">26</span><br><span style="color: #008080;">27</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">28</span>     <span style="color: #0000ff;">protected</span><span style="color: #000000;"> String doInBackground(Object… params) {<br></span><span style="color: #008080;">29</span>         StringBuilder paragraph = <span style="color: #0000ff;">new</span><span style="color: #000000;"> StringBuilder();<br></span><span style="color: #008080;">30</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {<br></span><span style="color: #008080;">31</span><br><span style="color: #008080;">32</span>             String line = “”<span style="color: #000000;">;<br></span><span style="color: #008080;">33</span><br><span style="color: #008080;">34</span>             <span style="color: #0000ff;">int</span> index = 0<span style="color: #000000;">;<br></span><span style="color: #008080;">35</span>             <span style="color: #0000ff;">while</span>(index &lt; 50 &amp;&amp; (line = br.readLine()) != <span style="color: #0000ff;">null</span><span style="color: #000000;">){<br></span><span style="color: #008080;">36</span>                 paragraph.append(line + “\n”<span style="color: #000000;">);<br></span><span style="color: #008080;">37</span>                 index++<span style="color: #000000;">;<br></span><span style="color: #008080;">38</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">39</span><br><span style="color: #008080;">40</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {<br></span><span style="color: #008080;">41</span> <span style="color: #000000;">            e.printStackTrace();<br></span><span style="color: #008080;">42</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">43</span><br><span style="color: #008080;">44</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> paragraph.toString();<br></span><span style="color: #008080;">45</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">46</span><br><span style="color: #008080;">47</span><br><span style="color: #008080;">48</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">49</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onPreExecute() {<br></span><span style="color: #008080;">50</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">.onPreExecute();<br></span><span style="color: #008080;">51</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">52</span><br><span style="color: #008080;">53</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">54</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onPostExecute(String result) {<br></span><span style="color: #008080;">55</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">.onPostExecute(result);<br></span><span style="color: #008080;">56</span> <span style="color: #000000;">        activity.contentTv.setText(result);<br></span><span style="color: #008080;">57</span>         <span style="color: #0000ff;">new</span> Handler().postDelayed(<span style="color: #0000ff;">new</span><span style="color: #000000;"> Runnable() {<br></span><span style="color: #008080;">58</span><br><span style="color: #008080;">59</span> <span style="color: #000000;">            @Override<br></span><span style="color: #008080;">60</span>             <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> run() {<br></span><span style="color: #008080;">61</span>                 activity.contentScroll.scrollTo(0, 0); <span style="color: #008000;">//</span><span style="color: #008000;"> 记载完新数据后滚动到顶部</span><br><span style="color: #008080;">62</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">63</span>         }, 100<span style="color: #000000;">);<br></span><span style="color: #008080;">64</span>         activity.isLoading = <span style="color: #0000ff;">false</span><span style="color: #000000;">;<br></span><span style="color: #008080;">65</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">66</span><br><span style="color: #008080;">67</span> }</pre><br></div>

<p>&nbsp;</p>
<p>真正使用分段加载数据Activity（这里加载一本小说《百年孤独》）：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.wangjie.bigtextloadtest;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.app.Activity;<br></span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.content.Context;<br></span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.os.Bundle;<br></span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> android.widget.TextView;<br></span><span style="color: #008080;"> 7</span><br><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.BufferedReader;<br></span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;<br></span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStream;<br></span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStreamReader;<br></span><span style="color: #008080;">12</span><br><span style="color: #008080;">13</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MainActivity <span style="color: #0000ff;">extends</span><span style="color: #000000;"> Activity {<br></span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> BorderScrollView contentScroll;<br></span><span style="color: #008080;">15</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> TextView contentTv;<br></span><span style="color: #008080;">16</span><br><span style="color: #008080;">17</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> BufferedReader br;<br></span><span style="color: #008080;">18</span><br><span style="color: #008080;">19</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Context context;<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> isLoading;<br></span><span style="color: #008080;">22</span><br><span style="color: #008080;">23</span><br><span style="color: #008080;">24</span>     <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;">25</span> <span style="color: #008000;">      Called when the activity is first created.<br></span><span style="color: #008080;">26</span>      <span style="color: #008000;">*/</span><br><span style="color: #008080;">27</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">28</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onCreate(Bundle savedInstanceState) {<br></span><span style="color: #008080;">29</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">.onCreate(savedInstanceState);<br></span><span style="color: #008080;">30</span> <span style="color: #000000;">        setContentView(R.layout.main);<br></span><span style="color: #008080;">31</span>         context = <span style="color: #0000ff;">this</span><span style="color: #000000;">;<br></span><span style="color: #008080;">32</span><br><span style="color: #008080;">33</span>         contentTv =<span style="color: #000000;"> (TextView) findViewById(R.id.content);<br></span><span style="color: #008080;">34</span>         contentScroll =<span style="color: #000000;"> (BorderScrollView) findViewById(R.id.contentScroll);<br></span><span style="color: #008080;">35</span><br><span style="color: #008080;">36</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 注册刚写的滚动监听器</span><br><span style="color: #008080;">37</span>         contentScroll.setOnScrollChangedListener(<span style="color: #0000ff;">new</span><span style="color: #000000;"> OnScrollChangedListenerSimple(){<br></span><span style="color: #008080;">38</span> <span style="color: #000000;">            @Override<br></span><span style="color: #008080;">39</span>             <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onScrollBottom() {<br></span><span style="color: #008080;">40</span>                 <span style="color: #0000ff;">synchronized</span> (MainActivity.<span style="color: #0000ff;">class</span><span style="color: #000000;">){<br></span><span style="color: #008080;">41</span>                     <span style="color: #0000ff;">if</span>(!<span style="color: #000000;">isLoading){<br></span><span style="color: #008080;">42</span>                         isLoading = <span style="color: #0000ff;">true</span><span style="color: #000000;">;<br></span><span style="color: #008080;">43</span>                         <span style="color: #0000ff;">new</span><span style="color: #000000;"> AsyncTextLoadTask(context, br).execute();<br></span><span style="color: #008080;">44</span> <span style="color: #000000;">                    }<br></span><span style="color: #008080;">45</span> <span style="color: #000000;">                }<br></span><span style="color: #008080;">46</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">47</span> <span style="color: #000000;">        });<br></span><span style="color: #008080;">48</span><br><span style="color: #008080;">49</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;">{<br></span><span style="color: #008080;">50</span>             InputStream is = context.getAssets().open(“bngd.txt”<span style="color: #000000;">);<br></span><span style="color: #008080;">51</span>             br = <span style="color: #0000ff;">new</span> BufferedReader(<span style="color: #0000ff;">new</span><span style="color: #000000;"> InputStreamReader(is));<br></span><span style="color: #008080;">52</span><br><span style="color: #008080;">53</span>             <span style="color: #0000ff;">new</span><span style="color: #000000;"> AsyncTextLoadTask(context, br).execute();<br></span><span style="color: #008080;">54</span><br><span style="color: #008080;">55</span>         }<span style="color: #0000ff;">catch</span><span style="color: #000000;">(Exception ex){<br></span><span style="color: #008080;">56</span> <span style="color: #000000;">            ex.printStackTrace();<br></span><span style="color: #008080;">57</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">58</span><br><span style="color: #008080;">59</span><br><span style="color: #008080;">60</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">61</span><br><span style="color: #008080;">62</span><br><span style="color: #008080;">63</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">64</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onDestroy() {<br></span><span style="color: #008080;">65</span>         <span style="color: #0000ff;">super</span><span style="color: #000000;">.onDestroy();<br></span><span style="color: #008080;">66</span>         <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span> !=<span style="color: #000000;"> br){<br></span><span style="color: #008080;">67</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {<br></span><span style="color: #008080;">68</span> <span style="color: #000000;">                br.close();<br></span><span style="color: #008080;">69</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {<br></span><span style="color: #008080;">70</span> <span style="color: #000000;">                e.printStackTrace();<br></span><span style="color: #008080;">71</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">72</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">73</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">74</span><br><span style="color: #008080;">75</span> }</pre><br></div>

<p>&nbsp;</p>
<p>贴上布局：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version=”1.0” encoding=”utf-8”</span><span style="color: #0000ff;">?&gt;</span><br><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">LinearLayout </span><span style="color: #ff0000;">xmlns:android</span><span style="color: #0000ff;">=”<a href="http://schemas.android.com/apk/res/android" target="_blank" rel="noopener">http://schemas.android.com/apk/res/android</a>“</span><br><span style="color: #008080;"> 3</span> <span style="color: #ff0000;">              android:orientation</span><span style="color: #0000ff;">=”vertical”</span><br><span style="color: #008080;"> 4</span> <span style="color: #ff0000;">              android:layout_width</span><span style="color: #0000ff;">=”fill_parent”</span><br><span style="color: #008080;"> 5</span> <span style="color: #ff0000;">              android:layout_height</span><span style="color: #0000ff;">=”fill_parent”</span><br><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">com.wangjie.bigtextloadtest.BorderScrollView<br></span><span style="color: #008080;"> 8</span>             <span style="color: #ff0000;">android:id</span><span style="color: #0000ff;">=”@+id/contentScroll”</span><br><span style="color: #008080;"> 9</span> <span style="color: #ff0000;">            android:layout_width</span><span style="color: #0000ff;">=”fill_parent”</span><br><span style="color: #008080;">10</span> <span style="color: #ff0000;">            android:layout_height</span><span style="color: #0000ff;">=”fill_parent”</span><br><span style="color: #008080;">11</span>             <span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">12</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">LinearLayout<br></span><span style="color: #008080;">13</span>                 <span style="color: #ff0000;">android:orientation</span><span style="color: #0000ff;">=”vertical”</span><br><span style="color: #008080;">14</span> <span style="color: #ff0000;">                android:layout_width</span><span style="color: #0000ff;">=”fill_parent”</span><br><span style="color: #008080;">15</span> <span style="color: #ff0000;">                android:layout_height</span><span style="color: #0000ff;">=”fill_parent”</span><br><span style="color: #008080;">16</span>                 <span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">17</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">TextView<br></span><span style="color: #008080;">18</span>                     <span style="color: #ff0000;">android:layout_width</span><span style="color: #0000ff;">=”fill_parent”</span><br><span style="color: #008080;">19</span> <span style="color: #ff0000;">                    android:layout_height</span><span style="color: #0000ff;">=”wrap_content”</span><br><span style="color: #008080;">20</span> <span style="color: #ff0000;">                    android:text</span><span style="color: #0000ff;">=”asdfasdf”</span><br><span style="color: #008080;">21</span>                     <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">22</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">TextView<br></span><span style="color: #008080;">23</span>                     <span style="color: #ff0000;">android:id</span><span style="color: #0000ff;">=”@+id/content”</span><br><span style="color: #008080;">24</span> <span style="color: #ff0000;">                    android:layout_width</span><span style="color: #0000ff;">=”fill_parent”</span><br><span style="color: #008080;">25</span> <span style="color: #ff0000;">                    android:layout_height</span><span style="color: #0000ff;">=”wrap_content”</span><br><span style="color: #008080;">26</span> <span style="color: #ff0000;">                    android:text</span><span style="color: #0000ff;">=”Hello World, MainActivity”</span><br><span style="color: #008080;">27</span>                     <span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">28</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">LinearLayout</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">29</span><br><span style="color: #008080;">30</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">com.wangjie.bigtextloadtest.BorderScrollView</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">31</span><br><span style="color: #008080;">32</span><br><span style="color: #008080;">33</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">LinearLayout</span><span style="color: #0000ff;">&gt;</span></pre><br></div>

<p>&nbsp;</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2013/06/06/IOS推送功能的实现（javapns）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/06/06/IOS推送功能的实现（javapns）/" itemprop="url">IOS推送功能的实现（javapns）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-06-06T18:01:00+08:00">
                2013-06-06
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/06/06/IOS推送功能的实现（javapns）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/06/06/IOS推送功能的实现（javapns）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="IOS的推送实现由这样几步来完成"><a href="#IOS的推送实现由这样几步来完成" class="headerlink" title="IOS的推送实现由这样几步来完成:"></a>IOS的推送实现由这样几步来完成:</h2><ol>
<li>创建Push SSL Certification</li>
<li>IOS客户端注册Push功能并获得DeviceToken</li>
<li>使用Provider向APNS发送Push消息</li>
<li>IOS客户端接收处理由APNS发来的消息</li>
</ol>
<h2 id="创建Push-SSL-Certification"><a href="#创建Push-SSL-Certification" class="headerlink" title="创建Push SSL Certification"></a><a name="t1"></a>创建Push SSL Certification</h2><p>&nbsp;&nbsp;&nbsp; 登录developer.apple.com，创建新的App ID，要求此ID的Bundle Identifier不包含通配符，否则不能启用Push以及IAP功能。例如 com.soso.sosoimage。</p>
<p>&nbsp;&nbsp;&nbsp; 在App IDs列表页面，点击刚创建的app id右面的Configure链接，进入Configure App ID界面，选中”Enable for App Push Notification service”。点击Development Push SSL Certificate一行的Configure按钮，弹出”Apple Push Notification service SSL Certificate Assistant”对话框，依对话框操作，类似于创建开发或发布用的Certificate。</p>
<p>&nbsp;&nbsp;&nbsp; 最终将Development Push SSL Certificate下载并安装到本地Keychain Access。导出成p12文件，备用。导出时需要设置密码，不得为空。</p>
<p>&nbsp;&nbsp;&nbsp; 在developer.apple.com，创建一个新的Provisioning Profile，使用我们刚刚创建的支持Push功能的App ID。下载并安装到本地。</p>
<p>&nbsp;</p>
<h2 id="IOS客户端注册Push功能并获得DeviceToken"><a href="#IOS客户端注册Push功能并获得DeviceToken" class="headerlink" title="IOS客户端注册Push功能并获得DeviceToken"></a><a name="t2"></a>IOS客户端注册Push功能并获得DeviceToken</h2><p><span>&nbsp;&nbsp;&nbsp; 创建本地工程，info.plist中设置Bundle identifier为刚刚创建的Bundle Id。Com.soso.sosoimage。设定Code Signing Identity为刚刚创建的Provisioning Profile。</span></p>
<p>&nbsp;&nbsp;&nbsp; 程序第一次执行的时候，调用如下代码.</p>
<div class="cnblogs_code"><br><pre>[[UIApplication sharedApplication] registerForRemoteNotificationTypes:(UIRemoteNotificationTypeAlert | UIRemoteNotificationTypeBadge | UIRemoteNotificationTypeSound)];</pre><br></div>

<p>三个参数分别代表消息（横幅或提醒，由用户Setting决定，程序不可更改）、数字标记、声音。</p>
<p><span>在AppDelegate.m中添加两个方法.</span></p>
<div class="cnblogs_code"><br><pre><span style="color: #008000;">//</span><span style="color: #008000;">iPhone 从APNs服务器获取deviceToken后回调此方法</span><br>- (<span style="color: #0000ff;">void</span>)application:(UIApplication <em>)app didRegisterForRemoteNotificationsWithDeviceToken:(NSData </em><span style="color: #000000;">)deviceToken<br>{<br>    NSString</span><em> dt = [[deviceToken description] stringByTrimmingCharactersInSet:[NSCharacterSet characterSetWithCharactersInString:<span style="color: #800000;">@”</span><span style="color: #800000;">&lt;&gt;</span><span style="color: #800000;">“</span><span style="color: #000000;">]];<br>    NSLog(</span><span style="color: #800000;">@”</span><span style="color: #800000;">deviceToken:%@</span><span style="color: #800000;">“</span><span style="color: #000000;">, dt);<br>}<br><br></span><span style="color: #008000;">//</span><span style="color: #008000;">注册push功能失败 后 返回错误信息，执行相应的处理</span><br>- (<span style="color: #0000ff;">void</span>)application:(UIApplication </em>)app didFailToRegisterForRemoteNotificationsWithError:(NSError *<span style="color: #000000;">)err<br>{<br>    NSLog(</span><span style="color: #800000;">@”</span><span style="color: #800000;">Push Register Error:%@</span><span style="color: #800000;">“</span><span style="color: #000000;">, err.description);<br>}</span></pre><br></div>

<p><span>获取DeviceToken后，将其传给Provider。</span></p>
<h2 id="使用Provider向APNS发送Push消息"><a href="#使用Provider向APNS发送Push消息" class="headerlink" title="使用Provider向APNS发送Push消息"></a><a name="t3"></a>使用Provider向APNS发送Push消息</h2><p> <span>Provider，将推送信息发送给APNS（苹果推送服务器）的程序。有很多开源的实现，我们使用javapns ( <a href="http://code.google.com/p/javapns/" target="_blank" rel="noopener">http://code.google.com/p/javapns/</a> )。</span><br><span>首先，Provider要有目标DeviceToken，这是发送目标，由客户端传给Provider之后存在某处。</span><br><span>安装javapns，需要导入的jar为bcprov-jdk15-146.jar, log4j-1.2.15.jar, JavaPNS_2.3_Alpha_5.jar。</span><br><span>将前面导出的P12文件放在Provider的工程目录下。</span><br><span>Provider向APNS发送消息可以参考javapns中NotificationTest.java。也可以参考如下例子。</span></p>
<h3 id="1-使客户端图标显示数字标记"><a href="#1-使客户端图标显示数字标记" class="headerlink" title="(1)使客户端图标显示数字标记"></a><a name="t4"></a>(1)使客户端图标显示数字标记</h3><div class="cnblogs_code"><br><pre>Push.badge(2, keystore, password, <span style="color: #0000ff;">false</span>, “7bb8d508e32df651c6c239439737dbd40a88d2461ad2ac1e5dbe49ecea5ccc67”);</pre><br></div>

<p><span>其中，2为要显示的数字；</span></p>
<div class="cnblogs_code"><br><pre>String keystore = “PushCertificates.p12”;     <span style="color: #008000;">//</span><span style="color: #008000;">P12文件的路径；</span><br>String password = “sosoimage”;                <span style="color: #008000;">//</span><span style="color: #008000;">P12文件的密码；</span></pre><br></div>

<p><span>false，指的是使用测试环境，使用正式产品环境应传入true.</span><br><span>“7bb8d508e32df651c6c239439737dbd40a88d2461ad2ac1e5dbe49ecea5ccc67”为客户端获得并传给Provider的DeviceToken，此参数还可以传入String[]对象，以同时向多个客户端Push消息。</span></p>
<h3 id="2-使客户端显示横幅或提醒"><a href="#2-使客户端显示横幅或提醒" class="headerlink" title="(2)使客户端显示横幅或提醒"></a><a name="t5"></a>(2)使客户端显示横幅或提醒</h3><p>Provider可以向客户端Push一条Message，但客户端有权限决定这条Message的显示方式（无、横幅、提醒）。</p>
<div class="cnblogs_code"><br><pre>Push.alert(“A Message”, keystore, password, )<span style="color: #0000ff;">false</span>, “7bb8d508e32df651c6c239439737dbd40a88d2461ad2ac1e5dbe49ecea5ccc67”);</pre><br></div>

<h3 id="3-混合方式"><a href="#3-混合方式" class="headerlink" title="(3)混合方式"></a>(3)混合方式</h3><p><span>可以在一个Push消息里附带多种信息，Message, 标记，声音，可以使用如下代码.</span></p>
<div class="cnblogs_code"><br><pre>PushNotificationPayload payload =<span style="color: #000000;"> PushNotificationPayload.complex();<br>payload.addAlert(</span>“A Message”<span style="color: #000000;">);<br>payload.addBadge(</span>2<span style="color: #000000;">);<br>payload.addSound(</span>“test.aiff”<span style="color: #000000;">);<br>Push.payload(payload, , keystore, password, </span><span style="color: #0000ff;">false</span>, “7bb8d508e32df651c6c239439737dbd40a88d2461ad2ac1e5dbe49ecea5ccc67”);</pre><br></div>

<p><span>上面的代码都有可能会有相应的Exception抛出来，需要处理。更多的使用方式可以参考 <a href="http://code.google.com/p/javapns/&amp;nbsp" target="_blank" rel="noopener">http://code.google.com/p/javapns/&amp;nbsp</a>;</span></p>
<h2 id="IOS客户端接收处理由APNS发来的消息"><a href="#IOS客户端接收处理由APNS发来的消息" class="headerlink" title="IOS客户端接收处理由APNS发来的消息"></a><a name="t7"></a>IOS客户端接收处理由APNS发来的消息</h2><p><span>(1)当程序未启动，用户接收到消息。需要在AppDelegate中的didFinishLaunchingWithOptions得到消息内容。代码如下，</span></p>
<div class="cnblogs_code"><br><pre>- (BOOL)application:(UIApplication <em>)application didFinishLaunchingWithOptions:(NSDictionary </em><span style="color: #000000;">)launchOptions<br>{<br>    …<br><br>    NSDictionary</span>* payload =<span style="color: #000000;"> [launchOptions objectForKey:UIApplicationLaunchOptionsRemoteNotificationKey];<br>    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (payload)<br>    {<br>    …<br>    }<br><br>    </span><span style="color: #000000;">…<br>}</span></pre><br></div>

<p><span>(2)当程序在前台运行，接收到消息不会有消息提示（提示框或横幅）。当程序运行在后台，接收到消息会有消息提示，点击消息后进入程序，AppDelegate的didReceiveRemoteNotification函数会被调用（需要自己重写），消息做为此函数的参数传入，代码如下</span></p>
<div class="cnblogs_code"><br><pre>- (<span style="color: #0000ff;">void</span>)application:(UIApplication <em>)application didReceiveRemoteNotification:(NSDictionary </em><span style="color: #000000;">)payload<br>{<br>    …<br>}</span></pre><br></div>

<p><span>(3)无论在哪个函数传入，消息总是一个NSDictionary对象，处理方式可以参考如下代码</span></p>
<div class="cnblogs_code"><br><pre>- (<span style="color: #0000ff;">void</span>)application:(UIApplication <em>)application didReceiveRemoteNotification:(NSDictionary </em><span style="color: #000000;">)payload<br>{<br>    NSLog(</span><span style="color: #800000;">@”</span><span style="color: #800000;">remote notification: %@</span><span style="color: #800000;">“</span><span style="color: #000000;">,[payload description]);<br>    NSString</span><em> alertStr =<span style="color: #000000;"> nil;<br>    NSDictionary </span></em>apsInfo = [payload objectForKey:<span style="color: #800000;">@”</span><span style="color: #800000;">aps</span><span style="color: #800000;">“</span><span style="color: #000000;">];<br>    NSObject </span><em>alert = [apsInfo objectForKey:<span style="color: #800000;">@”</span><span style="color: #800000;">alert</span><span style="color: #800000;">“</span><span style="color: #000000;">];<br>    </span><span style="color: #0000ff;">if</span> ([alert isKindOfClass:[NSString <span style="color: #0000ff;">class</span><span style="color: #000000;">]])<br>    {<br>        alertStr </span>= (NSString</em><span style="color: #000000;">)alert;<br>    }<br>    </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> ([alert isKindOfClass:[NSDictionary <span style="color: #0000ff;">class</span><span style="color: #000000;">]])<br>    {<br>        NSDictionary</span><em> alertDict = (NSDictionary</em><span style="color: #000000;">)alert;<br>        alertStr </span>= [alertDict objectForKey:<span style="color: #800000;">@”</span><span style="color: #800000;">body</span><span style="color: #800000;">“</span><span style="color: #000000;">];<br>    }<br>    application.applicationIconBadgeNumber </span>= [[apsInfo objectForKey:<span style="color: #800000;">@”</span><span style="color: #800000;">badge</span><span style="color: #800000;">“</span><span style="color: #000000;">] integerValue];<br>    </span><span style="color: #0000ff;">if</span> ([application applicationState] == UIApplicationStateActive &amp;&amp; alertStr !=<span style="color: #000000;"> nil)<br>    {<br>        UIAlertView</span>* alertView = [[UIAlertView alloc] initWithTitle:<span style="color: #800000;">@”</span><span style="color: #800000;">Pushed Message</span><span style="color: #800000;">“</span> message:alertStr <span style="color: #0000ff;">delegate</span>:nil cancelButtonTitle:<span style="color: #800000;">@”</span><span style="color: #800000;">OK</span><span style="color: #800000;">“</span><span style="color: #000000;"> otherButtonTitles:nil];<br>        [alertView show];<br>    }<br>}</span></pre><br></div>

<p>&nbsp;</p>
<p>来自：<a href="http://blog.csdn.net/worldmatrix/article/details/7634596" target="_blank" rel="noopener">http://blog.csdn.net/worldmatrix/article/details/7634596</a></p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2013/05/18/IntelliJ-IDEA-12-创建Web项目-教程-超详细版/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/05/18/IntelliJ-IDEA-12-创建Web项目-教程-超详细版/" itemprop="url">IntelliJ IDEA 12 创建Web项目 教程 超详细版</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-05-18T11:00:00+08:00">
                2013-05-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/05/18/IntelliJ-IDEA-12-创建Web项目-教程-超详细版/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/05/18/IntelliJ-IDEA-12-创建Web项目-教程-超详细版/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>IntelliJ IDEA 12&nbsp;新版本发布 第一时间去官网看了下&nbsp;&nbsp;黑色的主题 很给力 大体使用了下&nbsp;&nbsp;对于一开始就是用eclipse的童鞋们</p>
<p>估计很难从eclipse中走出来&nbsp;当然 我也很艰难的走在路上 …</p>
<p><strong><span>首先要说一点，在IntelliJ IDEA里面&ldquo;new Project&rdquo; 就相当于我们eclipse的&ldquo;workspace&rdquo;，而&ldquo;new Module&rdquo;才是创建一个工程。</span></strong></p>
<p><strong><span>这个和Eclipse有很大的区别</span></strong></p>
<p>&nbsp;</p>
<p><strong>1.官网下载下来的默认不是黑色的主题&nbsp;这里需要修改一下&nbsp;工具栏上的扳手图标 或者是用ctrl+alt+s打开设置窗口</strong></p>
<p><strong>在打开窗口的左侧&nbsp; 找到Appearance&gt;Theme 选择Darcula主题 应用&nbsp; 重启就ok了</strong></p>
<p><strong>2.中文乱码问题&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 软件无论是打开项目空间还是其他的&nbsp;&nbsp;&nbsp;&nbsp; 字体显示不全 中文都是口口&nbsp;</strong></p>
<p><strong>解决方法:</strong></p>
<p><strong>Appearance&gt;Override default fonts by(not recommended)&nbsp;前面打勾</strong></p>
<p><strong>此时下方的name下拉框为可选状态&nbsp;&nbsp;找到Name:DialogInput.plain - Size:12&nbsp;&nbsp; 应用就ok了</strong></p>
<p>&nbsp;</p>
<p><strong>下面开始一步步的来创建一个web项目</strong></p>
<p><span><strong>1.首先 创建一个Project&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**</strong>也就是项目空间**</span></p>
<p><strong><img src="http://images.cnitblog.com/blog/355865/201301/29152002-599bc4776245421f9309c080241deb40.gif" alt=""></strong></p>
<p>2.选择项目类型&nbsp;这里选Java Module&nbsp; 自定义工作空间名称 和路径</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29152128-8f769e2278e0466082619fa750448237.png" alt=""></p>
<p>3.选择需要用到的框架组件&nbsp;这里只选了第一个&nbsp;Web Application &gt; Finish</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29152333-404c8da875d945ec845fbec85b3c5b36.gif" alt=""></p>
<p>4.创建完工作空间&nbsp;默认会是一个Module也就是一个项目 但是不推荐使用该项目进行开发</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29152650-dab203ebafa04bddbcb6be16ebfa5ee1.png" alt=""></p>
<p>5.在该项目空间中&nbsp;添加新的工程 选中工作空间&nbsp;右键Open Module Settings 或者是按下F4</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29153307-89ea6cef216f45319017b50159edd604.png" alt=""></p>
<p>6.添加工程</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29154653-eda8d28c584048b6b346d7514ba3d515.png" alt=""></p>
<p>&nbsp;</p>
<p><strong><img src="http://images.cnitblog.com/blog/355865/201301/29154807-49eacbe0dc524460b3f177b6a2668b34.png" alt=""></strong></p>
<p>然后Finish&nbsp;&nbsp;找到新建工程的web&gt;WEB-INF下创建&nbsp;classes 和lib文件夹&nbsp;</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29155004-ac0e1d8b9d6f4edb99597a88db0f136f.png" alt=""></p>
<p>修改编译输出目录&nbsp; Paths&gt;Use module compile output path 转到自定义的classes文件夹</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29155259-15fc13084bea4b95936b158d6f546473.png" alt=""></p>
<p>同样可以指定lib库目录&nbsp;&nbsp;添加&gt;jars or directories 指向创建的lib文件夹&nbsp; 弹出窗口选择jar directory<img src="http://images.cnitblog.com/blog/355865/201301/29155450-beee086f18d148ebb5480a7686cc9b8f.png" alt=""></p>
<p>&nbsp;</p>
<p>接下来&nbsp;部署测试&nbsp; 配置tomcat服务器&nbsp; 点击图&nbsp;箭头方向 那个下拉地方&nbsp;有个编辑服务器的 弹出右侧窗口</p>
<p>点击绿色的添加按钮 &gt;&nbsp;选择tomcat服务器 &gt;local</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29160928-b7ce076af8e949178a877ac0d554bd68.png" alt=""></p>
<p>选择部署的应用</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29162337-0e28706311fd4e34b8cc51c63b4cac58.png" alt=""></p>
<p>&nbsp;</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29162455-100451324e694e2f81aac0b53423ce0d.png" alt=""></p>
<p>&nbsp;</p>
<p>启动测试…</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29162525-3b11e6a77d8f42aeadd6beb5a7edf59e.png" alt=""></p>
<p>ok &gt;</p>
<p><img src="http://images.cnitblog.com/blog/355865/201301/29162653-328ea1b084644954a1980cde7c504a3b.png" alt=""></p>
<p>转自&nbsp;<a href="http://www.cnblogs.com/cnjava/archive/2013/01/29/2881654.html" target="_blank" rel="noopener">http://www.cnblogs.com/cnjava/archive/2013/01/29/2881654.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2013/04/11/Java-Collection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/04/11/Java-Collection/" itemprop="url">Java Collection</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-04-11T11:24:00+08:00">
                2013-04-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/04/11/Java-Collection/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/04/11/Java-Collection/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span>在 Java2中，有一套设计优良的接口和类组成了Java集合框架Collection，使程序员操作成批的数据或对象元素极为方便。这些接口和类有很多对抽象数据类型操作的API，而这是我们常用的且在数据结构中熟知的。例如Map，Set，List等。并且Java用面向对象的设计对这些数据结构和算法进行了封装，这就极大的减化了程序员编程时的负担。程序员也可以以这个集合框架为基础，定义更高级别的数据抽象，比如栈、队列和线程安全的集合等，从而满足自己的需要。&nbsp;</span></p>
<p><span>Java2的集合框架，抽其核心，主要有三种：List、Set和Map。如下图所示：&nbsp;</span></p>
<p><span>需要注意的是，这里的 Collection、List、Set和Map都是接口（Interface），不是具体的类实现。 List lst = new ArrayList(); 这是我们平常经常使用的创建一个新的List的语句，在这里， List是接口，ArrayList才是具体的类。&nbsp;</span></p>
<p><span>常用集合类的继承结构如下：&nbsp;</span><br><span>Collection&lt;–List&lt;–Vector&nbsp;</span><br><span>Collection&lt;–List&lt;–ArrayList&nbsp;</span><br><span>Collection&lt;–List&lt;–LinkedList&nbsp;</span><br><span>Collection&lt;–Set&lt;–HashSet&nbsp;</span><br><span>Collection&lt;–Set&lt;–HashSet&lt;–LinkedHashSet&nbsp;</span><br><span>Collection&lt;–Set&lt;–SortedSet&lt;–TreeSet&nbsp;</span><br><span>Map&lt;–SortedMap&lt;–TreeMap&nbsp;</span><br><span>Map&lt;–HashMap&nbsp;</span></p>
<p><span>———————————————–SB分割线——————————————&nbsp;</span></p>
<p><span>List：</span><span>&nbsp;</span><br><span>List是有序的Collection，使用此接口能够精确的控制每个元素插入的位置。用户能够使用索引（元素在List中的位置，类似于数组下 &gt;标）来访问List中的元素，这类似于Java的数组。&nbsp;</span></p>
<p><span>Vector：</span><span>&nbsp;</span><br><span>基于数组（Array）的List，其实就是封装了数组所不具备的一些功能方便我们使用，所以它难易避免数组的限制，同时性能也不可能超越数组。所以，在可能的情况下，我们要多运用数组。另外很重要的一点就是Vector是线程同步的(sychronized)的，这也是Vector和ArrayList 的一个的重要区别。&nbsp;</span></p>
<p><span>ArrayList：</span><span>&nbsp;</span><br><span>同Vector一样是一个基于数组上的链表，但是不同的是ArrayList不是同步的。所以在性能上要比Vector好一些，但是当运行到多线程环境中时，可需要自己在管理线程的同步问题。&nbsp;</span></p>
<p><span>LinkedList：</span><span>&nbsp;</span><br><span>LinkedList不同于前面两种List，它不是基于数组的，所以不受数组性能的限制。&nbsp;</span><br><span>它每一个节点（Node）都包含两方面的内容：&nbsp;</span><br><span>1.节点本身的数据（data）；&nbsp;</span><br><span>2.下一个节点的信息（nextNode）。&nbsp;</span><br><span>所以当对LinkedList做添加，删除动作的时候就不用像基于数组的ArrayList一样，必须进行大量的数据移动。只要更改nextNode的相关信息就可以实现了，这是LinkedList的优势。&nbsp;</span></p>
<p><span>List总结：</span><span>&nbsp;</span></p>
<ul>
<li>所有的List中只能容纳单个不同类型的对象组成的表，而不是Key－Value键值对。例如：[ tom,1,c ]</li>
</ul>
<p>&nbsp;</p>
<ul>
<li>所有的List中可以有相同的元素，例如Vector中可以有 [ tom,koo,too,koo ]</li>
</ul>
<p>&nbsp;</p>
<ul>
<li>所有的List中可以有null元素，例如[ tom,null,1 ]</li>
</ul>
<p>&nbsp;</p>
<ul>
<li>基于Array的List（Vector，ArrayList）适合查询，而LinkedList 适合添加，删除操作</li>
</ul>
<p><span>————————————–NB分割线————————————&nbsp;</span></p>
<p><span>Set：</span><span>&nbsp;</span><br><span>Set是一种不包含重复的元素的无序Collection。&nbsp;</span></p>
<p><span>HashSet：</span><span>&nbsp;</span><br><span>虽然Set同List都实现了Collection接口，但是他们的实现方式却大不一样。List基本上都是以Array为基础。但是Set则是在 HashMap的基础上来实现的，这个就是Set和List的根本区别。HashSet的存储方式是把HashMap中的Key作为Set的对应存储项。看看 HashSet的add（Object obj）方法的实现就可以一目了然了。&nbsp;</span></p>
<div id="" class="dp-highlighter"><br><div class="bar"><br><div class="tools">Java代码&nbsp;&nbsp;<a href="http://www.cnblogs.com/tiantianbyconan/admin/" title="收藏这段代码" target="_blank" rel="noopener"><img src="http://skyuck.iteye.com/images/icon_star.png" alt="收藏代码"></a></div>

<p></p></div><p></p>
<ol>
<li><span><span class="keyword">public</span>&nbsp;<span class="keyword">boolean</span>&nbsp;add(Object&nbsp;obj)&nbsp;{&nbsp;&nbsp;&nbsp;</span></li>
<li><span>&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;map.put(obj,&nbsp;PRESENT)&nbsp;==&nbsp;<span class="keyword">null</span>;&nbsp;&nbsp;&nbsp;</span></li>
<li><span>}&nbsp;&nbsp;&nbsp;</span></li></ol></div>

<p><span>这个也是为什么在Set中不能像在List中一样有重复的项的根本原因，因为HashMap的key是不能有重复的。&nbsp;</span></p>
<p><span>LinkedHashSet：</span><span>&nbsp;</span><br><span>HashSet的一个子类，一个链表。&nbsp;</span></p>
<p><span>TreeSet：</span><span>&nbsp;</span><br><span>SortedSet的子类，它不同于HashSet的根本就是TreeSet是有序的。它是通过SortedMap来实现的。&nbsp;</span></p>
<p><span>Set总结：</span><span>&nbsp;</span></p>
<ul>
<li>Set实现的基础是Map（HashMap）</li>
</ul>
<p>&nbsp;</p>
<ul>
<li>Set中的元素是不能重复的，如果使用add(Object obj)方法添加已经存在的对象，则会覆盖前面的对象</li>
</ul>
<p><span>————————————–2B分割线————————————&nbsp;</span></p>
<p><span>Map：</span><span>&nbsp;</span><br><span>Map 是一种把键对象和值对象进行关联的容器，而一个值对象又可以是一个Map，依次类推，这样就可形成一个多级映射。对于键对象来说，像Set一样，一个 Map容器中的键对象不允许重复，这是为了保持查找结果的一致性;如果有两个键对象一样，那你想得到那个键对象所对应的值对象时就有问题了，可能你得到的并不是你想的那个值对象，结果会造成混乱，所以键的唯一性很重要，也是符合集合的性质的。当然在使用过程中，某个键所对应的值对象可能会发生变化，这时会按照最后一次修改的值对象与键对应。对于值对象则没有唯一性的要求，你可以将任意多个键都映射到一个值对象上，这不会发生任何问题（不过对你的使用却可能会造成不便，你不知道你得到的到底是那一个键所对应的值对象）。&nbsp;</span></p>
<p><span>Map有两种比较常用的实现：HashMap和TreeMap。&nbsp;</span></p>
<p><span>HashMap也用到了哈希码的算法，以便快速查找一个键，&nbsp;</span></p>
<p><span>TreeMap则是对键按序存放，因此它便有一些扩展的方法，比如firstKey(),lastKey()等，你还可以从TreeMap中指定一个范围以取得其子Map。&nbsp;</span><br><span>键和值的关联很简单，用put(Object key,Object value)方法即可将一个键与一个值对象相关联。用get(Object key)可得到与此key对象所对应的值对象。&nbsp;</span></p>
<p><span>————————————–JB分割线————————————&nbsp;</span></p>
<p><span>其它：</span><span>&nbsp;</span><br><span>一、几个常用类的区别&nbsp;</span><br><span>1．ArrayList: 元素单个，效率高，多用于查询&nbsp;</span><br><span>2．Vector: 元素单个，线程安全，多用于查询&nbsp;</span><br><span>3．LinkedList:元素单个，多用于插入和删除&nbsp;</span><br><span>4．HashMap: 元素成对，元素可为空&nbsp;</span><br><span>5．HashTable: 元素成对，线程安全，元素不可为空&nbsp;</span></p>
<p><span>二、Vector、ArrayList和LinkedList&nbsp;</span><br><span>大多数情况下，从性能上来说ArrayList最好，但是当集合内的元素需要频繁插入、删除时LinkedList会有比较好的表现，但是它们三个性能都比不上数组，另外Vector是线程同步的。所以：&nbsp;</span><br><span>如果能用数组的时候(元素类型固定，数组长度固定)，请尽量使用数组来代替List；&nbsp;</span><br><span>如果没有频繁的删除插入操作，又不用考虑多线程问题，优先选择ArrayList；&nbsp;</span><br><span>如果在多线程条件下使用，可以考虑Vector；&nbsp;</span><br><span>如果需要频繁地删除插入，LinkedList就有了用武之地；&nbsp;</span><br><span>如果你什么都不知道，用ArrayList没错。&nbsp;</span></p>
<p><span>三、Collections和Arrays&nbsp;</span><br><span>在 Java集合类框架里有两个类叫做Collections（注意，不是Collection！）和Arrays，这是JCF里面功能强大的工具，但初学者往往会忽视。按JCF文档的说法，这两个类提供了封装器实现（Wrapper Implementations）、数据结构算法和数组相关的应用。&nbsp;</span><br><span>想必大家不会忘记上面谈到的&ldquo;折半查找&rdquo;、&ldquo;排序&rdquo;等经典算法吧，Collections类提供了丰富的静态方法帮助我们轻松完成这些在数据结构课上烦人的工作：&nbsp;</span><br><span>binarySearch：折半查找。&nbsp;</span></p>
<p><span>sort：排序，这里是一种类似于快速排序的方法，效率仍然是O(n * log n)，但却是一种稳定的排序方法。&nbsp;</span></p>
<p><span>reverse：将线性表进行逆序操作，这个可是从前数据结构的经典考题哦！&nbsp;</span></p>
<p><span>rotate：以某个元素为轴心将线性表&ldquo;旋转&rdquo;。&nbsp;</span></p>
<p><span>swap：交换一个线性表中两个元素的位置。&nbsp;</span><br><span>&hellip;&hellip;&nbsp;</span><br><span>Collections还有一个重要功能就是&ldquo;封装器&rdquo;（Wrapper），它提供了一些方法可以把一个集合转换成一个特殊的集合，如下：&nbsp;</span></p>
<p><span>unmodifiableXXX：转换成只读集合，这里XXX代表六种基本集合接口：Collection、List、Map、Set、SortedMap和SortedSet。如果你对只读集合进行插入删除操作，将会抛出UnsupportedOperationException异常。&nbsp;</span></p>
<p><span>synchronizedXXX：转换成同步集合。&nbsp;</span></p>
<p><span>singleton：创建一个仅有一个元素的集合，这里singleton生成的是单元素Set，&nbsp;</span><br><span>singletonList和singletonMap分别生成单元素的List和Map。&nbsp;</span></p>
<p><span>空集：由Collections的静态属性EMPTY_SET、EMPTY_LIST和EMPTY_MAP表示。&nbsp;</span></p>
<p><span>这次关于Java集合类概述就到这里，下一次我们来讲解Java集合类的具体应用，如List排序、删除重复元素。</span></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2013/03/04/Java数据结构和算法——汉诺塔问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/03/04/Java数据结构和算法——汉诺塔问题/" itemprop="url">Java数据结构和算法——汉诺塔问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-03-04T17:18:00+08:00">
                2013-03-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/03/04/Java数据结构和算法——汉诺塔问题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/03/04/Java数据结构和算法——汉诺塔问题/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="cnblogs_code"><br><pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.tiantian.algorithms;<br></span><span style="color: #008000;">/<em>*</em></span><span style="color: #008000;">
     _|<em>1              |                |<br> <em>   <strong>|</strong>2             |                |
 </em>  __</em>|<strong>_3            |                |            (1).把A上的4个木块移动到C上。<br> * __</strong>|<strong>_<em>4           |                |<br> <em>     A                B                C
 </em><br> <em>     |                |                |
 </em>     |               </em>|_1              |<br> *     |              </strong>|<strong>2             |            要完成(1)的效果，必须要把1、2、3木块移动到B，这样才能把4移动到C<br> * __</strong>|<strong>_<em>4        </em></strong>|<strong><em>3            |            如：代码中的&ldquo;调用(XX)&rdquo;<br> <em>     A                B                C
 </em><br> <em>     |                |                |
 </em>     |               </em>|_1              |<br> *     |              </strong>|<strong>2             |            此时，题目就变成了把B上的3个木块移动到C上，回到了题目(1)<br> *     |             _</strong>|<strong>_3        __</strong>|____4        如：代码中的&ldquo;调用(YY)&rdquo;<br> <em>     A                B                C
 </em><br> <em>     然后循环这个过程
 </em><br> <em> </em></span><span style="color: #808080;">@author</span><span style="color: #008000;"> wangjie
  </span><span style="color: #808080;">@version</span><span style="color: #008000;"> 创建时间：2013-3-4 下午4:09:53<br> </span><span style="color: #008000;">*/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> HanoiTowerTest {<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {<br>        doTowers(</span>4, ‘A’, ‘B’, ‘C’<span style="color: #000000;">);<br>    }<br><br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> doTowers(<span style="color: #0000ff;">int</span> topN, <span style="color: #0000ff;">char</span> from, <span style="color: #0000ff;">char</span> inter, <span style="color: #0000ff;">char</span><span style="color: #000000;"> to){<br>        </span><span style="color: #0000ff;">if</span>(topN == 1<span style="color: #000000;">){<br>            System.out.println(</span>“最后把木块1从” + from + “移动到” +<span style="color: #000000;"> to);<br>        }</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{<br>            doTowers(topN </span>- 1, from, to, inter); <span style="color: #008000;">//</span><span style="color: #008000;"> 调用(XX)</span><br>            System.out.println(“把木块” + topN + “从” + from + “移动到” +<span style="color: #000000;"> to);<br>            doTowers(topN </span>- 1, inter, from ,to); <span style="color: #008000;">//</span><span style="color: #008000;"> 调用(YY)</span><br><span style="color: #000000;">        }<br><br>    }<br>}</span></pre><br></div>

<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2013/03/03/Struts-iBatis-Spring-mysql整合开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/03/03/Struts-iBatis-Spring-mysql整合开发/" itemprop="url">Struts+iBatis+Spring+mysql整合开发</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-03-03T14:54:00+08:00">
                2013-03-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/03/03/Struts-iBatis-Spring-mysql整合开发/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/03/03/Struts-iBatis-Spring-mysql整合开发/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span style="color: #800000;"><strong><span style="line-height: 1.5;">转载请注明：<a href="http://www.cnblogs.com/tiantianbyconan/archive/2013/03/03/2941554.html" target="_blank" rel="noopener"><span style="color: #800000;">http://www.cnblogs.com/tiantianbyconan/archive/2013/03/03/2941554.html</span></a></span></strong></span></p>
<p><span style="line-height: 1.5;">本文使用Struts+iBatis+Spring三层框架开实现对user表的CRUD。</span></p>
<p><span style="line-height: 1.5;">分层如下：</span></p>
<p><img src="http://images.cnitblog.com/blog/378300/201303/03145921-9115e3b0b60448bab6e391c5233f80c8.jpg" alt=""></p>
<p>&nbsp;</p>
<p><span style="line-height: 1.5;">iBatis配置文件（sqlMapConfig.xml）：</span></p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version=”1.0” encoding=”UTF-8”</span><span style="color: #0000ff;">?&gt;</span><br><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE sqlMapConfig<br>    PUBLIC “-//ibatis.apache.org//DTD SQL Map Config 2.0//EN”<br>    “<a href="http://ibatis.apache.org/dtd/sql-map-config-2.dtd" target="_blank" rel="noopener">http://ibatis.apache.org/dtd/sql-map-config-2.dtd</a>“</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">sqlMapConfig</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">settings </span><span style="color: #ff0000;">cacheModelsEnabled</span><span style="color: #0000ff;">=”true”</span><span style="color: #ff0000;"> enhancementEnabled</span><span style="color: #0000ff;">=”true”</span><span style="color: #ff0000;"><br>        lazyLoadingEnabled</span><span style="color: #0000ff;">=”true”</span><span style="color: #ff0000;"> errorTracingEnabled</span><span style="color: #0000ff;">=”true”</span><span style="color: #ff0000;"> maxRequests</span><span style="color: #0000ff;">=”32”</span><span style="color: #ff0000;"><br>        maxSessions</span><span style="color: #0000ff;">=”10”</span><span style="color: #ff0000;"> maxTransactions</span><span style="color: #0000ff;">=”5”</span><span style="color: #ff0000;"> useStatementNamespaces</span><span style="color: #0000ff;">=”false”</span> <span style="color: #0000ff;">/&gt;</span><br><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">sqlMap </span><span style="color: #ff0000;">resource</span><span style="color: #0000ff;">=”com/tiantian/ibatis/model/user.xml”</span> <span style="color: #0000ff;">/&gt;</span><br><br><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">sqlMapConfig</span><span style="color: #0000ff;">&gt;</span></pre><br></div>

<p>&nbsp;</p>
<p>struts.xml：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version=”1.0” encoding=”UTF-8”</span><span style="color: #0000ff;">?&gt;</span><br><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE struts PUBLIC<br>    “-//Apache Software Foundation//DTD Struts Configuration 2.3//EN”<br>    “<a href="http://struts.apache.org/dtds/struts-2.3.dtd" target="_blank" rel="noopener">http://struts.apache.org/dtds/struts-2.3.dtd</a>“</span><span style="color: #0000ff;">&gt;</span><br><br><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">struts</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">package </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”ibatis_test”</span><span style="color: #ff0000;"> extends</span><span style="color: #0000ff;">=”struts-default”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 注册User action </span><span style="color: #008000;">–&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">action </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”registerUser”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”registerUserAction”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">action</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 删除User action </span><span style="color: #008000;">–&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">action </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”deleteUser”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”deleteUserAction”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">action</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 更新User action </span><span style="color: #008000;">–&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">action </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”updateUser”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”updateUserAction”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">action</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 查询所有User action </span><span style="color: #008000;">–&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">action </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”findAllUsers”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”findAllUsersAction”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">action</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 查询指定id的User action </span><span style="color: #008000;">–&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">action </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”findUserById”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”findUserByIdAction”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">action</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 模糊查询User action </span><span style="color: #008000;">–&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">action </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”findUsersBykeyword”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”findUsersBykeywordAction”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">action</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">package</span><span style="color: #0000ff;">&gt;</span><br><br><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">struts</span><span style="color: #0000ff;">&gt;</span></pre><br></div>

<p>&nbsp;</p>
<p>user.xml配置文件：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version=”1.0” encoding=”UTF-8”</span><span style="color: #0000ff;">?&gt;</span><br><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE sqlMap<br>    PUBLIC “-//ibatis.apache.org//DTD SQL Map 2.0//EN”<br>    “<a href="http://ibatis.apache.org/dtd/sql-map-2.dtd" target="_blank" rel="noopener">http://ibatis.apache.org/dtd/sql-map-2.dtd</a>“</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">sqlMap</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 为Student类取个别名 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">typeAlias </span><span style="color: #ff0000;">alias</span><span style="color: #0000ff;">=”UserAlias”</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">=”com.tiantian.ibatis.model.User”</span><span style="color: #0000ff;">/&gt;</span><br><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 配置表和实体Bean之间的映射关系 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">resultMap </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”userMap”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.tiantian.ibatis.model.User”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">result </span><span style="color: #ff0000;">property</span><span style="color: #0000ff;">=”id”</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">=”id”</span><span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">result </span><span style="color: #ff0000;">property</span><span style="color: #0000ff;">=”username”</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">=”username”</span><span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">result </span><span style="color: #ff0000;">property</span><span style="color: #0000ff;">=”password”</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">=”password”</span><span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">result </span><span style="color: #ff0000;">property</span><span style="color: #0000ff;">=”age”</span><span style="color: #ff0000;"> column</span><span style="color: #0000ff;">=”age”</span><span style="color: #0000ff;">/&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">resultMap</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 添加数据 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">insert </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”registerUser”</span><span style="color: #ff0000;"> parameterClass</span><span style="color: #0000ff;">=”UserAlias”</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;"><br>        INSERT INTO user VALUES (NULL, #username#, #password#, #age#);<br>    </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">insert</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 删除指定id的数据 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">delete </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”deleteUser”</span><span style="color: #ff0000;"> parameterClass</span><span style="color: #0000ff;">=”UserAlias”</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;"><br>        DELETE FROM user WHERE id = #id#;<br>    </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">delete</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 修改指定id的数据 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">update </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”updateUser”</span><span style="color: #ff0000;"> parameterClass</span><span style="color: #0000ff;">=”UserAlias”</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;"><br>        UPDATE user<br>        SET username = #username#, password = #password#, age = #age#<br>        WHERE id = #id#;<br>    </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">update</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 查询所有User信息 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">select </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”findAllUsers”</span><span style="color: #ff0000;"> resultMap</span><span style="color: #0000ff;">=”userMap”</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;"><br>        SELECT <em> FROM user;<br>    </em></span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">select</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 查询指定id的User信息 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">select </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”findUserById”</span><span style="color: #ff0000;"> resultMap</span><span style="color: #0000ff;">=”userMap”</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;"><br>        SELECT  FROM user WHERE id = #id#;<br>    </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">select</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 模糊查询 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">select </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”findUsersByKeyword”</span><span style="color: #ff0000;"> resultMap</span><span style="color: #0000ff;">=”userMap”</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;"><br>        SELECT * FROM user WHERE username LIKE ‘%$keyword$%’;<br>    </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">select</span><span style="color: #0000ff;">&gt;</span><br><br><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">sqlMap</span><span style="color: #0000ff;">&gt;</span></pre><br></div>

<p>&nbsp;</p>
<p>applicationContext.xml配置文件：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version=”1.0” encoding=”UTF-8”</span><span style="color: #0000ff;">?&gt;</span><br><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">beans </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/beans" target="_blank" rel="noopener">http://www.springframework.org/schema/beans</a>“</span><span style="color: #ff0000;"><br>    xmlns:xsi</span><span style="color: #0000ff;">=”<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank" rel="noopener">http://www.w3.org/2001/XMLSchema-instance</a>“</span><span style="color: #ff0000;"> xmlns:p</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/p" target="_blank" rel="noopener">http://www.springframework.org/schema/p</a>“</span><span style="color: #ff0000;"><br>    xsi:schemaLocation</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/beans" target="_blank" rel="noopener">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans-3.0.xsd" target="_blank" rel="noopener">http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</a>“</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”dataSource”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”org.apache.commons.dbcp.BasicDataSource”</span><span style="color: #ff0000;"><br>        destroy-method</span><span style="color: #0000ff;">=”close”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”driverClassName”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”com.mysql.jdbc.Driver”</span> <span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”url”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”jdbc:mysql://localhost:3306/test”</span> <span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”username”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”root”</span> <span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”password”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”XXXX”</span> <span style="color: #0000ff;">/&gt;</span><br><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”validationQuery”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”select user.id from user”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”maxIdle”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”15”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”maxActive”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”15”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”maxWait”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”1000”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”sqlMapClient”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”org.springframework.orm.ibatis.SqlMapClientFactoryBean”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”configLocation”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”classpath:sqlMapConfig.xml”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”dataSource”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”dataSource”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 事务管理 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”transactionManager”</span><span style="color: #ff0000;"><br>        class</span><span style="color: #0000ff;">=”org.springframework.jdbc.datasource.DataSourceTransactionManager”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”dataSource”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”dataSource”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> 声明式事务管理 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”baseTransactionProxy”</span><span style="color: #ff0000;"><br>        class</span><span style="color: #0000ff;">=”org.springframework.transaction.interceptor.TransactionProxyFactoryBean”</span><span style="color: #ff0000;"><br>        abstract</span><span style="color: #0000ff;">=”true”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”transactionManager”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”transactionManager”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”transactionAttributes”</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">props</span><span style="color: #0000ff;">&gt;</span><br>                <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"><br>                    表示设置事务属性所有以”find”和”get”开头的方法：<br>                    - PROPAGATION_REQUIRED: 当前存在事务则使用存在的事务，如果不存在，则开启一个新的事务<br>                    - readOnly:表示只读的事务<br>                 </span><span style="color: #008000;">–&gt;</span><br>                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">prop </span><span style="color: #ff0000;">key</span><span style="color: #0000ff;">=”find<em>“</em></span><span style="color: #0000ff;">&gt;</span>PROPAGATION_REQUIRED,readOnly<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">prop</span><span style="color: #0000ff;">&gt;</span><br>                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">prop </span><span style="color: #ff0000;">key</span><span style="color: #0000ff;">=”get“</span><span style="color: #0000ff;">&gt;</span>PROPAGATION_REQUIRED,readOnly<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">prop</span><span style="color: #0000ff;">&gt;</span><br>                <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">prop </span><span style="color: #ff0000;">key</span><span style="color: #0000ff;">=”<em>“</em></span><span style="color: #0000ff;">&gt;</span>PROPAGATION_REQUIRED<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">prop</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">props</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> <strong><strong><strong><strong><strong><strong><em>**</em></strong></strong></strong></strong></strong></strong>以上一般只需修改数据库配置<strong><strong><strong><strong><strong><strong><strong><em>**</em></strong></strong></strong></strong></strong></strong></strong> </span><span style="color: #008000;">–&gt;</span><br><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> <strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong>DAO<strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong> </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> DAO、Service一般都配置成singleton（可以不写，因为默认是singleton） </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”userDao”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.tiantian.ibatis.dao.impl.UserDaoImpl”</span><span style="color: #ff0000;"> scope</span><span style="color: #0000ff;">=”singleton”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”sqlMapClient”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”sqlMapClient”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> <strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong>Service<strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong> </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> Service，没有事务功能 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”userServiceTarget”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.tiantian.ibatis.service.impl.UserServiceImpl”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”userDao”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”userDao”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> Service的代理，目的是为Service添加事务的功能 </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”userService”</span><span style="color: #ff0000;"> parent</span><span style="color: #0000ff;">=”baseTransactionProxy”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”target”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”userServiceTarget”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>**</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> <strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong>Action<strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong> </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>**</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> Action一般都配置成prototype（必须要写!） </span><span style="color: #008000;">–&gt;</span><br><span style="color: #008000;">&lt;!–</span><span style="color: #008000;"> <strong>User Actions</strong> </span><span style="color: #008000;">–&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”registerUserAction”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.tiantian.ibatis.action.user.RegisterUserAction”</span><span style="color: #ff0000;"> scope</span><span style="color: #0000ff;">=”prototype”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”userService”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”userService”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”deleteUserAction”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.tiantian.ibatis.action.user.DeleteUserAction”</span><span style="color: #ff0000;"> scope</span><span style="color: #0000ff;">=”prototype”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”userService”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”userService”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”updateUserAction”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.tiantian.ibatis.action.user.UpdateUserAction”</span><span style="color: #ff0000;"> scope</span><span style="color: #0000ff;">=”prototype”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”userService”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”userService”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”findAllUsersAction”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.tiantian.ibatis.action.user.FindAllUsersAction”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”userService”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”userService”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”findUserByIdAction”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.tiantian.ibatis.action.user.FindUserByIdAction”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”userService”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”userService”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”findUsersBykeywordAction”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.tiantian.ibatis.action.user.FindUsersByKeywordAction”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”userService”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”userService”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br><br><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">beans</span><span style="color: #0000ff;">&gt;</span></pre><br></div>

<p>&nbsp;</p>
<p>DAO接口：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008000;">/<em>*</em></span><span style="color: #008000;">
  </span><span style="color: #808080;">@author</span><span style="color: #008000;"> wangjie<br> <em> </em></span><span style="color: #808080;">@version</span><span style="color: #008000;"> 创建时间：2013-3-1 下午5:44:21<br> </span><span style="color: #008000;">/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> UserDao {<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> registerUser(User user);<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> deleteUser(User user);<br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> updateUser(User user);<br>    </span><span style="color: #0000ff;">public</span> List&lt;User&gt;<span style="color: #000000;"> findAllUsers();<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> User findUserById(User user);<br>    </span><span style="color: #0000ff;">public</span> List&lt;User&gt;<span style="color: #000000;"> findUsersByKeyword(String keyword);<br>}</span></pre><br></div>

<p>DAO实现类（执行各个Action所需的数据库查询操作）：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.tiantian.ibatis.dao.impl;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.orm.ibatis.support.SqlMapClientDaoSupport;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.tiantian.ibatis.dao.UserDao;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.tiantian.ibatis.model.User;<br><br></span><span style="color: #008000;">/<em>*</em></span><span style="color: #008000;">
  </span><span style="color: #808080;">@author</span><span style="color: #008000;"> wangjie<br> <em> </em></span><span style="color: #808080;">@version</span><span style="color: #008000;"> 创建时间：2013-3-1 下午6:09:53<br> </span><span style="color: #008000;">/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> UserDaoImpl <span style="color: #0000ff;">extends</span> SqlMapClientDaoSupport <span style="color: #0000ff;">implements</span><span style="color: #000000;"> UserDao{<br><br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> registerUser(User user) {<br>        getSqlMapClientTemplate().insert(</span>“registerUser”<span style="color: #000000;">, user);<br>    }<br><br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> deleteUser(User user) {<br>        </span><span style="color: #0000ff;">boolean</span> result = <span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>        </span><span style="color: #0000ff;">int</span> effectedRow = getSqlMapClientTemplate().delete(“deleteUser”<span style="color: #000000;">, user);<br>        System.out.println(</span>“delete effectedRow: “ +<span style="color: #000000;"> effectedRow);<br>        result </span>= effectedRow &gt; 0 ? <span style="color: #0000ff;">true</span> : <span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;<br>    }<br><br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> updateUser(User user) {<br>        </span><span style="color: #0000ff;">boolean</span> result = <span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>        </span><span style="color: #0000ff;">int</span> effectedRow = getSqlMapClientTemplate().update(“updateUser”<span style="color: #000000;">, user);<br>        System.out.println(</span>“update effectedRow: “ +<span style="color: #000000;"> effectedRow);<br>        result </span>= effectedRow &gt; 0 ? <span style="color: #0000ff;">true</span> : <span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result;<br>    }<br><br>    </span><span style="color: #0000ff;">public</span> List&lt;User&gt;<span style="color: #000000;"> findAllUsers() {<br>        </span><span style="color: #0000ff;">return</span> (List&lt;User&gt;)getSqlMapClientTemplate().queryForList(“findAllUsers”<span style="color: #000000;">);<br>    }<br><br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> User findUserById(User user) {<br>        </span><span style="color: #0000ff;">return</span> (User) getSqlMapClientTemplate().queryForObject(“findUserById”<span style="color: #000000;">, user);<br>    }<br><br>    </span><span style="color: #0000ff;">public</span> List&lt;User&gt;<span style="color: #000000;"> findUsersByKeyword(String keyword) {<br>        </span><span style="color: #0000ff;">return</span> (List&lt;User&gt;)getSqlMapClientTemplate().queryForList(“findUsersByKeyword”<span style="color: #000000;">, keyword);<br>    }<br><br>}</span></pre><br></div>

<p>Action类（以RegisterUserAction为例）：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.tiantian.ibatis.action.user;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.opensymphony.xwork2.ActionSupport;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.tiantian.ibatis.model.User;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.tiantian.ibatis.service.UserService;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.tiantian.ibatis.service.impl.UserServiceImpl;<br><br></span><span style="color: #008000;">/<em>*</em></span><span style="color: #008000;">
  </span><span style="color: #808080;">@author</span><span style="color: #008000;"> wangjie<br> <em> </em></span><span style="color: #808080;">@version</span><span style="color: #008000;"> 创建时间：2013-3-2 下午11:26:18<br> </span><span style="color: #008000;">/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> RegisterUserAction <span style="color: #0000ff;">extends</span><span style="color: #000000;"> ActionSupport{<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> UserService userService;<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> User user;<br><br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> User getUser() {<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> user;<br>    }<br><br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setUser(User user) {<br>        </span><span style="color: #0000ff;">this</span>.user =<span style="color: #000000;"> user;<br>    }<br><br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> UserService getUserService() {<br>        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> userService;<br>    }<br><br>    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setUserService(UserService userService) {<br>        </span><span style="color: #0000ff;">this</span>.userService =<span style="color: #000000;"> userService;<br>    }<br><br>    @Override<br>    </span><span style="color: #0000ff;">public</span> String execute() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {<br>        userService.registerUser(user);<br>        System.out.println(</span>“数据已经插入”<span style="color: #000000;">);<br>        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;<br>    }<br>}</span></pre><br></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2013/02/27/svn的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/02/27/svn的使用/" itemprop="url">svn的使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-02-27T09:58:00+08:00">
                2013-02-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/02/27/svn的使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/02/27/svn的使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>转载请注明：<a href="http://www.cnblogs.com/tiantianbyconan/archive/2013/02/27/2934628.html" target="_blank" rel="noopener">http://www.cnblogs.com/tiantianbyconan/archive/2013/02/27/2934628.html</a></strong></p>
<p>新建如下结构的文件夹：<br>sv_workspace<br>    |–svn_repos<br>    |–svn_imports<br>    |–svn_checkouts</p>
<p>svn_repos：中创建各种版本库（一个项目使用一个版本库）<br>svn_imports：导入最初始的项目<br>svn_checkouts：从版本库中检出的项目，真正的工作目录</p>
<p>1.先在svn_repos中新建版本库，如：infolife_repo，右键在此创建版本库。<br>2.在svn_imports文件夹中新建对应的文件夹检出，如：infolife_import。<br>右键检出，此时该文件夹会生成branches、tags、trunk和一个.svn的文件夹<br>3。.在eclipse中新建项目后，把项目复制到svn_imports目录的truck目录下，</p>
<p>然后右键导入，url写版本库的truck目录</p>
<p>4.最后在工作目录（svn_checkouts）新建一个目录比如c:\svnclient\rolex</p>
<p>\trunk，然后在trunk上checkout出svn://IP/infolife/trunk上的内容。<br>或者在使用eclipse的import，检出目录选择svn_checkouts即可</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2013/02/24/看书笔记-《深入java虚拟机》——java体系结构（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/02/24/看书笔记-《深入java虚拟机》——java体系结构（二）/" itemprop="url">[看书笔记]《深入java虚拟机》——java体系结构（二）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-02-24T10:02:00+08:00">
                2013-02-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/02/24/看书笔记-《深入java虚拟机》——java体系结构（二）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/02/24/看书笔记-《深入java虚拟机》——java体系结构（二）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>java虚拟机的三种含义：</p>
<ul>
<li>抽象的规范</li>
<li>一个具体的实现</li>
<li>一个运行中的虚拟机实例</li>
</ul>
<p>———————java虚拟机的生命周期：<br>java虚拟机实例的天职就是负责运行一个java程序。<br>启动一个java程序，一个虚拟机实例诞生了；程序关闭退出，虚拟机消亡。<br>有几个java程序正在运行，就有几个java虚拟机实例。每个java程序都运行在自己的java虚拟机实例中。</p>
<p>java虚拟机中有两种线程：</p>
<ul>
<li>守护线程：由虚拟机自己使用的（执行垃圾收集线程），java程序也可以把任何线程标记为守护线程。</li>
<li>非守护线程：main()这种。</li>
</ul>
<p>非守护线程都终止时，虚拟机实例才自动退出。（也可以调用Runtime或System的exit()方法退出程序）。</p>
<p>———————java虚拟机的体系结构：<br>见同目录第五章.Java虚拟机-体系结构图！<br>方法区和堆是该虚拟机实例的所有线程共享的。<br>当虚拟机装载一个class文件时，他会从这个class文件包含的二进制数据中解析类型信息，然后把这些类型信息放到方法区中。<br>当程序运行时，虚拟机会把所有该程序在运行时创建的对象都放到堆中。</p>
<p>每个新线程被创建时，他都将得到它自己的PC寄存器以及一个java栈（不是所有线程共享）。<br>java虚拟机为每个线程创建内存区，这些内存区域是私有的，任何线程都不能访问另一个线程的PC寄存器或者java栈。<br>如果线程正在执行的是一个java方法（非本地方法），那么PC寄存器的值将总是指示下一条将被执行的指令。<br>java栈则总是存储该线程中java方法调用的状态（局部变量、被调用时传进来的参数、返回值、运算的中间结果）</p>
<p>本地方法调用的状态则是以某种依赖于具体实现的方式存储在本地方法栈中，也可能在寄存器或者其他某些特定实现相关的内存区中。</p>
<p>———————栈帧（1）：<br>java栈上由许多栈帧（帧）组成的，一个栈帧包含一个java方法调用的状态。<br>当线程调用一个java方法时，虚拟机压入一个新的栈帧到该线程的java栈中；当方法返回时，这个栈帧被从java栈中弹出并抛弃。</p>
<p>java虚拟机没有寄存器，其指令集使用java栈来存储中间数据（为了平台无关性）。</p>
<p>———————类型数据<br>类型数据分为来那个中：<br>基本类型：float、double、byte、short、int、long、char、boolean<br>引用类型：reference（类引用、接口引用、数组引用）<br>注意：编译成字节码时boolean用int表示，</p>
<p>java虚拟机中，最基本的数据单元就是字，至少选择32位作为字长。<br>运行时数据区的大部分内容，都是基于&ldquo;字&rdquo;这个抽象概念的。</p>
<p>———————类装载器子系统：<br>类装载器的装载、连接和初始化：</p>
<ul>
<li>装载：查找并装载类型的二进制数据</li>
<li>连接：执行验证，准备，以及解析（可选）。<br>  验证：确保被导入类型的正确性。<br>  准备：为静态变量分配内存，并将其初始化为默认值。<br>  解析：把类型中的符号引用转换为直接引用。</li>
<li>初始化：把静态变量初始化为正确初始值。</li>
</ul>
<p>启动类装载器：<br>只要是符合java class文件格式的二进制文件，java虚拟机实现都必须能够从中辨别并装载器中的类和接口。每个java虚拟机实现必须有一个启动类加载器来加载受信任的类，比如java API。</p>
<p>用户自定义类装载器：<br>用户自定义的类装载器是普通的java对象，它的类必须派生自java.lang.ClassLoader类。ClassLoader类中定义的方法为程序提供了访问类装载器机制的接口。<br>用户自定义类装载器和Class类的实例都放在内存中的堆区，而装载的类型信息则都位于方法区。</p>
<p>ClassLoader类的四个通往java虚拟机的方法：<br>protected final Class defineClass(String name, byte data[], int offset, int length);<br>接收一个名为data[]的字节数组，并且在data[offset]到data[data+length]之间的二进制数据必须符合java class格式（表示一个新的可用类），name是该类型的全限定名，并将赋以默认的保护域。注意：该方法返回Class对象实例时表示指定的class文件已经被找到并装载到了方法区（不一定连接和初始化）</p>
<p>protected final Class defineClass(String name, byte data[], int offset, int length,<br>ProtectionDomain protectionDomain);<br>与前面一样，只是，该类型的保护域将由它的protectionDomain参数指定。</p>
<p>protected final Class findSystemClass(String name);<br>接收一个字符串name（该类型的全限定名），用于启动系统类装载器（必须保证能启动）。</p>
<p>protected final void resolveClass(Class c);<br>接收一个Class实例的引用作为参数，它将对该Class实例表示的类型执行连接动作（必须保证能执行连接动作）。</p>
<p>———————方法区：<br>所有线程都共享方法区，所以它们对方法区数据的访问必须被设计为是线程安全的。<br>方法区的大小不必说固定的，虚拟机可以根据应用的需要动态调整。<br>方法区不必是连续的。<br>方法区也可以被垃圾收集。</p>
<p>类型信息：<br>对每个装载的类型，虚拟机都会在方法区中存储一下类型信息：</p>
<ul>
<li>该类型全限定名</li>
<li>该类型的直接超类的全限定名（除非是Object类，没有超类）</li>
<li>该类型是类类型还是接口类型</li>
<li>该类型的访问修饰符（public、abstract、final的某个子集）</li>
<li><p>任何型直接超接口的全限定名的有序列表</p>
</li>
<li><p>该类型的常量池【核心】：所有常量的类型字段方法的符号引用(索引访问)</p>
</li>
<li>字段信息：字段名，字段类型，字段修饰符</li>
<li>方法信息：方法名，返回类型，参数数量和类型(按序)，方法修饰符</li>
<li>除了常量以外的静态变量</li>
<li>一个到类ClassLoader的引用：跟踪保存该类加载时所用的加载器的类别</li>
<li>一个到Class类的引用：虚拟机会创建一个相应的java.lang.Class类的实例</li>
</ul>
<p>———————方法表：<br>方法表：类型数据结构<br>虚拟机为每个非抽象类都生成一个表，把它作为类信息的一部分保存在方法区。<br>方法表是一个数组，元素是所有它的实例可能被调用的实例方法的直接引用<br>，包括是超类直接继承过来的方法。运行时可以通过方法表快速搜寻在对象中调用的实例方法。</p>
<p>———————堆：<br>java程序在运行时创建的所有类实例或数组都放在同一个堆中（要考虑线程同步问题）。<br>和方法区一样，堆空间也不是连续的内存区。</p>
<p>———————数组：<br>数组的内部表示：<br>在java中，数组才是真正的对象<br>和其他对象一样，数组总是存储在堆中。<br>和其他对象一样，数组也有一个与他们的类关联的Class实例，所有具有相同维度和类型的数组都是同一个类的实例（不管数组的长度是多少）。</p>
<p>数组类的名称由两部分组成，每一维度用一个”[“表示，用字符或字符串表示元素类型。如&ldquo;[[Ljava/lang/Object&rdquo;表示元素为Object的二维数组。</p>
<p>在堆中，每一个数组对象还必须要保存数组的长度、数组数据以及某些指向数组的类数据的引用。</p>
<p>———————程序计数器（PC寄存器）：<br>每一个线程都有它自己的PC寄存器，它是在该线程启动的时候创建的。<br>PC寄存器的大小是字长，因此能够持有一个本地指针，也能够持有一个returnAddress。当线程执行某个java方法时，PC寄存器的内容总是写一条将被执行的指令的地址，这里的地址可以是个本地指针，也可以是在方法字节码中相对于该方法其实指令的偏移量。如果该线程正在执行一个本地方法，此时PC寄存器的值是&ldquo;undefined&rdquo;。</p>
<p>———————Java栈：<br>每当启动一个新线程时，java虚拟机都会为它分配一个java栈。<br>虚拟机智慧直接对java栈执行两种操作：以帧为单位的压栈或出栈。<br>每当线程调用一个java方法时，虚拟机都会在该java栈中压入一个新帧。<br>java方法不管是正常返回还是抛异常中止，虚拟机都会将当前栈弹出java栈，然后释放内存。</p>
<p>java栈和栈帧在内存中也不必说连续的。</p>
<p>———————栈帧（2）：<br>栈帧的构成：</p>
<ul>
<li><p>局部变量区：</p>
<pre><code>是一个以字长为单位，从0开始计数的数组。字节码指令通过从0开始的索引来使用其中的数据。
 int、float、reference和returnAddress的值在数组中只占一项；
 byte、short、char的值在存入数组前都被转换成int，所以也只占一项；
 boolean虚拟机不支持，用int来表示，所以也只占一项；
 long、double的值在数组中占两项（使用只要指出第一项索引值）。
 局部变量区包含对应的方法参数和局部变量。
 按参数的顺序来存入局部变量数组中。真正的局部变量顺序任意。
</code></pre></li>
<li><p>操作数栈：</p>
<pre><code>是一个以字节为单位的数组（不是通过索引来访问），是通过标准的栈操作（压栈和出栈）来访问。
存储的数据类型和局部变量区的一样。
虚拟机把操作数栈作为他的工作区，大多数指令都要从这里弹出数据，执行计算，然后把结果压回到操作数栈中。
</code></pre></li>
<li><p>帧数据区：</p>
<pre><code>常量池解析、正常方法返回、异常派发机制。
每当虚拟机要执行某个需要用到常量池数据的指令时，它都会通过帧数据区中指向常量池的指针来访问它。
帧数据区还要帮助虚拟机处理java方法的正常结束或异常中止：
如果正常结束：虚拟机必须恢复发起调用的方法的（上一个）栈帧，调用完成方法的指令的下一个指令。如果有返回值，虚拟机将把返回值压倒发
</code></pre></li>
</ul>
<p>起调用的方法的操作数栈。<br>         如果抛出异常，根据帧数据区的异常表来处理。如果有catch语句，就会交给catch中的代码，如果没有，则立即异常中止。</p>
<p>———————本地方法栈：<br>当线程调用本地方法时，虚拟机会保持java栈不变，不再在线程的java栈中压入新的帧，虚拟机只是简单地动态连接并直接调用指定的本地方法。</p>
<p>就像其他运行时内存区一样，本地方法栈占用的内存区也不必说固定大小的，它可以根据需要动态扩展或者收缩。</p>
<p>———————执行引擎：<br>任何java虚拟机实现的核心都是它的执行引擎。<br>在java虚拟机规范中，执行引擎的行为使用指令集来定义。<br>作为运行时实例的执行引擎就是一个线程。<br>运行中java程序的每一个线程都是一个独立的虚拟机执行引擎的实例。从生命周期的开始到结束，它要么在执行字节码，要么在执行本地方法。</p>
<p><img src="http://images.cnitblog.com/blog/378300/201302/24100155-fc24aa95237c49d8b70f462592324040.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.wangjiegulu.com/2013/02/24/lucene-使用教程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wang Jie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WAND JIE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2013/02/24/lucene-使用教程/" itemprop="url">lucene 使用教程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-02-24T09:59:00+08:00">
                2013-02-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/02/24/lucene-使用教程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/02/24/lucene-使用教程/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><span>1 lucene简介&nbsp;</span><br><span>1.1 什么是lucene&nbsp;</span><br><span>Lucene是一个全文搜索框架，而不是应用产品。因此它并不像</span><a href="http://www.baidu.com/" target="_blank" rel="noopener"><span>http://www.baidu.com/</span></a><span>&nbsp;或者google Desktop那么拿来就能用，它只是提供了一种工具让你能实现这些产品。</span></p>
<p><span>1.2 lucene能做什么&nbsp;</span><br><span>要回答这个问题，先要了解lucene的本质。实际上lucene的功能很单一，说到底，就是你给它若干个字符串，然后它为你提供一个全文搜索服务，告诉你你要搜索的关键词出现在哪里。知道了这个本质，你就可以发挥想象做任何符合这个条件的事情了。你可以把站内新闻都索引了，做个资料库；你可以把一个数据库表的若干个字段索引起来，那就不用再担心因为&ldquo;%like%&rdquo;而锁表了；你也可以写个自己的搜索引擎&hellip;&hellip;</span></p>
<p><span>1.3 你该不该选择lucene&nbsp;</span><br><span>下面给出一些测试数据，如果你觉得可以接受，那么可以选择。&nbsp;</span><br><span>测试一：250万记录，300M左右文本，生成索引380M左右，800线程下平均处理时间300ms。&nbsp;</span><br><span>测试二：37000记录，索引数据库中的两个varchar字段，索引文件2.6M，800线程下平均处理时间1.5ms。</span></p>
<p><span>2 lucene的工作方式&nbsp;</span><br><span>lucene提供的服务实际包含两部分：一入一出。所谓入是写入，即将你提供的源（本质是字符串）写入索引或者将其从索引中删除；所谓出是读出，即向用户提供全文搜索服务，让用户可以通过关键词定位源。</span></p>
<p><span>2.1写入流程&nbsp;</span><br><span>源字符串首先经过analyzer处理，包括：分词，分成一个个单词；去除stopword（可选）。&nbsp;</span><br><span>将源中需要的信息加入Document的各个Field中，并把需要索引的Field索引起来，把需要存储的Field存储起来。&nbsp;</span><br><span>将索引写入存储器，存储器可以是内存或磁盘。</span></p>
<p><span>2.2读出流程&nbsp;</span><br><span>用户提供搜索关键词，经过analyzer处理。&nbsp;</span><br><span>对处理后的关键词搜索索引找出对应的Document。&nbsp;</span><br><span>用户根据需要从找到的Document中提取需要的Field。</span></p>
<p><span>3 一些需要知道的概念&nbsp;</span><br><span>lucene用到一些概念，了解它们的含义，有利于下面的讲解。</span></p>
<p><span>3.1 analyzer&nbsp;</span><br><span>Analyzer 是分析器，它的作用是把一个字符串按某种规则划分成一个个词语，并去除其中的无效词语，这里说的无效词语是指英文中的&ldquo;of&rdquo;、 &ldquo;the&rdquo;，中文中的 &ldquo;的&rdquo;、&ldquo;地&rdquo;等词语，这些词语在文章中大量出现，但是本身不包含什么关键信息，去掉有利于缩小索引文件、提高效率、提高命中率。&nbsp;</span><br><span>分词的规则千变万化，但目的只有一个：按语义划分。这点在英文中比较容易实现，因为英文本身就是以单词为单位的，已经用空格分开；而中文则必须以某种方法将连成一片的句子划分成一个个词语。具体划分方法下面再详细介绍，这里只需了解分析器的概念即可。</span></p>
<p><span>3.2 document&nbsp;</span><br><span>用户提供的源是一条条记录，它们可以是文本文件、字符串或者数据库表的一条记录等等。一条记录经过索引之后，就是以一个Document的形式存储在索引文件中的。用户进行搜索，也是以Document列表的形式返回。</span></p>
<p><span>3.3 field&nbsp;</span><br><span>一个Document可以包含多个信息域，例如一篇文章可以包含&ldquo;标题&rdquo;、&ldquo;正文&rdquo;、&ldquo;最后修改时间&rdquo;等信息域，这些信息域就是通过Field在Document中存储的。&nbsp;</span><br><span>Field有两个属性可选：存储和索引。通过存储属性你可以控制是否对这个Field进行存储；通过索引属性你可以控制是否对该Field进行索引。这看起来似乎有些废话，事实上对这两个属性的正确组合很重要，下面举例说明：&nbsp;</span><br><span>还是以刚才的文章为例子，我们需要对标题和正文进行全文搜索，所以我们要把索引属性设置为真，同时我们希望能直接从搜索结果中提取文章标题，所以我们把标题域的存储属性设置为真，但是由于正文域太大了，我们为了缩小索引文件大小，将正文域的存储属性设置为假，当需要时再直接读取文件；我们只是希望能从搜索解果中提取最后修改时间，不需要对它进行搜索，所以我们把最后修改时间域的存储属性设置为真，索引属性设置为假。上面的三个域涵盖了两个属性的三种组合，还有一种全为假的没有用到，事实上Field不允许你那么设置，因为既不存储又不索引的域是没有意义的。</span></p>
<p><span>3.4 term&nbsp;</span><br><span>term是搜索的最小单位，它表示文档的一个词语，term由两部分组成：它表示的词语和这个词语所出现的field。</span></p>
<p><span>3.5 tocken&nbsp;</span><br><span>tocken是term的一次出现，它包含trem文本和相应的起止偏移，以及一个类型字符串。一句话中可以出现多次相同的词语，它们都用同一个term表示，但是用不同的tocken，每个tocken标记该词语出现的地方。</span></p>
<p><span>3.6 segment&nbsp;</span><br><span>添加索引时并不是每个document都马上添加到同一个索引文件，它们首先被写入到不同的小文件，然后再合并成一个大索引文件，这里每个小文件都是一个segment。</span></p>
<p><span>4 lucene的结构&nbsp;</span><br><span>lucene包括core和sandbox两部分，其中core是lucene稳定的核心部分，sandbox包含了一些附加功能，例如highlighter、各种分析器。&nbsp;</span><br><span>Lucene core有七个包：analysis，document，index，queryParser，search，store，util。&nbsp;</span><br><span>4.1 analysis&nbsp;</span><br><span>Analysis包含一些内建的分析器，例如按空白字符分词的WhitespaceAnalyzer，添加了stopwrod过滤的StopAnalyzer，最常用的StandardAnalyzer。&nbsp;</span><br><span>4.2 document&nbsp;</span><br><span>Document包含文档的数据结构，例如Document类定义了存储文档的数据结构，Field类定义了Document的一个域。&nbsp;</span><br><span>4.3 index&nbsp;</span><br><span>Index 包含了索引的读写类，例如对索引文件的segment进行写、合并、优化的IndexWriter类和对索引进行读取和删除操作的 IndexReader类，这里要注意的是不要被IndexReader这个名字误导，以为它是索引文件的读取类，实际上删除索引也是由它完成， IndexWriter只关心如何将索引写入一个个segment，并将它们合并优化；IndexReader则关注索引文件中各个文档的组织形式。&nbsp;</span><br><span>4.4 queryParser&nbsp;</span><br><span>QueryParser 包含了解析查询语句的类，lucene的查询语句和sql语句有点类似，有各种保留字，按照一定的语法可以组成各种查询。 Lucene有很多种 Query类，它们都继承自Query，执行各种特殊的查询，QueryParser的作用就是解析查询语句，按顺序调用各种 Query类查找出结果。&nbsp;</span><br><span>4.5 search&nbsp;</span><br><span>Search包含了从索引中搜索结果的各种类，例如刚才说的各种Query类，包括TermQuery、BooleanQuery等就在这个包里。&nbsp;</span><br><span>4.6 store&nbsp;</span><br><span>Store包含了索引的存储类，例如Directory定义了索引文件的存储结构，FSDirectory为存储在文件中的索引，RAMDirectory为存储在内存中的索引，MmapDirectory为使用内存映射的索引。&nbsp;</span><br><span>4.7 util&nbsp;</span><br><span>Util包含一些公共工具类，例如时间和字符串之间的转换工具。</span></p>
<p><span>5 如何建索引&nbsp;</span><br><span>5.1 最简单的能完成索引的代码片断</span></p>
<p><span>IndexWriter writer = new IndexWriter(&ldquo;/data/index/&rdquo;, new StandardAnalyzer(), true);&nbsp;</span><br><span>Document doc = new Document();&nbsp;</span><br><span>doc.add(new Field(“title”, “lucene introduction”, Field.Store.YES, Field.Index.TOKENIZED));&nbsp;</span><br><span>doc.add(new Field(“content”, “lucene works well”, Field.Store.YES, Field.Index.TOKENIZED));&nbsp;</span><br><span>writer.addDocument(doc);&nbsp;</span><br><span>writer.optimize();&nbsp;</span><br><span>writer.close();</span></p>
<p><span>下面我们分析一下这段代码。&nbsp;</span><br><span>首先我们创建了一个writer，并指定存放索引的目录为&ldquo;/data/index&rdquo;，使用的分析器为StandardAnalyzer，第三个参数说明如果已经有索引文件在索引目录下，我们将覆盖它们。&nbsp;</span><br><span>然后我们新建一个document。&nbsp;</span><br><span>我们向document添加一个field，名字是&ldquo;title&rdquo;，内容是&ldquo;lucene introduction&rdquo;，对它进行存储并索引。&nbsp;</span><br><span>再添加一个名字是&ldquo;content&rdquo;的field，内容是&ldquo;lucene works well&rdquo;，也是存储并索引。&nbsp;</span><br><span>然后我们将这个文档添加到索引中，如果有多个文档，可以重复上面的操作，创建document并添加。&nbsp;</span><br><span>添加完所有document，我们对索引进行优化，优化主要是将多个segment合并到一个，有利于提高索引速度。&nbsp;</span><br><span>随后将writer关闭，这点很重要。</span></p>
<p><span>对，创建索引就这么简单！&nbsp;</span><br><span>当然你可能修改上面的代码获得更具个性化的服务。</span></p>
<p><span>5.2 将索引直接写在内存&nbsp;</span><br><span>你需要首先创建一个RAMDirectory，并将其传给writer，代码如下：</span></p>
<p><span>Directory dir = new RAMDirectory();&nbsp;</span><br><span>IndexWriter writer = new IndexWriter(dir, new StandardAnalyzer(), true);&nbsp;</span><br><span>Document doc = new Document();&nbsp;</span><br><span>doc.add(new Field(“title”, “lucene introduction”, Field.Store.YES, Field.Index.TOKENIZED));&nbsp;</span><br><span>doc.add(new Field(“content”, “lucene works well”, Field.Store.YES, Field.Index.TOKENIZED));&nbsp;</span><br><span>writer.addDocument(doc);&nbsp;</span><br><span>writer.optimize();&nbsp;</span><br><span>writer.close();</span></p>
<p><span>5.3 索引文本文件&nbsp;</span><br><span>如果你想把纯文本文件索引起来，而不想自己将它们读入字符串创建field，你可以用下面的代码创建field：</span></p>
<p><span>Field field = new Field(“content”, new FileReader(file));</span></p>
<p><span>这里的file就是该文本文件。该构造函数实际上是读去文件内容，并对其进行索引，但不存储。</span></p>
<p><span>6 如何维护索引&nbsp;</span><br><span>索引的维护操作都是由IndexReader类提供。</span></p>
<p><span>6.1 如何删除索引&nbsp;</span><br><span>lucene提供了两种从索引中删除document的方法，一种是</span></p>
<p><span>void deleteDocument(int docNum)</span></p>
<p><span>这种方法是根据document在索引中的编号来删除，每个document加进索引后都会有个唯一编号，所以根据编号删除是一种精确删除，但是这个编号是索引的内部结构，一般我们不会知道某个文件的编号到底是几，所以用处不大。另一种是</span></p>
<p><span>void deleteDocuments(Term term)</span></p>
<p><span>这种方法实际上是首先根据参数term执行一个搜索操作，然后把搜索到的结果批量删除了。我们可以通过这个方法提供一个严格的查询条件，达到删除指定document的目的。&nbsp;</span><br><span>下面给出一个例子：</span></p>
<p><span>Directory dir = FSDirectory.getDirectory(PATH, false);&nbsp;</span><br><span>IndexReader reader = IndexReader.open(dir);&nbsp;</span><br><span>Term term = new Term(field, key);&nbsp;</span><br><span>reader.deleteDocuments(term);&nbsp;</span><br><span>reader.close();</span></p>
<p><span>6.2 如何更新索引&nbsp;</span><br><span>lucene并没有提供专门的索引更新方法，我们需要先将相应的document删除，然后再将新的document加入索引。例如：</span></p>
<p><span>Directory dir = FSDirectory.getDirectory(PATH, false);&nbsp;</span><br><span>IndexReader reader = IndexReader.open(dir);&nbsp;</span><br><span>Term term = new Term(&ldquo;title&rdquo;, &ldquo;lucene introduction&rdquo;);&nbsp;</span><br><span>reader.deleteDocuments(term);&nbsp;</span><br><span>reader.close();</span></p>
<p><span>IndexWriter writer = new IndexWriter(dir, new StandardAnalyzer(), true);&nbsp;</span><br><span>Document doc = new Document();&nbsp;</span><br><span>doc.add(new Field(“title”, “lucene introduction”, Field.Store.YES, Field.Index.TOKENIZED));&nbsp;</span><br><span>doc.add(new Field(“content”, “lucene is funny”, Field.Store.YES, Field.Index.TOKENIZED));&nbsp;</span><br><span>writer.addDocument(doc);&nbsp;</span><br><span>writer.optimize();&nbsp;</span><br><span>writer.close();</span></p>
<p><span>7 如何搜索&nbsp;</span><br><span>lucene 的搜索相当强大，它提供了很多辅助查询类，每个类都继承自Query类，各自完成一种特殊的查询，你可以像搭积木一样将它们任意组合使用，完成一些复杂操作；另外lucene还提供了Sort类对结果进行排序，提供了Filter类对查询条件进行限制。你或许会不自觉地拿它跟SQL语句进行比较： &ldquo;lucene能执行and、or、order by、where、like &lsquo;%xx%&rsquo;操作吗？&rdquo;回答是：&ldquo;当然没问题！&rdquo;</span></p>
<p><span>7.1 各种各样的Query&nbsp;</span><br><span>下面我们看看lucene到底允许我们进行哪些查询操作：</span></p>
<p><span>7.1.1 TermQuery&nbsp;</span><br><span>首先介绍最基本的查询，如果你想执行一个这样的查询：&ldquo;在content域中包含&lsquo;lucene&rsquo;的document&rdquo;，那么你可以用TermQuery：</span></p>
<p><span>Term t = new Term(“content”, “ lucene”;&nbsp;</span><br><span>Query query = new TermQuery(t);</span></p>
<p><span>7.1.2 BooleanQuery&nbsp;</span><br><span>如果你想这么查询：&ldquo;在content域中包含java或perl的document&rdquo;，那么你可以建立两个TermQuery并把它们用BooleanQuery连接起来：</span></p>
<p><span>TermQuery termQuery1 = new TermQuery(new Term(“content”, “java”);&nbsp;</span><br><span>TermQuery termQuery 2 = new TermQuery(new Term(“content”, “perl”);&nbsp;</span><br><span>BooleanQuery booleanQuery = new BooleanQuery();&nbsp;</span><br><span>booleanQuery.add(termQuery 1, BooleanClause.Occur.SHOULD);&nbsp;</span><br><span>booleanQuery.add(termQuery 2, BooleanClause.Occur.SHOULD);</span></p>
<p><span>7.1.3 WildcardQuery&nbsp;</span><br><span>如果你想对某单词进行通配符查询，你可以用WildcardQuery，通配符包括&rsquo;?&rsquo;匹配一个任意字符和&rsquo;<em>&rsquo;匹配零个或多个任意字符，例如你搜索&rsquo;use</em>&rsquo;，你可能找到&rsquo;useful&rsquo;或者&rsquo;useless&rsquo;：</span></p>
<p><span>Query query = new WildcardQuery(new Term(“content”, “use*”);</span></p>
<p><span>7.1.4 PhraseQuery&nbsp;</span><br><span>你可能对中日关系比较感兴趣，想查找&lsquo;中&rsquo;和&lsquo;日&rsquo;挨得比较近（5个字的距离内）的文章，超过这个距离的不予考虑，你可以：</span></p>
<p><span>PhraseQuery query = new PhraseQuery();&nbsp;</span><br><span>query.setSlop(5);&nbsp;</span><br><span>query.add(new Term(“content “, &ldquo;中&rdquo;));&nbsp;</span><br><span>query.add(new Term(&ldquo;content&rdquo;, &ldquo;日&rdquo;));</span></p>
<p><span>那么它可能搜到&ldquo;中日合作&hellip;&hellip;&rdquo;、&ldquo;中方和日方&hellip;&hellip;&rdquo;，但是搜不到&ldquo;中国某高层领导说日本欠扁&rdquo;。</span></p>
<p><span>7.1.5 PrefixQuery&nbsp;</span><br><span>如果你想搜以&lsquo;中&rsquo;开头的词语，你可以用PrefixQuery：</span></p>
<p><span>PrefixQuery query = new PrefixQuery(new Term(“content “, “中”);</span></p>
<p><span>7.1.6 FuzzyQuery&nbsp;</span><br><span>FuzzyQuery用来搜索相似的term，使用Levenshtein算法。假设你想搜索跟&lsquo;wuzza&rsquo;相似的词语，你可以：</span></p>
<p><span>Query query = new FuzzyQuery(new Term(“content”, “wuzza”);</span></p>
<p><span>你可能得到&lsquo;fuzzy&rsquo;和&lsquo;wuzzy&rsquo;。</span></p>
<p><span>7.1.7 RangeQuery&nbsp;</span><br><span>另一个常用的Query是RangeQuery，你也许想搜索时间域从20060101到20060130之间的document，你可以用RangeQuery：</span></p>
<p><span>RangeQuery query = new RangeQuery(new Term(&ldquo;time&rdquo;, &ldquo;20060101&rdquo;), new Term(&ldquo;time&rdquo;, &ldquo;20060130&rdquo;), true);</span></p>
<p><span>最后的true表示用闭合区间。</span></p>
<p><span>7.2 QueryParser&nbsp;</span><br><span>看了这么多Query，你可能会问：&ldquo;不会让我自己组合各种Query吧，太麻烦了！&rdquo;当然不会，lucene提供了一种类似于SQL语句的查询语句，我们姑且叫它lucene语句，通过它，你可以把各种查询一句话搞定，lucene会自动把它们查分成小块交给相应Query执行。下面我们对应每种 Query演示一下：&nbsp;</span><br><span>TermQuery可以用&ldquo;field:key&rdquo;方式，例如&ldquo;content:lucene&rdquo;。&nbsp;</span><br><span>BooleanQuery中&lsquo;与&rsquo;用&lsquo;+&rsquo;，&lsquo;或&rsquo;用&lsquo; &rsquo;，例如&ldquo;content:java contenterl&rdquo;。&nbsp;</span><br><span>WildcardQuery仍然用&lsquo;?&rsquo;和&lsquo;<em>&rsquo;，例如&ldquo;content:use</em>&rdquo;。&nbsp;</span><br><span>PhraseQuery用&lsquo;~&rsquo;，例如&ldquo;content:”中日”~5&rdquo;。&nbsp;</span><br><span>PrefixQuery用&lsquo;<em>&rsquo;，例如&ldquo;中</em>&rdquo;。&nbsp;</span><br><span>FuzzyQuery用&lsquo;~&rsquo;，例如&ldquo;content: wuzza ~&rdquo;。&nbsp;</span><br><span>RangeQuery用&lsquo;[]&rsquo;或&lsquo;{}&rsquo;，前者表示闭区间，后者表示开区间，例如&ldquo;time:[20060101 TO 20060130]&rdquo;，注意TO区分大小写。&nbsp;</span><br><span>你可以任意组合query string，完成复杂操作，例如&ldquo;标题或正文包括lucene，并且时间在20060101到20060130之间的文章&rdquo;可以表示为：&ldquo;+ (title:lucene content:lucene) +time:[20060101 TO 20060130]&rdquo;。代码如下：</span></p>
<p><span>Directory dir = FSDirectory.getDirectory(PATH, false);&nbsp;</span><br><span>IndexSearcher is = new IndexSearcher(dir);&nbsp;</span><br><span>QueryParser parser = new QueryParser(“content”, new StandardAnalyzer());&nbsp;</span><br><span>Query query = parser.parse(“+(title:lucene content:lucene) +time:[20060101 TO 20060130]”;&nbsp;</span><br><span>Hits hits = is.search(query);&nbsp;</span><br><span>for (int i = 0; i &lt; hits.length(); i++)&nbsp;</span><br><span>{&nbsp;</span><br><span>Document doc = hits.doc(i);&nbsp;</span><br><span>System.out.println(doc.get(“title”);&nbsp;</span><br><span>}&nbsp;</span><br><span>is.close();</span></p>
<p><span>首先我们创建一个在指定文件目录上的IndexSearcher。&nbsp;</span><br><span>然后创建一个使用StandardAnalyzer作为分析器的QueryParser，它默认搜索的域是content。&nbsp;</span><br><span>接着我们用QueryParser来parse查询字串，生成一个Query。&nbsp;</span><br><span>然后利用这个Query去查找结果，结果以Hits的形式返回。&nbsp;</span><br><span>这个Hits对象包含一个列表，我们挨个把它的内容显示出来。</span></p>
<p><span>7.3 Filter&nbsp;</span><br><span>filter 的作用就是限制只查询索引的某个子集，它的作用有点像SQL语句里的where，但又有区别，它不是正规查询的一部分，只是对数据源进行预处理，然后交给查询语句。注意它执行的是预处理，而不是对查询结果进行过滤，所以使用filter的代价是很大的，它可能会使一次查询耗时提高一百倍。&nbsp;</span><br><span>最常用的filter是RangeFilter和QueryFilter。RangeFilter是设定只搜索指定范围内的索引；QueryFilter是在上次查询的结果中搜索。&nbsp;</span><br><span>Filter的使用非常简单，你只需创建一个filter实例，然后把它传给searcher。继续上面的例子，查询&ldquo;时间在20060101到20060130之间的文章&rdquo;除了将限制写在query string中，你还可以写在RangeFilter中：</span></p>
<p><span>Directory dir = FSDirectory.getDirectory(PATH, false);&nbsp;</span><br><span>IndexSearcher is = new IndexSearcher(dir);&nbsp;</span><br><span>QueryParser parser = new QueryParser(“content”, new StandardAnalyzer());&nbsp;</span><br><span>Query query = parser.parse(“title:lucene content:lucene”;&nbsp;</span><br><span>RangeFilter filter = new RangeFilter(“time”, “20060101”, “20060230”, true, true);&nbsp;</span><br><span>Hits hits = is.search(query, filter);&nbsp;</span><br><span>for (int i = 0; i &lt; hits.length(); i++)&nbsp;</span><br><span>{&nbsp;</span><br><span>Document doc = hits.doc(i);&nbsp;</span><br><span>System.out.println(doc.get(“title”);&nbsp;</span><br><span>}&nbsp;</span><br><span>is.close();</span></p>
<p><span>7.4 Sort&nbsp;</span><br><span>有时你想要一个排好序的结果集，就像SQL语句的&ldquo;order by&rdquo;，lucene能做到：通过Sort。&nbsp;</span><br><span>Sort sort = new Sort(&ldquo;time&rdquo;); //相当于SQL的&ldquo;order by time&rdquo;&nbsp;</span><br><span>Sort sort = new Sort(&ldquo;time&rdquo;, true); // 相当于SQL的&ldquo;order by time desc&rdquo;&nbsp;</span><br><span>下面是一个完整的例子：</span></p>
<p><span>Directory dir = FSDirectory.getDirectory(PATH, false);&nbsp;</span><br><span>IndexSearcher is = new IndexSearcher(dir);&nbsp;</span><br><span>QueryParser parser = new QueryParser(“content”, new StandardAnalyzer());&nbsp;</span><br><span>Query query = parser.parse(“title:lucene content:lucene”;&nbsp;</span><br><span>RangeFilter filter = new RangeFilter(“time”, “20060101”, “20060230”, true, true);&nbsp;</span><br><span>Sort sort = new Sort(&ldquo;time&rdquo;);&nbsp;</span><br><span>Hits hits = is.search(query, filter, sort);&nbsp;</span><br><span>for (int i = 0; i &lt; hits.length(); i++)&nbsp;</span><br><span>{&nbsp;</span><br><span>Document doc = hits.doc(i);&nbsp;</span><br><span>System.out.println(doc.get(“title”);&nbsp;</span><br><span>}&nbsp;</span><br><span>is.close();</span></p>
<p><span>8 分析器&nbsp;</span><br><span>在前面的概念介绍中我们已经知道了分析器的作用，就是把句子按照语义切分成一个个词语。英文切分已经有了很成熟的分析器： StandardAnalyzer，很多情况下StandardAnalyzer是个不错的选择。甚至你会发现StandardAnalyzer也能对中文进行分词。&nbsp;</span><br><span>但是我们的焦点是中文分词，StandardAnalyzer能支持中文分词吗？实践证明是可以的，但是效果并不好，搜索&ldquo;如果&rdquo; 会把&ldquo;牛奶不如果汁好喝&rdquo;也搜索出来，而且索引文件很大。那么我们手头上还有什么分析器可以使用呢？core里面没有，我们可以在sandbox里面找到两个： ChineseAnalyzer和CJKAnalyzer。但是它们同样都有分词不准的问题。相比之下用StandardAnalyzer和 ChineseAnalyzer建立索引时间差不多，索引文件大小也差不多，CJKAnalyzer表现会差些，索引文件大且耗时比较长。&nbsp;</span><br><span>要解决问题，首先分析一下这三个分析器的分词方式。StandardAnalyzer和ChineseAnalyzer都是把句子按单个字切分，也就是说 &ldquo;牛奶不如果汁好喝&rdquo;会被它们切分成&ldquo;牛 奶 不 如 果 汁 好 喝&rdquo;；而CJKAnalyzer则会切分成&ldquo;牛奶 奶不 不如 如果 果汁 汁好好喝&rdquo;。这也就解释了为什么搜索&ldquo;果汁&rdquo;都能匹配这个句子。&nbsp;</span><br><span>以上分词的缺点至少有两个：匹配不准确和索引文件大。我们的目标是将上面的句子分解成 &ldquo;牛奶 不如 果汁好喝&rdquo;。这里的关键就是语义识别，我们如何识别&ldquo;牛奶&rdquo;是一个词而&ldquo;奶不&rdquo;不是词语？我们很自然会想到基于词库的分词法，也就是我们先得到一个词库，里面列举了大部分词语，我们把句子按某种方式切分，当得到的词语与词库中的项匹配时，我们就认为这种切分是正确的。这样切词的过程就转变成匹配的过程，而匹配的方式最简单的有正向最大匹配和逆向最大匹配两种，说白了就是一个从句子开头向后进行匹配，一个从句子末尾向前进行匹配。基于词库的分词词库非常重要，词库的容量直接影响搜索结果，在相同词库的前提下，据说逆向最大匹配优于正向最大匹配。&nbsp;</span><br><span>当然还有别的分词方法，这本身就是一个学科，我这里也没有深入研究。回到具体应用，我们的目标是能找到成熟的、现成的分词工具，避免重新发明车轮。经过网上搜索，用的比较多的是中科院的 ICTCLAS和一个不开放源码但是免费的JE-Analysis。ICTCLAS有个问题是它是一个动态链接库， java调用需要本地方法调用，不方便也有安全隐患，而且口碑也确实不大好。JE-Analysis效果还不错，当然也会有分词不准的地方，相比比较方便放心。</span></p>
<p><span>9 性能优化&nbsp;</span><br><span>一直到这里，我们还是在讨论怎么样使lucene跑起来，完成指定任务。利用前面说的也确实能完成大部分功能。但是测试表明lucene的性能并不是很好，在大数据量大并发的条件下甚至会有半分钟返回的情况。另外大数据量的数据初始化建立索引也是一个十分耗时的过程。那么如何提高lucene的性能呢？下面从优化创建索引性能和优化搜索性能两方面介绍。</span></p>
<p><span>9.1 优化创建索引性能&nbsp;</span><br><span>这方面的优化途径比较有限，IndexWriter提供了一些接口可以控制建立索引的操作，另外我们可以先将索引写入RAMDirectory，再批量写入FSDirectory，不管怎样，目的都是尽量少的文件IO，因为创建索引的最大瓶颈在于磁盘IO。另外选择一个较好的分析器也能提高一些性能。</span></p>
<p><span>9.1.1 通过设置IndexWriter的参数优化索引建立&nbsp;</span><br><span>setMaxBufferedDocs(int maxBufferedDocs)&nbsp;</span><br><span>控制写入一个新的segment前内存中保存的document的数目，设置较大的数目可以加快建索引速度，默认为10。&nbsp;</span><br><span>setMaxMergeDocs(int maxMergeDocs)&nbsp;</span><br><span>控制一个segment中可以保存的最大document数目，值较小有利于追加索引的速度，默认Integer.MAX_VALUE，无需修改。&nbsp;</span><br><span>setMergeFactor(int mergeFactor)&nbsp;</span><br><span>控制多个segment合并的频率，值较大时建立索引速度较快，默认是10，可以在建立索引时设置为100。</span></p>
<p><span>9.1.2 通过RAMDirectory缓写提高性能&nbsp;</span><br><span>我们可以先把索引写入RAMDirectory，达到一定数量时再批量写进FSDirectory，减少磁盘IO次数。</span></p>
<p><span>FSDirectory fsDir = FSDirectory.getDirectory(“/data/index”, true);&nbsp;</span><br><span>RAMDirectory ramDir = new RAMDirectory();&nbsp;</span><br><span>IndexWriter fsWriter = new IndexWriter(fsDir, new StandardAnalyzer(), true);&nbsp;</span><br><span>IndexWriter ramWriter = new IndexWriter(ramDir, new StandardAnalyzer(), true);&nbsp;</span><br><span>while (there are documents to index)&nbsp;</span><br><span>{&nbsp;</span><br><span>… create Document …&nbsp;</span><br><span>ramWriter.addDocument(doc);&nbsp;</span><br><span>if (condition for flushing memory to disk has been met)&nbsp;</span><br><span>{&nbsp;</span><br><span>fsWriter.addIndexes(new Directory[] { ramDir });&nbsp;</span><br><span>ramWriter.close();&nbsp;</span><br><span>ramWriter = new IndexWriter(ramDir, new StandardAnalyzer(), true);&nbsp;</span><br><span>}&nbsp;</span><br><span>}</span></p>
<p><span>9.1.3 选择较好的分析器&nbsp;</span><br><span>这个优化主要是对磁盘空间的优化，可以将索引文件减小将近一半，相同测试数据下由600M减少到380M。但是对时间并没有什么帮助，甚至会需要更长时间，因为较好的分析器需要匹配词库，会消耗更多cpu，测试数据用StandardAnalyzer耗时133分钟；用MMAnalyzer耗时150分钟。</span></p>
<p><span>9.2 优化搜索性能&nbsp;</span><br><span>虽然建立索引的操作非常耗时，但是那毕竟只在最初创建时才需要，平时只是少量的维护操作，更何况这些可以放到一个后台进程处理，并不影响用户搜索。我们创建索引的目的就是给用户搜索，所以搜索的性能才是我们最关心的。下面就来探讨一下如何提高搜索性能。</span></p>
<p><span>9.2.1 将索引放入内存&nbsp;</span><br><span>这是一个最直观的想法，因为内存比磁盘快很多。Lucene提供了RAMDirectory可以在内存中容纳索引：</span></p>
<p><span>Directory fsDir = FSDirectory.getDirectory(&ldquo;/data/index/&rdquo;, false);&nbsp;</span><br><span>Directory ramDir = new RAMDirectory(fsDir);&nbsp;</span><br><span>Searcher searcher = new IndexSearcher(ramDir);</span></p>
<p><span>但是实践证明RAMDirectory和FSDirectory速度差不多，当数据量很小时两者都非常快，当数据量较大时（索引文件400M）RAMDirectory甚至比FSDirectory还要慢一点，这确实让人出乎意料。&nbsp;</span><br><span>而且lucene的搜索非常耗内存，即使将400M的索引文件载入内存，在运行一段时间后都会out of memory，所以个人认为载入内存的作用并不大。</span></p>
<p><span>9.2.2 优化时间范围限制&nbsp;</span><br><span>既然载入内存并不能提高效率，一定有其它瓶颈，经过测试发现最大的瓶颈居然是时间范围限制，那么我们可以怎样使时间范围限制的代价最小呢？&nbsp;</span><br><span>当需要搜索指定时间范围内的结果时，可以：&nbsp;</span><br><span>1、用RangeQuery，设置范围，但是RangeQuery的实现实际上是将时间范围内的时间点展开，组成一个个BooleanClause加入到 BooleanQuery中查询，因此时间范围不可能设置太大，经测试，范围超过一个月就会抛 BooleanQuery.TooManyClauses，可以通过设置 BooleanQuery.setMaxClauseCount (int maxClauseCount)扩大，但是扩大也是有限的，并且随着maxClauseCount扩大，占用内存也扩大&nbsp;</span><br><span>2、用 RangeFilter代替RangeQuery，经测试速度不会比RangeQuery慢，但是仍然有性能瓶颈，查询的90%以上时间耗费在 RangeFilter，研究其源码发现RangeFilter实际上是首先遍历所有索引，生成一个BitSet，标记每个document，在时间范围内的标记为true，不在的标记为false，然后将结果传递给Searcher查找，这是十分耗时的。&nbsp;</span><br><span>3、进一步提高性能，这个又有两个思路：&nbsp;</span><br><span>a、缓存Filter结果。既然RangeFilter的执行是在搜索之前，那么它的输入都是一定的，就是IndexReader，而 IndexReader是由Directory决定的，所以可以认为RangeFilter的结果是由范围的上下限决定的，也就是由具体的 RangeFilter对象决定，所以我们只要以RangeFilter对象为键，将filter结果BitSet缓存起来即可。lucene API 已经提供了一个CachingWrapperFilter类封装了Filter及其结果，所以具体实施起来我们可以 cache CachingWrapperFilter对象，需要注意的是，不要被CachingWrapperFilter的名字及其说明误导， CachingWrapperFilter看起来是有缓存功能，但的缓存是针对同一个filter的，也就是在你用同一个filter过滤不同 IndexReader时，它可以帮你缓存不同IndexReader的结果，而我们的需求恰恰相反，我们是用不同filter过滤同一个 IndexReader，所以只能把它作为一个封装类。&nbsp;</span><br><span>b、降低时间精度。研究Filter的工作原理可以看出，它每次工作都是遍历整个索引的，所以时间粒度越大，对比越快，搜索时间越短，在不影响功能的情况下，时间精度越低越好，有时甚至牺牲一点精度也值得，当然最好的情况是根本不作时间限制。&nbsp;</span><br><span>下面针对上面的两个思路演示一下优化结果（都采用800线程随机关键词随即时间范围）：&nbsp;</span><br><span>第一组，时间精度为秒：&nbsp;</span><br><span>方式 直接用RangeFilter 使用cache 不用filter&nbsp;</span><br><span>平均每个线程耗时 10s 1s 300ms</span></p>
<p><span>第二组，时间精度为天&nbsp;</span><br><span>方式 直接用RangeFilter 使用cache 不用filter&nbsp;</span><br><span>平均每个线程耗时 900ms 360ms 300ms</span></p>
<p><span>由以上数据可以得出结论：&nbsp;</span><br><span>1、 尽量降低时间精度，将精度由秒换成天带来的性能提高甚至比使用cache还好，最好不使用filter。&nbsp;</span><br><span>2、 在不能降低时间精度的情况下，使用cache能带了10倍左右的性能提高。</span></p>
<p><span>9.2.3 使用更好的分析器&nbsp;</span><br><span>这个跟创建索引优化道理差不多，索引文件小了搜索自然会加快。当然这个提高也是有限的。较好的分析器相对于最差的分析器对性能的提升在20%以下。</span></p>
<p><span>10 一些经验</span></p>
<p><span>10.1关键词区分大小写&nbsp;</span><br><span>or AND TO等关键词是区分大小写的，lucene只认大写的，小写的当做普通单词。</span></p>
<p><span>10.2 读写互斥性&nbsp;</span><br><span>同一时刻只能有一个对索引的写操作，在写的同时可以进行搜索</span></p>
<p><span>10.3 文件锁&nbsp;</span><br><span>在写索引的过程中强行退出将在tmp目录留下一个lock文件，使以后的写操作无法进行，可以将其手工删除</span></p>
<p><span>10.4 时间格式&nbsp;</span><br><span>lucene只支持一种时间格式yyMMddHHmmss，所以你传一个yy-MM-dd HH:mm:ss的时间给lucene它是不会当作时间来处理的</span></p>
<p><span>10.5 设置boost&nbsp;</span><br><span>有些时候在搜索时某个字段的权重需要大一些，例如你可能认为标题中出现关键词的文章比正文中出现关键词的文章更有价值，你可以把标题的boost设置的更大，那么搜索结果会优先显示标题中出现关键词的文章（没有使用排序的前题下）。使用方法：&nbsp;</span><br><span>Field. setBoost(float boost);默认值是1.0，也就是说要增加权重的需要设置得比1大。</span></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/my_avatar.jpg"
                alt="Wang Jie" />
            
              <p class="site-author-name" itemprop="name">Wang Jie</p>
              <p class="site-description motion-element" itemprop="description">Wang Jie's blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">144</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/wangjiegulu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:tiantian.china.2@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://plus.google.com/+%E5%A4%A9%E5%A4%A9wangjie" target="_blank" title="Google">
                      
                        <i class="fa fa-fw fa-google"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/wangjiegulu" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/2124006/wangjie" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/wangjiegulu" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i></a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.cnblogs.com/tiantianbyconan/" title="cnblog" target="_blank">cnblog</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wang Jie</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>








        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://blog-wangjiegulu-com.disqus.com/count.js" async></script>
    

    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "default";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "GooglePlus,Evernote,Twitter,Facebook,Douban,Weibo";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  

</body>
</html>
